// This file was auto-generated by Fern from our API Definition.

import * as Vital from "../../src/api/index";
import { VitalClient } from "../../src/Client";
import { mockServerPool } from "../mock-server/MockServerPool";

describe("LabTestsClient", () => {
    test("get (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = [
            {
                id: "id",
                slug: "slug",
                name: "name",
                sample_type: "dried_blood_spot",
                method: "testkit",
                price: 1.1,
                is_active: true,
                status: "active",
                fasting: true,
                lab: {
                    id: 1,
                    slug: "labcorp",
                    name: "LabCorp",
                    first_line_address: "123 Main St",
                    city: "San Francisco",
                    zipcode: "91789",
                    collection_methods: ["testkit"],
                    sample_types: ["saliva"],
                },
                markers: [
                    {
                        id: 1,
                        name: "Hemoglobin A1c",
                        slug: "hemoglobin-a1c",
                        description:
                            "Hemoglobin A1c is a form of hemoglobin that is measured identify your average blood sugar levels over the past 3 months.",
                        lab_id: 1,
                        provider_id: "1234",
                        type: "biomarker",
                        unit: "%",
                        price: "10.00",
                        aoe: {
                            questions: [
                                {
                                    id: 1,
                                    required: true,
                                    code: "question_code",
                                    value: "question_value",
                                    type: "choice",
                                    sequence: 1,
                                    answers: [{ id: 1, code: "answer_code", value: "answer_value" }],
                                },
                            ],
                        },
                        common_tat_days: 3,
                        worst_case_tat_days: 5,
                        is_orderable: true,
                    },
                ],
                auto_generated: true,
                has_collection_instructions: true,
                common_tat_days: 1,
                worst_case_tat_days: 1,
            },
        ];
        server.mockEndpoint().get("/v3/lab_tests").respondWith().statusCode(200).jsonBody(rawResponseBody).build();

        const response = await client.labTests.get({
            generationMethod: "auto",
            labSlug: "lab_slug",
            collectionMethod: "testkit",
            status: "active",
            name: "name",
            orderKey: "price",
            orderDirection: "asc",
        });
        expect(response).toEqual([
            {
                id: "id",
                slug: "slug",
                name: "name",
                sampleType: "dried_blood_spot",
                method: "testkit",
                price: 1.1,
                isActive: true,
                status: "active",
                fasting: true,
                lab: {
                    id: 1,
                    slug: "labcorp",
                    name: "LabCorp",
                    firstLineAddress: "123 Main St",
                    city: "San Francisco",
                    zipcode: "91789",
                    collectionMethods: ["testkit"],
                    sampleTypes: ["saliva"],
                },
                markers: [
                    {
                        id: 1,
                        name: "Hemoglobin A1c",
                        slug: "hemoglobin-a1c",
                        description:
                            "Hemoglobin A1c is a form of hemoglobin that is measured identify your average blood sugar levels over the past 3 months.",
                        labId: 1,
                        providerId: "1234",
                        type: "biomarker",
                        unit: "%",
                        price: "10.00",
                        aoe: {
                            questions: [
                                {
                                    id: 1,
                                    required: true,
                                    code: "question_code",
                                    value: "question_value",
                                    type: "choice",
                                    sequence: 1,
                                    answers: [
                                        {
                                            id: 1,
                                            code: "answer_code",
                                            value: "answer_value",
                                        },
                                    ],
                                },
                            ],
                        },
                        commonTatDays: 3,
                        worstCaseTatDays: 5,
                        isOrderable: true,
                    },
                ],
                autoGenerated: true,
                hasCollectionInstructions: true,
                commonTatDays: 1,
                worstCaseTatDays: 1,
            },
        ]);
    });

    test("get (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {};
        server.mockEndpoint().get("/v3/lab_tests").respondWith().statusCode(422).jsonBody(rawResponseBody).build();

        await expect(async () => {
            return await client.labTests.get();
        }).rejects.toThrow(Vital.UnprocessableEntityError);
    });

    test("create (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { name: "name", method: "testkit", description: "description" };
        const rawResponseBody = {
            id: "id",
            slug: "slug",
            name: "name",
            sample_type: "dried_blood_spot",
            method: "testkit",
            price: 1.1,
            is_active: true,
            status: "active",
            fasting: true,
            lab: {
                id: 1,
                slug: "labcorp",
                name: "LabCorp",
                first_line_address: "123 Main St",
                city: "San Francisco",
                zipcode: "91789",
                collection_methods: ["testkit"],
                sample_types: ["saliva"],
            },
            markers: [
                {
                    id: 1,
                    name: "Hemoglobin A1c",
                    slug: "hemoglobin-a1c",
                    description:
                        "Hemoglobin A1c is a form of hemoglobin that is measured identify your average blood sugar levels over the past 3 months.",
                    lab_id: 1,
                    provider_id: "1234",
                    type: "biomarker",
                    unit: "%",
                    price: "10.00",
                    aoe: {
                        questions: [
                            {
                                id: 1,
                                required: true,
                                code: "question_code",
                                value: "question_value",
                                type: "choice",
                                sequence: 1,
                                answers: [{ id: 1, code: "answer_code", value: "answer_value" }],
                            },
                        ],
                    },
                    a_la_carte_enabled: true,
                    common_tat_days: 3,
                    worst_case_tat_days: 5,
                    is_orderable: true,
                },
            ],
            auto_generated: true,
            has_collection_instructions: true,
            common_tat_days: 1,
            worst_case_tat_days: 1,
        };
        server
            .mockEndpoint()
            .post("/v3/lab_tests")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.labTests.create({
            name: "name",
            method: "testkit",
            description: "description",
        });
        expect(response).toEqual({
            id: "id",
            slug: "slug",
            name: "name",
            sampleType: "dried_blood_spot",
            method: "testkit",
            price: 1.1,
            isActive: true,
            status: "active",
            fasting: true,
            lab: {
                id: 1,
                slug: "labcorp",
                name: "LabCorp",
                firstLineAddress: "123 Main St",
                city: "San Francisco",
                zipcode: "91789",
                collectionMethods: ["testkit"],
                sampleTypes: ["saliva"],
            },
            markers: [
                {
                    id: 1,
                    name: "Hemoglobin A1c",
                    slug: "hemoglobin-a1c",
                    description:
                        "Hemoglobin A1c is a form of hemoglobin that is measured identify your average blood sugar levels over the past 3 months.",
                    labId: 1,
                    providerId: "1234",
                    type: "biomarker",
                    unit: "%",
                    price: "10.00",
                    aoe: {
                        questions: [
                            {
                                id: 1,
                                required: true,
                                code: "question_code",
                                value: "question_value",
                                type: "choice",
                                sequence: 1,
                                answers: [
                                    {
                                        id: 1,
                                        code: "answer_code",
                                        value: "answer_value",
                                    },
                                ],
                            },
                        ],
                    },
                    aLaCarteEnabled: true,
                    commonTatDays: 3,
                    worstCaseTatDays: 5,
                    isOrderable: true,
                },
            ],
            autoGenerated: true,
            hasCollectionInstructions: true,
            commonTatDays: 1,
            worstCaseTatDays: 1,
        });
    });

    test("create (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { name: "name", method: "testkit", description: "description" };
        const rawResponseBody = {};
        server
            .mockEndpoint()
            .post("/v3/lab_tests")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(422)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.labTests.create({
                name: "name",
                method: "testkit",
                description: "description",
            });
        }).rejects.toThrow(Vital.UnprocessableEntityError);
    });

    test("get_by_id (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            id: "id",
            slug: "slug",
            name: "name",
            sample_type: "dried_blood_spot",
            method: "testkit",
            price: 1.1,
            is_active: true,
            status: "active",
            fasting: true,
            lab: {
                id: 1,
                slug: "labcorp",
                name: "LabCorp",
                first_line_address: "123 Main St",
                city: "San Francisco",
                zipcode: "91789",
                collection_methods: ["testkit"],
                sample_types: ["saliva"],
            },
            markers: [
                {
                    id: 1,
                    name: "Hemoglobin A1c",
                    slug: "hemoglobin-a1c",
                    description:
                        "Hemoglobin A1c is a form of hemoglobin that is measured identify your average blood sugar levels over the past 3 months.",
                    lab_id: 1,
                    provider_id: "1234",
                    type: "biomarker",
                    unit: "%",
                    price: "10.00",
                    aoe: {
                        questions: [
                            {
                                id: 1,
                                required: true,
                                code: "question_code",
                                value: "question_value",
                                type: "choice",
                                sequence: 1,
                                answers: [{ id: 1, code: "answer_code", value: "answer_value" }],
                            },
                        ],
                    },
                    a_la_carte_enabled: true,
                    common_tat_days: 3,
                    worst_case_tat_days: 5,
                    is_orderable: true,
                },
            ],
            auto_generated: true,
            has_collection_instructions: true,
            common_tat_days: 1,
            worst_case_tat_days: 1,
        };
        server
            .mockEndpoint()
            .get("/v3/lab_tests/lab_test_id")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.labTests.getById("lab_test_id", {
            labAccountId: "lab_account_id",
        });
        expect(response).toEqual({
            id: "id",
            slug: "slug",
            name: "name",
            sampleType: "dried_blood_spot",
            method: "testkit",
            price: 1.1,
            isActive: true,
            status: "active",
            fasting: true,
            lab: {
                id: 1,
                slug: "labcorp",
                name: "LabCorp",
                firstLineAddress: "123 Main St",
                city: "San Francisco",
                zipcode: "91789",
                collectionMethods: ["testkit"],
                sampleTypes: ["saliva"],
            },
            markers: [
                {
                    id: 1,
                    name: "Hemoglobin A1c",
                    slug: "hemoglobin-a1c",
                    description:
                        "Hemoglobin A1c is a form of hemoglobin that is measured identify your average blood sugar levels over the past 3 months.",
                    labId: 1,
                    providerId: "1234",
                    type: "biomarker",
                    unit: "%",
                    price: "10.00",
                    aoe: {
                        questions: [
                            {
                                id: 1,
                                required: true,
                                code: "question_code",
                                value: "question_value",
                                type: "choice",
                                sequence: 1,
                                answers: [
                                    {
                                        id: 1,
                                        code: "answer_code",
                                        value: "answer_value",
                                    },
                                ],
                            },
                        ],
                    },
                    aLaCarteEnabled: true,
                    commonTatDays: 3,
                    worstCaseTatDays: 5,
                    isOrderable: true,
                },
            ],
            autoGenerated: true,
            hasCollectionInstructions: true,
            commonTatDays: 1,
            worstCaseTatDays: 1,
        });
    });

    test("get_by_id (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {};
        server
            .mockEndpoint()
            .get("/v3/lab_tests/lab_test_id")
            .respondWith()
            .statusCode(422)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.labTests.getById("lab_test_id");
        }).rejects.toThrow(Vital.UnprocessableEntityError);
    });

    test("update_lab_test (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {};
        const rawResponseBody = {
            id: "id",
            slug: "slug",
            name: "name",
            sample_type: "dried_blood_spot",
            method: "testkit",
            price: 1.1,
            is_active: true,
            status: "active",
            fasting: true,
            lab: {
                id: 1,
                slug: "labcorp",
                name: "LabCorp",
                first_line_address: "123 Main St",
                city: "San Francisco",
                zipcode: "91789",
                collection_methods: ["testkit"],
                sample_types: ["saliva"],
            },
            markers: [
                {
                    id: 1,
                    name: "Hemoglobin A1c",
                    slug: "hemoglobin-a1c",
                    description:
                        "Hemoglobin A1c is a form of hemoglobin that is measured identify your average blood sugar levels over the past 3 months.",
                    lab_id: 1,
                    provider_id: "1234",
                    type: "biomarker",
                    unit: "%",
                    price: "10.00",
                    aoe: {
                        questions: [
                            {
                                id: 1,
                                required: true,
                                code: "question_code",
                                value: "question_value",
                                type: "choice",
                                sequence: 1,
                                answers: [{ id: 1, code: "answer_code", value: "answer_value" }],
                            },
                        ],
                    },
                    a_la_carte_enabled: true,
                    common_tat_days: 3,
                    worst_case_tat_days: 5,
                    is_orderable: true,
                },
            ],
            auto_generated: true,
            has_collection_instructions: true,
            common_tat_days: 1,
            worst_case_tat_days: 1,
        };
        server
            .mockEndpoint()
            .patch("/v3/lab_tests/lab_test_id")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.labTests.updateLabTest("lab_test_id");
        expect(response).toEqual({
            id: "id",
            slug: "slug",
            name: "name",
            sampleType: "dried_blood_spot",
            method: "testkit",
            price: 1.1,
            isActive: true,
            status: "active",
            fasting: true,
            lab: {
                id: 1,
                slug: "labcorp",
                name: "LabCorp",
                firstLineAddress: "123 Main St",
                city: "San Francisco",
                zipcode: "91789",
                collectionMethods: ["testkit"],
                sampleTypes: ["saliva"],
            },
            markers: [
                {
                    id: 1,
                    name: "Hemoglobin A1c",
                    slug: "hemoglobin-a1c",
                    description:
                        "Hemoglobin A1c is a form of hemoglobin that is measured identify your average blood sugar levels over the past 3 months.",
                    labId: 1,
                    providerId: "1234",
                    type: "biomarker",
                    unit: "%",
                    price: "10.00",
                    aoe: {
                        questions: [
                            {
                                id: 1,
                                required: true,
                                code: "question_code",
                                value: "question_value",
                                type: "choice",
                                sequence: 1,
                                answers: [
                                    {
                                        id: 1,
                                        code: "answer_code",
                                        value: "answer_value",
                                    },
                                ],
                            },
                        ],
                    },
                    aLaCarteEnabled: true,
                    commonTatDays: 3,
                    worstCaseTatDays: 5,
                    isOrderable: true,
                },
            ],
            autoGenerated: true,
            hasCollectionInstructions: true,
            commonTatDays: 1,
            worstCaseTatDays: 1,
        });
    });

    test("update_lab_test (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {};
        const rawResponseBody = {};
        server
            .mockEndpoint()
            .patch("/v3/lab_tests/lab_test_id")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(422)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.labTests.updateLabTest("lab_test_id");
        }).rejects.toThrow(Vital.UnprocessableEntityError);
    });

    test("get_markers (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            markers: [
                {
                    id: 1,
                    name: "Hemoglobin A1c",
                    slug: "hemoglobin-a1c",
                    description:
                        "Hemoglobin A1c is a form of hemoglobin that is measured identify your average blood sugar levels over the past 3 months.",
                    lab_id: 1,
                    provider_id: "1234",
                    type: "biomarker",
                    unit: "%",
                    price: "10.00",
                    aoe: {
                        questions: [
                            {
                                id: 1000000,
                                required: true,
                                code: "code",
                                value: "value",
                                type: "choice",
                                sequence: 1,
                                answers: [{ id: 1, code: "code", value: "value" }],
                            },
                        ],
                    },
                    a_la_carte_enabled: true,
                    common_tat_days: 1,
                    worst_case_tat_days: 1,
                    is_orderable: true,
                    expected_results: [
                        {
                            id: 1,
                            name: "Hemoglobin A1c",
                            slug: "hemoglobin-a1c",
                            lab_id: 1,
                            provider_id: "1234",
                            required: true,
                            loinc: {
                                id: 1,
                                name: "HbA1c (Bld) [Mass fraction]",
                                slug: "hba1c-bld-mass-fraction",
                                code: "4548-4",
                                unit: "%",
                            },
                        },
                    ],
                },
            ],
            total: 1,
            page: 1,
            size: 1,
            pages: 1,
        };
        server
            .mockEndpoint()
            .get("/v3/lab_tests/markers")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.labTests.getMarkers({
            name: "name",
            aLaCarteEnabled: true,
            labAccountId: "lab_account_id",
            page: 1,
            size: 1,
        });
        expect(response).toEqual({
            markers: [
                {
                    id: 1,
                    name: "Hemoglobin A1c",
                    slug: "hemoglobin-a1c",
                    description:
                        "Hemoglobin A1c is a form of hemoglobin that is measured identify your average blood sugar levels over the past 3 months.",
                    labId: 1,
                    providerId: "1234",
                    type: "biomarker",
                    unit: "%",
                    price: "10.00",
                    aoe: {
                        questions: [
                            {
                                id: 1000000,
                                required: true,
                                code: "code",
                                value: "value",
                                type: "choice",
                                sequence: 1,
                                answers: [
                                    {
                                        id: 1,
                                        code: "code",
                                        value: "value",
                                    },
                                ],
                            },
                        ],
                    },
                    aLaCarteEnabled: true,
                    commonTatDays: 1,
                    worstCaseTatDays: 1,
                    isOrderable: true,
                    expectedResults: [
                        {
                            id: 1,
                            name: "Hemoglobin A1c",
                            slug: "hemoglobin-a1c",
                            labId: 1,
                            providerId: "1234",
                            required: true,
                            loinc: {
                                id: 1,
                                name: "HbA1c (Bld) [Mass fraction]",
                                slug: "hba1c-bld-mass-fraction",
                                code: "4548-4",
                                unit: "%",
                            },
                        },
                    ],
                },
            ],
            total: 1,
            page: 1,
            size: 1,
            pages: 1,
        });
    });

    test("get_markers (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {};
        server
            .mockEndpoint()
            .get("/v3/lab_tests/markers")
            .respondWith()
            .statusCode(422)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.labTests.getMarkers();
        }).rejects.toThrow(Vital.UnprocessableEntityError);
    });

    test("get_markers_for_order_set (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {};
        const rawResponseBody = {
            markers: [
                {
                    id: 1,
                    name: "Hemoglobin A1c",
                    slug: "hemoglobin-a1c",
                    description:
                        "Hemoglobin A1c is a form of hemoglobin that is measured identify your average blood sugar levels over the past 3 months.",
                    lab_id: 1,
                    provider_id: "1234",
                    type: "biomarker",
                    unit: "%",
                    price: "10.00",
                    aoe: {
                        questions: [
                            {
                                id: 1000000,
                                required: true,
                                code: "code",
                                value: "value",
                                type: "choice",
                                sequence: 1,
                                answers: [{ id: 1, code: "code", value: "value" }],
                            },
                        ],
                    },
                    a_la_carte_enabled: true,
                    common_tat_days: 1,
                    worst_case_tat_days: 1,
                    is_orderable: true,
                    expected_results: [
                        {
                            id: 1,
                            name: "Hemoglobin A1c",
                            slug: "hemoglobin-a1c",
                            lab_id: 1,
                            provider_id: "1234",
                            required: true,
                            loinc: {
                                id: 1,
                                name: "HbA1c (Bld) [Mass fraction]",
                                slug: "hba1c-bld-mass-fraction",
                                code: "4548-4",
                                unit: "%",
                            },
                        },
                    ],
                },
            ],
            total: 1,
            page: 1,
            size: 1,
            pages: 1,
        };
        server
            .mockEndpoint()
            .post("/v3/lab_tests/list_order_set_markers")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.labTests.getMarkersForOrderSet({
            page: 1,
            size: 1,
            body: {},
        });
        expect(response).toEqual({
            markers: [
                {
                    id: 1,
                    name: "Hemoglobin A1c",
                    slug: "hemoglobin-a1c",
                    description:
                        "Hemoglobin A1c is a form of hemoglobin that is measured identify your average blood sugar levels over the past 3 months.",
                    labId: 1,
                    providerId: "1234",
                    type: "biomarker",
                    unit: "%",
                    price: "10.00",
                    aoe: {
                        questions: [
                            {
                                id: 1000000,
                                required: true,
                                code: "code",
                                value: "value",
                                type: "choice",
                                sequence: 1,
                                answers: [
                                    {
                                        id: 1,
                                        code: "code",
                                        value: "value",
                                    },
                                ],
                            },
                        ],
                    },
                    aLaCarteEnabled: true,
                    commonTatDays: 1,
                    worstCaseTatDays: 1,
                    isOrderable: true,
                    expectedResults: [
                        {
                            id: 1,
                            name: "Hemoglobin A1c",
                            slug: "hemoglobin-a1c",
                            labId: 1,
                            providerId: "1234",
                            required: true,
                            loinc: {
                                id: 1,
                                name: "HbA1c (Bld) [Mass fraction]",
                                slug: "hba1c-bld-mass-fraction",
                                code: "4548-4",
                                unit: "%",
                            },
                        },
                    ],
                },
            ],
            total: 1,
            page: 1,
            size: 1,
            pages: 1,
        });
    });

    test("get_markers_for_order_set (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {};
        const rawResponseBody = {};
        server
            .mockEndpoint()
            .post("/v3/lab_tests/list_order_set_markers")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(422)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.labTests.getMarkersForOrderSet({
                body: {},
            });
        }).rejects.toThrow(Vital.UnprocessableEntityError);
    });

    test("get_markers_for_lab_test (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            markers: [
                {
                    id: 1,
                    name: "Hemoglobin A1c",
                    slug: "hemoglobin-a1c",
                    description:
                        "Hemoglobin A1c is a form of hemoglobin that is measured identify your average blood sugar levels over the past 3 months.",
                    lab_id: 1,
                    provider_id: "1234",
                    type: "biomarker",
                    unit: "%",
                    price: "10.00",
                    aoe: {
                        questions: [
                            {
                                id: 1000000,
                                required: true,
                                code: "code",
                                value: "value",
                                type: "choice",
                                sequence: 1,
                                answers: [{ id: 1, code: "code", value: "value" }],
                            },
                        ],
                    },
                    a_la_carte_enabled: true,
                    common_tat_days: 1,
                    worst_case_tat_days: 1,
                    is_orderable: true,
                    expected_results: [
                        {
                            id: 1,
                            name: "Hemoglobin A1c",
                            slug: "hemoglobin-a1c",
                            lab_id: 1,
                            provider_id: "1234",
                            required: true,
                            loinc: {
                                id: 1,
                                name: "HbA1c (Bld) [Mass fraction]",
                                slug: "hba1c-bld-mass-fraction",
                                code: "4548-4",
                                unit: "%",
                            },
                        },
                    ],
                },
            ],
            total: 1,
            page: 1,
            size: 1,
            pages: 1,
        };
        server
            .mockEndpoint()
            .get("/v3/lab_tests/lab_test_id/markers")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.labTests.getMarkersForLabTest("lab_test_id", {
            labAccountId: "lab_account_id",
            page: 1,
            size: 1,
        });
        expect(response).toEqual({
            markers: [
                {
                    id: 1,
                    name: "Hemoglobin A1c",
                    slug: "hemoglobin-a1c",
                    description:
                        "Hemoglobin A1c is a form of hemoglobin that is measured identify your average blood sugar levels over the past 3 months.",
                    labId: 1,
                    providerId: "1234",
                    type: "biomarker",
                    unit: "%",
                    price: "10.00",
                    aoe: {
                        questions: [
                            {
                                id: 1000000,
                                required: true,
                                code: "code",
                                value: "value",
                                type: "choice",
                                sequence: 1,
                                answers: [
                                    {
                                        id: 1,
                                        code: "code",
                                        value: "value",
                                    },
                                ],
                            },
                        ],
                    },
                    aLaCarteEnabled: true,
                    commonTatDays: 1,
                    worstCaseTatDays: 1,
                    isOrderable: true,
                    expectedResults: [
                        {
                            id: 1,
                            name: "Hemoglobin A1c",
                            slug: "hemoglobin-a1c",
                            labId: 1,
                            providerId: "1234",
                            required: true,
                            loinc: {
                                id: 1,
                                name: "HbA1c (Bld) [Mass fraction]",
                                slug: "hba1c-bld-mass-fraction",
                                code: "4548-4",
                                unit: "%",
                            },
                        },
                    ],
                },
            ],
            total: 1,
            page: 1,
            size: 1,
            pages: 1,
        });
    });

    test("get_markers_for_lab_test (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {};
        server
            .mockEndpoint()
            .get("/v3/lab_tests/lab_test_id/markers")
            .respondWith()
            .statusCode(422)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.labTests.getMarkersForLabTest("lab_test_id");
        }).rejects.toThrow(Vital.UnprocessableEntityError);
    });

    test("get_markers_by_lab_and_provider_id (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            id: 1,
            name: "Hemoglobin A1c",
            slug: "hemoglobin-a1c",
            description:
                "Hemoglobin A1c is a form of hemoglobin that is measured identify your average blood sugar levels over the past 3 months.",
            lab_id: 1,
            provider_id: "1234",
            type: "biomarker",
            unit: "%",
            price: "10.00",
            aoe: {
                questions: [
                    {
                        id: 1,
                        required: true,
                        code: "question_code",
                        value: "question_value",
                        type: "choice",
                        sequence: 1,
                        answers: [{ id: 1, code: "answer_code", value: "answer_value" }],
                    },
                ],
            },
            a_la_carte_enabled: true,
            common_tat_days: 3,
            worst_case_tat_days: 5,
            is_orderable: true,
        };
        server
            .mockEndpoint()
            .get("/v3/lab_tests/1/markers/provider_id")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.labTests.getMarkersByLabAndProviderId(1, "provider_id", {
            labAccountId: "lab_account_id",
        });
        expect(response).toEqual({
            id: 1,
            name: "Hemoglobin A1c",
            slug: "hemoglobin-a1c",
            description:
                "Hemoglobin A1c is a form of hemoglobin that is measured identify your average blood sugar levels over the past 3 months.",
            labId: 1,
            providerId: "1234",
            type: "biomarker",
            unit: "%",
            price: "10.00",
            aoe: {
                questions: [
                    {
                        id: 1,
                        required: true,
                        code: "question_code",
                        value: "question_value",
                        type: "choice",
                        sequence: 1,
                        answers: [
                            {
                                id: 1,
                                code: "answer_code",
                                value: "answer_value",
                            },
                        ],
                    },
                ],
            },
            aLaCarteEnabled: true,
            commonTatDays: 3,
            worstCaseTatDays: 5,
            isOrderable: true,
        });
    });

    test("get_markers_by_lab_and_provider_id (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {};
        server
            .mockEndpoint()
            .get("/v3/lab_tests/1/markers/provider_id")
            .respondWith()
            .statusCode(422)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.labTests.getMarkersByLabAndProviderId(1, "provider_id");
        }).rejects.toThrow(Vital.UnprocessableEntityError);
    });

    test("get_labs", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = [
            {
                id: 1,
                slug: "labcorp",
                name: "LabCorp",
                first_line_address: "123 Main St",
                city: "San Francisco",
                zipcode: "91789",
                collection_methods: ["testkit"],
                sample_types: ["saliva"],
            },
        ];
        server.mockEndpoint().get("/v3/lab_tests/labs").respondWith().statusCode(200).jsonBody(rawResponseBody).build();

        const response = await client.labTests.getLabs();
        expect(response).toEqual([
            {
                id: 1,
                slug: "labcorp",
                name: "LabCorp",
                firstLineAddress: "123 Main St",
                city: "San Francisco",
                zipcode: "91789",
                collectionMethods: ["testkit"],
                sampleTypes: ["saliva"],
            },
        ]);
    });

    test("get_paginated (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            data: [
                {
                    id: "id",
                    slug: "slug",
                    name: "name",
                    sample_type: "dried_blood_spot",
                    method: "testkit",
                    price: 1.1,
                    is_active: true,
                    status: "active",
                    fasting: true,
                    lab: {
                        id: 1,
                        slug: "labcorp",
                        name: "LabCorp",
                        first_line_address: "123 Main St",
                        city: "San Francisco",
                        zipcode: "91789",
                        collection_methods: ["testkit"],
                        sample_types: ["saliva"],
                    },
                    markers: [
                        {
                            id: 1,
                            name: "Hemoglobin A1c",
                            slug: "hemoglobin-a1c",
                            description:
                                "Hemoglobin A1c is a form of hemoglobin that is measured identify your average blood sugar levels over the past 3 months.",
                            lab_id: 1,
                            provider_id: "1234",
                            type: "biomarker",
                            unit: "%",
                            price: "10.00",
                            aoe: {
                                questions: [
                                    {
                                        id: 1,
                                        required: true,
                                        code: "question_code",
                                        value: "question_value",
                                        type: "choice",
                                        sequence: 1,
                                        answers: [{ id: 1, code: "answer_code", value: "answer_value" }],
                                    },
                                ],
                            },
                            common_tat_days: 3,
                            worst_case_tat_days: 5,
                            is_orderable: true,
                        },
                    ],
                    auto_generated: true,
                    has_collection_instructions: true,
                    common_tat_days: 1,
                    worst_case_tat_days: 1,
                },
            ],
            next_cursor: "next_cursor",
        };
        server.mockEndpoint().get("/v3/lab_test").respondWith().statusCode(200).jsonBody(rawResponseBody).build();

        const response = await client.labTests.getPaginated({
            labTestLimit: 1,
            nextCursor: "next_cursor",
            generationMethod: "auto",
            labSlug: "lab_slug",
            collectionMethod: "testkit",
            status: "active",
            name: "name",
            orderKey: "price",
            orderDirection: "asc",
        });
        expect(response).toEqual({
            data: [
                {
                    id: "id",
                    slug: "slug",
                    name: "name",
                    sampleType: "dried_blood_spot",
                    method: "testkit",
                    price: 1.1,
                    isActive: true,
                    status: "active",
                    fasting: true,
                    lab: {
                        id: 1,
                        slug: "labcorp",
                        name: "LabCorp",
                        firstLineAddress: "123 Main St",
                        city: "San Francisco",
                        zipcode: "91789",
                        collectionMethods: ["testkit"],
                        sampleTypes: ["saliva"],
                    },
                    markers: [
                        {
                            id: 1,
                            name: "Hemoglobin A1c",
                            slug: "hemoglobin-a1c",
                            description:
                                "Hemoglobin A1c is a form of hemoglobin that is measured identify your average blood sugar levels over the past 3 months.",
                            labId: 1,
                            providerId: "1234",
                            type: "biomarker",
                            unit: "%",
                            price: "10.00",
                            aoe: {
                                questions: [
                                    {
                                        id: 1,
                                        required: true,
                                        code: "question_code",
                                        value: "question_value",
                                        type: "choice",
                                        sequence: 1,
                                        answers: [
                                            {
                                                id: 1,
                                                code: "answer_code",
                                                value: "answer_value",
                                            },
                                        ],
                                    },
                                ],
                            },
                            commonTatDays: 3,
                            worstCaseTatDays: 5,
                            isOrderable: true,
                        },
                    ],
                    autoGenerated: true,
                    hasCollectionInstructions: true,
                    commonTatDays: 1,
                    worstCaseTatDays: 1,
                },
            ],
            nextCursor: "next_cursor",
        });
    });

    test("get_paginated (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {};
        server.mockEndpoint().get("/v3/lab_test").respondWith().statusCode(422).jsonBody(rawResponseBody).build();

        await expect(async () => {
            return await client.labTests.getPaginated();
        }).rejects.toThrow(Vital.UnprocessableEntityError);
    });

    test("get_orders (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            orders: [
                {
                    user_id: "03f79f9d-cd35-4db4-b7d7-2906437ce160",
                    id: "416d4a99-806d-4344-bee7-ef870bb89290",
                    team_id: "9e294e75-521a-4605-9a25-d14f8ea9ac9a",
                    patient_details: { dob: "2020-01-01T00:00:00Z", gender: "male" },
                    patient_address: {
                        receiver_name: "John Doe",
                        first_line: "123 Main St.",
                        second_line: "Apt. 208",
                        city: "San Francisco",
                        state: "CA",
                        zip: "91189",
                        country: "United States",
                        phone_number: "+11234567890",
                    },
                    lab_test: {
                        id: "id",
                        slug: "slug",
                        name: "Lipids Panel",
                        sample_type: "dried_blood_spot",
                        method: "testkit",
                        price: 1.1,
                        is_active: true,
                        status: "active",
                        lab: {
                            id: 1,
                            slug: "labcorp",
                            name: "LabCorp",
                            first_line_address: "123 Main St",
                            city: "San Francisco",
                            zipcode: "91789",
                            collection_methods: ["testkit"],
                            sample_types: ["saliva"],
                        },
                        markers: [
                            {
                                id: 1,
                                name: "Hemoglobin A1c",
                                slug: "hemoglobin-a1c",
                                description:
                                    "Hemoglobin A1c is a form of hemoglobin that is measured identify your average blood sugar levels over the past 3 months.",
                                lab_id: 1,
                                provider_id: "1234",
                                type: "biomarker",
                                unit: "%",
                                price: "10.00",
                                aoe: {
                                    questions: [
                                        {
                                            id: 1,
                                            required: true,
                                            code: "question_code",
                                            value: "question_value",
                                            type: "choice",
                                            sequence: 1,
                                            answers: [{ id: 1, code: "answer_code", value: "answer_value" }],
                                        },
                                    ],
                                },
                                common_tat_days: 3,
                                worst_case_tat_days: 5,
                                is_orderable: true,
                            },
                        ],
                    },
                    details: {
                        type: "testkit",
                        data: {
                            id: "9e9b00fa-3c2b-4d6a-b0d5-a532d5f83f15",
                            shipment: {
                                id: "4008ec17-bab6-4f57-b0cb-40572a484b42",
                                outbound_tracking_number: "<outbound_tracking_number>",
                                outbound_tracking_url: "<outbound_tracking_url>",
                                inbound_tracking_number: "<inbound_tracking_number>",
                                inbound_tracking_url: "<inbound_tracking_url>",
                                outbound_courier: "usps",
                                inbound_courier: "usps",
                                notes: "<notes>",
                            },
                            created_at: "2020-01-01T00:00:00Z",
                            updated_at: "2020-01-01T00:00:00Z",
                        },
                    },
                    sample_id: "123456789",
                    notes: "This is a note",
                    created_at: "2020-01-01T00:00:00Z",
                    updated_at: "2020-01-01T00:00:00Z",
                    events: [
                        { id: 1, created_at: "2022-01-01T00:00:00Z", status: "received.testkit.ordered" },
                        { id: 2, created_at: "2022-01-02T00:00:00Z", status: "received.testkit.requisition_created" },
                        {
                            id: 3,
                            created_at: "2022-01-03T00:00:00Z",
                            status: "collecting_sample.testkit.transit_customer",
                        },
                    ],
                    status: "collecting_sample",
                    physician: { first_name: "first_name", last_name: "last_name", npi: "npi" },
                    health_insurance_id: "health_insurance_id",
                    requisition_form_url: "https://www.example.com",
                    priority: true,
                    shipping_details: {
                        receiver_name: "receiver_name",
                        first_line: "first_line",
                        city: "city",
                        state: "state",
                        zip: "zip",
                        country: "country",
                        phone_number: "phone_number",
                    },
                    activate_by: "2020-01-01",
                    passthrough: "passthrough",
                    billing_type: "client_bill",
                    icd_codes: ["icd_codes"],
                    has_abn: false,
                    interpretation: "normal",
                    has_missing_results: true,
                    expected_result_by_date: "expected_result_by_date",
                    worst_case_result_by_date: "worst_case_result_by_date",
                },
            ],
            total: 1,
            page: 1,
            size: 1,
        };
        server.mockEndpoint().get("/v3/orders").respondWith().statusCode(200).jsonBody(rawResponseBody).build();

        const response = await client.labTests.getOrders({
            searchInput: "search_input",
            startDate: new Date("2024-01-15T09:30:00.000Z"),
            endDate: new Date("2024-01-15T09:30:00.000Z"),
            updatedStartDate: new Date("2024-01-15T09:30:00.000Z"),
            updatedEndDate: new Date("2024-01-15T09:30:00.000Z"),
            orderKey: "created_at",
            orderDirection: "asc",
            isCritical: true,
            interpretation: "normal",
            userId: "user_id",
            patientName: "patient_name",
            shippingRecipientName: "shipping_recipient_name",
            page: 1,
            size: 1,
        });
        expect(response).toEqual({
            orders: [
                {
                    userId: "03f79f9d-cd35-4db4-b7d7-2906437ce160",
                    id: "416d4a99-806d-4344-bee7-ef870bb89290",
                    teamId: "9e294e75-521a-4605-9a25-d14f8ea9ac9a",
                    patientDetails: {
                        dob: new Date("2020-01-01T00:00:00.000Z"),
                        gender: "male",
                    },
                    patientAddress: {
                        receiverName: "John Doe",
                        firstLine: "123 Main St.",
                        secondLine: "Apt. 208",
                        city: "San Francisco",
                        state: "CA",
                        zip: "91189",
                        country: "United States",
                        phoneNumber: "+11234567890",
                    },
                    labTest: {
                        id: "id",
                        slug: "slug",
                        name: "Lipids Panel",
                        sampleType: "dried_blood_spot",
                        method: "testkit",
                        price: 1.1,
                        isActive: true,
                        status: "active",
                        lab: {
                            id: 1,
                            slug: "labcorp",
                            name: "LabCorp",
                            firstLineAddress: "123 Main St",
                            city: "San Francisco",
                            zipcode: "91789",
                            collectionMethods: ["testkit"],
                            sampleTypes: ["saliva"],
                        },
                        markers: [
                            {
                                id: 1,
                                name: "Hemoglobin A1c",
                                slug: "hemoglobin-a1c",
                                description:
                                    "Hemoglobin A1c is a form of hemoglobin that is measured identify your average blood sugar levels over the past 3 months.",
                                labId: 1,
                                providerId: "1234",
                                type: "biomarker",
                                unit: "%",
                                price: "10.00",
                                aoe: {
                                    questions: [
                                        {
                                            id: 1,
                                            required: true,
                                            code: "question_code",
                                            value: "question_value",
                                            type: "choice",
                                            sequence: 1,
                                            answers: [
                                                {
                                                    id: 1,
                                                    code: "answer_code",
                                                    value: "answer_value",
                                                },
                                            ],
                                        },
                                    ],
                                },
                                commonTatDays: 3,
                                worstCaseTatDays: 5,
                                isOrderable: true,
                            },
                        ],
                    },
                    details: {
                        type: "testkit",
                        data: {
                            id: "9e9b00fa-3c2b-4d6a-b0d5-a532d5f83f15",
                            shipment: {
                                id: "4008ec17-bab6-4f57-b0cb-40572a484b42",
                                outboundTrackingNumber: "<outbound_tracking_number>",
                                outboundTrackingUrl: "<outbound_tracking_url>",
                                inboundTrackingNumber: "<inbound_tracking_number>",
                                inboundTrackingUrl: "<inbound_tracking_url>",
                                outboundCourier: "usps",
                                inboundCourier: "usps",
                                notes: "<notes>",
                            },
                            createdAt: new Date("2020-01-01T00:00:00.000Z"),
                            updatedAt: new Date("2020-01-01T00:00:00.000Z"),
                        },
                    },
                    sampleId: "123456789",
                    notes: "This is a note",
                    createdAt: new Date("2020-01-01T00:00:00.000Z"),
                    updatedAt: new Date("2020-01-01T00:00:00.000Z"),
                    events: [
                        {
                            id: 1,
                            createdAt: new Date("2022-01-01T00:00:00.000Z"),
                            status: "received.testkit.ordered",
                        },
                        {
                            id: 2,
                            createdAt: new Date("2022-01-02T00:00:00.000Z"),
                            status: "received.testkit.requisition_created",
                        },
                        {
                            id: 3,
                            createdAt: new Date("2022-01-03T00:00:00.000Z"),
                            status: "collecting_sample.testkit.transit_customer",
                        },
                    ],
                    status: "collecting_sample",
                    physician: {
                        firstName: "first_name",
                        lastName: "last_name",
                        npi: "npi",
                    },
                    healthInsuranceId: "health_insurance_id",
                    requisitionFormUrl: "https://www.example.com",
                    priority: true,
                    shippingDetails: {
                        receiverName: "receiver_name",
                        firstLine: "first_line",
                        city: "city",
                        state: "state",
                        zip: "zip",
                        country: "country",
                        phoneNumber: "phone_number",
                    },
                    activateBy: "2020-01-01",
                    passthrough: "passthrough",
                    billingType: "client_bill",
                    icdCodes: ["icd_codes"],
                    hasAbn: false,
                    interpretation: "normal",
                    hasMissingResults: true,
                    expectedResultByDate: "expected_result_by_date",
                    worstCaseResultByDate: "worst_case_result_by_date",
                },
            ],
            total: 1,
            page: 1,
            size: 1,
        });
    });

    test("get_orders (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {};
        server.mockEndpoint().get("/v3/orders").respondWith().statusCode(422).jsonBody(rawResponseBody).build();

        await expect(async () => {
            return await client.labTests.getOrders();
        }).rejects.toThrow(Vital.UnprocessableEntityError);
    });

    test("get_phlebotomy_appointment_availability (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { first_line: "first_line", city: "city", state: "state", zip_code: "zip_code" };
        const rawResponseBody = {
            slots: [
                {
                    location: {
                        location: { lng: 1.1, lat: 1.1 },
                        address: { first_line: "first_line", city: "city", state: "state", zip_code: "zip_code" },
                        code: "code",
                        name: "name",
                    },
                    date: "date",
                    slots: [
                        {
                            start: "2024-01-15T09:30:00Z",
                            end: "2024-01-15T09:30:00Z",
                            price: 1.1,
                            is_priority: true,
                            num_appointments_available: 1,
                        },
                    ],
                },
            ],
            timezone: "timezone",
        };
        server
            .mockEndpoint()
            .post("/v3/order/phlebotomy/appointment/availability")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.labTests.getPhlebotomyAppointmentAvailability({
            startDate: "start_date",
            body: {
                firstLine: "first_line",
                city: "city",
                state: "state",
                zipCode: "zip_code",
            },
        });
        expect(response).toEqual({
            slots: [
                {
                    location: {
                        location: {
                            lng: 1.1,
                            lat: 1.1,
                        },
                        address: {
                            firstLine: "first_line",
                            city: "city",
                            state: "state",
                            zipCode: "zip_code",
                        },
                        code: "code",
                        name: "name",
                    },
                    date: "date",
                    slots: [
                        {
                            start: new Date("2024-01-15T09:30:00.000Z"),
                            end: new Date("2024-01-15T09:30:00.000Z"),
                            price: 1.1,
                            isPriority: true,
                            numAppointmentsAvailable: 1,
                        },
                    ],
                },
            ],
            timezone: "timezone",
        });
    });

    test("get_phlebotomy_appointment_availability (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { first_line: "first_line", city: "city", state: "state", zip_code: "zip_code" };
        const rawResponseBody = {};
        server
            .mockEndpoint()
            .post("/v3/order/phlebotomy/appointment/availability")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(422)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.labTests.getPhlebotomyAppointmentAvailability({
                body: {
                    firstLine: "first_line",
                    city: "city",
                    state: "state",
                    zipCode: "zip_code",
                },
            });
        }).rejects.toThrow(Vital.UnprocessableEntityError);
    });

    test("book_phlebotomy_appointment (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { booking_key: "booking_key" };
        const rawResponseBody = {
            id: "44b10199-41d1-491b-b037-833ed1ac5d89",
            user_id: "338d1565-3e30-40de-aad2-d71cfce693f8",
            order_id: "1c1be546-c9d8-4913-8c2f-2b199257d053",
            address: {
                first_line: "123 Main St.",
                second_line: "Apt. 208",
                city: "San Francisco",
                state: "CA",
                zip_code: "91189",
                unit: "unit",
            },
            location: { lng: -122.4194155, lat: 37.7749295 },
            start_at: "2022-01-01T00:00:00Z",
            end_at: "2022-01-01T00:00:00Z",
            iana_timezone: "America/New_York",
            type: "phlebotomy",
            provider: "getlabs",
            status: "confirmed",
            provider_id: "123",
            external_id: "ext-123",
            can_reschedule: true,
            event_status: "scheduled",
            event_data: {
                description: "Metadata field containing provider specific data, like cancellation reason or origin",
            },
            events: [
                { created_at: "2022-01-01T00:00:00Z", status: "scheduled", data: { key: "value" } },
                { created_at: "2022-01-02T00:00:00Z", status: "completed", data: { key: "value" } },
            ],
        };
        server
            .mockEndpoint()
            .post("/v3/order/order_id/phlebotomy/appointment/book")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.labTests.bookPhlebotomyAppointment("order_id", {
            bookingKey: "booking_key",
        });
        expect(response).toEqual({
            id: "44b10199-41d1-491b-b037-833ed1ac5d89",
            userId: "338d1565-3e30-40de-aad2-d71cfce693f8",
            orderId: "1c1be546-c9d8-4913-8c2f-2b199257d053",
            address: {
                firstLine: "123 Main St.",
                secondLine: "Apt. 208",
                city: "San Francisco",
                state: "CA",
                zipCode: "91189",
                unit: "unit",
            },
            location: {
                lng: -122.4194155,
                lat: 37.7749295,
            },
            startAt: new Date("2022-01-01T00:00:00.000Z"),
            endAt: new Date("2022-01-01T00:00:00.000Z"),
            ianaTimezone: "America/New_York",
            type: "phlebotomy",
            provider: "getlabs",
            status: "confirmed",
            providerId: "123",
            externalId: "ext-123",
            canReschedule: true,
            eventStatus: "scheduled",
            eventData: {
                description: "Metadata field containing provider specific data, like cancellation reason or origin",
            },
            events: [
                {
                    createdAt: new Date("2022-01-01T00:00:00.000Z"),
                    status: "scheduled",
                    data: {
                        key: "value",
                    },
                },
                {
                    createdAt: new Date("2022-01-02T00:00:00.000Z"),
                    status: "completed",
                    data: {
                        key: "value",
                    },
                },
            ],
        });
    });

    test("book_phlebotomy_appointment (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { booking_key: "booking_key" };
        const rawResponseBody = {};
        server
            .mockEndpoint()
            .post("/v3/order/order_id/phlebotomy/appointment/book")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(422)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.labTests.bookPhlebotomyAppointment("order_id", {
                bookingKey: "booking_key",
            });
        }).rejects.toThrow(Vital.UnprocessableEntityError);
    });

    test("request_phlebotomy_appointment (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {
            address: { first_line: "first_line", city: "city", state: "state", zip_code: "zip_code" },
            provider: "getlabs",
        };
        const rawResponseBody = {
            id: "ede16978-09c4-4b9c-a41b-491142e09f94",
            user_id: "38326bfc-7e84-4315-9624-8a23e910daba",
            order_id: "d9dd2a78-a6f6-4ba1-95d2-5e37cfd2c8d6",
            address: {
                first_line: "123 Main St.",
                second_line: "Apt. 208",
                city: "San Francisco",
                state: "CA",
                zip_code: "91189",
                unit: "unit",
            },
            location: { lng: -122.4194155, lat: 37.7749295 },
            start_at: "2024-01-15T09:30:00Z",
            end_at: "2024-01-15T09:30:00Z",
            iana_timezone: "iana_timezone",
            type: "phlebotomy",
            provider: "phlebfinders",
            status: "pending",
            provider_id: "123",
            external_id: "external_id",
            can_reschedule: false,
            event_status: "pending",
            event_data: {
                description: "Metadata field containing provider specific data, like cancellation reason or origin",
            },
            events: [{ created_at: "2022-01-01T00:00:00Z", status: "pending", data: { key: "value" } }],
        };
        server
            .mockEndpoint()
            .post("/v3/order/order_id/phlebotomy/appointment/request")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.labTests.requestPhlebotomyAppointment("order_id", {
            address: {
                firstLine: "first_line",
                city: "city",
                state: "state",
                zipCode: "zip_code",
            },
            provider: "getlabs",
        });
        expect(response).toEqual({
            id: "ede16978-09c4-4b9c-a41b-491142e09f94",
            userId: "38326bfc-7e84-4315-9624-8a23e910daba",
            orderId: "d9dd2a78-a6f6-4ba1-95d2-5e37cfd2c8d6",
            address: {
                firstLine: "123 Main St.",
                secondLine: "Apt. 208",
                city: "San Francisco",
                state: "CA",
                zipCode: "91189",
                unit: "unit",
            },
            location: {
                lng: -122.4194155,
                lat: 37.7749295,
            },
            startAt: new Date("2024-01-15T09:30:00.000Z"),
            endAt: new Date("2024-01-15T09:30:00.000Z"),
            ianaTimezone: "iana_timezone",
            type: "phlebotomy",
            provider: "phlebfinders",
            status: "pending",
            providerId: "123",
            externalId: "external_id",
            canReschedule: false,
            eventStatus: "pending",
            eventData: {
                description: "Metadata field containing provider specific data, like cancellation reason or origin",
            },
            events: [
                {
                    createdAt: new Date("2022-01-01T00:00:00.000Z"),
                    status: "pending",
                    data: {
                        key: "value",
                    },
                },
            ],
        });
    });

    test("request_phlebotomy_appointment (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {
            address: { first_line: "first_line", city: "city", state: "state", zip_code: "zip_code" },
            provider: "getlabs",
        };
        const rawResponseBody = {};
        server
            .mockEndpoint()
            .post("/v3/order/order_id/phlebotomy/appointment/request")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(422)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.labTests.requestPhlebotomyAppointment("order_id", {
                address: {
                    firstLine: "first_line",
                    city: "city",
                    state: "state",
                    zipCode: "zip_code",
                },
                provider: "getlabs",
            });
        }).rejects.toThrow(Vital.UnprocessableEntityError);
    });

    test("reschedule_phlebotomy_appointment (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { booking_key: "booking_key" };
        const rawResponseBody = {
            id: "44b10199-41d1-491b-b037-833ed1ac5d89",
            user_id: "338d1565-3e30-40de-aad2-d71cfce693f8",
            order_id: "1c1be546-c9d8-4913-8c2f-2b199257d053",
            address: {
                first_line: "123 Main St.",
                second_line: "Apt. 208",
                city: "San Francisco",
                state: "CA",
                zip_code: "91189",
                unit: "unit",
            },
            location: { lng: -122.4194155, lat: 37.7749295 },
            start_at: "2022-01-01T00:00:00Z",
            end_at: "2022-01-01T00:00:00Z",
            iana_timezone: "America/New_York",
            type: "phlebotomy",
            provider: "getlabs",
            status: "confirmed",
            provider_id: "123",
            external_id: "ext-123",
            can_reschedule: true,
            event_status: "scheduled",
            event_data: {
                description: "Metadata field containing provider specific data, like cancellation reason or origin",
            },
            events: [
                { created_at: "2022-01-01T00:00:00Z", status: "scheduled", data: { key: "value" } },
                { created_at: "2022-01-02T00:00:00Z", status: "completed", data: { key: "value" } },
            ],
        };
        server
            .mockEndpoint()
            .patch("/v3/order/order_id/phlebotomy/appointment/reschedule")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.labTests.reschedulePhlebotomyAppointment("order_id", {
            bookingKey: "booking_key",
        });
        expect(response).toEqual({
            id: "44b10199-41d1-491b-b037-833ed1ac5d89",
            userId: "338d1565-3e30-40de-aad2-d71cfce693f8",
            orderId: "1c1be546-c9d8-4913-8c2f-2b199257d053",
            address: {
                firstLine: "123 Main St.",
                secondLine: "Apt. 208",
                city: "San Francisco",
                state: "CA",
                zipCode: "91189",
                unit: "unit",
            },
            location: {
                lng: -122.4194155,
                lat: 37.7749295,
            },
            startAt: new Date("2022-01-01T00:00:00.000Z"),
            endAt: new Date("2022-01-01T00:00:00.000Z"),
            ianaTimezone: "America/New_York",
            type: "phlebotomy",
            provider: "getlabs",
            status: "confirmed",
            providerId: "123",
            externalId: "ext-123",
            canReschedule: true,
            eventStatus: "scheduled",
            eventData: {
                description: "Metadata field containing provider specific data, like cancellation reason or origin",
            },
            events: [
                {
                    createdAt: new Date("2022-01-01T00:00:00.000Z"),
                    status: "scheduled",
                    data: {
                        key: "value",
                    },
                },
                {
                    createdAt: new Date("2022-01-02T00:00:00.000Z"),
                    status: "completed",
                    data: {
                        key: "value",
                    },
                },
            ],
        });
    });

    test("reschedule_phlebotomy_appointment (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { booking_key: "booking_key" };
        const rawResponseBody = {};
        server
            .mockEndpoint()
            .patch("/v3/order/order_id/phlebotomy/appointment/reschedule")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(422)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.labTests.reschedulePhlebotomyAppointment("order_id", {
                bookingKey: "booking_key",
            });
        }).rejects.toThrow(Vital.UnprocessableEntityError);
    });

    test("cancel_phlebotomy_appointment (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { cancellation_reason_id: "cancellation_reason_id" };
        const rawResponseBody = {
            id: "44b10199-41d1-491b-b037-833ed1ac5d89",
            user_id: "338d1565-3e30-40de-aad2-d71cfce693f8",
            order_id: "1c1be546-c9d8-4913-8c2f-2b199257d053",
            address: {
                first_line: "123 Main St.",
                second_line: "Apt. 208",
                city: "San Francisco",
                state: "CA",
                zip_code: "91189",
                unit: "unit",
            },
            location: { lng: -122.4194155, lat: 37.7749295 },
            start_at: "2022-01-01T00:00:00Z",
            end_at: "2022-01-01T00:00:00Z",
            iana_timezone: "America/New_York",
            type: "phlebotomy",
            provider: "getlabs",
            status: "confirmed",
            provider_id: "123",
            external_id: "ext-123",
            can_reschedule: true,
            event_status: "scheduled",
            event_data: {
                description: "Metadata field containing provider specific data, like cancellation reason or origin",
            },
            events: [
                { created_at: "2022-01-01T00:00:00Z", status: "scheduled", data: { key: "value" } },
                { created_at: "2022-01-02T00:00:00Z", status: "completed", data: { key: "value" } },
            ],
        };
        server
            .mockEndpoint()
            .patch("/v3/order/order_id/phlebotomy/appointment/cancel")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.labTests.cancelPhlebotomyAppointment("order_id", {
            cancellationReasonId: "cancellation_reason_id",
        });
        expect(response).toEqual({
            id: "44b10199-41d1-491b-b037-833ed1ac5d89",
            userId: "338d1565-3e30-40de-aad2-d71cfce693f8",
            orderId: "1c1be546-c9d8-4913-8c2f-2b199257d053",
            address: {
                firstLine: "123 Main St.",
                secondLine: "Apt. 208",
                city: "San Francisco",
                state: "CA",
                zipCode: "91189",
                unit: "unit",
            },
            location: {
                lng: -122.4194155,
                lat: 37.7749295,
            },
            startAt: new Date("2022-01-01T00:00:00.000Z"),
            endAt: new Date("2022-01-01T00:00:00.000Z"),
            ianaTimezone: "America/New_York",
            type: "phlebotomy",
            provider: "getlabs",
            status: "confirmed",
            providerId: "123",
            externalId: "ext-123",
            canReschedule: true,
            eventStatus: "scheduled",
            eventData: {
                description: "Metadata field containing provider specific data, like cancellation reason or origin",
            },
            events: [
                {
                    createdAt: new Date("2022-01-01T00:00:00.000Z"),
                    status: "scheduled",
                    data: {
                        key: "value",
                    },
                },
                {
                    createdAt: new Date("2022-01-02T00:00:00.000Z"),
                    status: "completed",
                    data: {
                        key: "value",
                    },
                },
            ],
        });
    });

    test("cancel_phlebotomy_appointment (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { cancellation_reason_id: "cancellation_reason_id" };
        const rawResponseBody = {};
        server
            .mockEndpoint()
            .patch("/v3/order/order_id/phlebotomy/appointment/cancel")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(422)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.labTests.cancelPhlebotomyAppointment("order_id", {
                cancellationReasonId: "cancellation_reason_id",
            });
        }).rejects.toThrow(Vital.UnprocessableEntityError);
    });

    test("get_phlebotomy_appointment_cancellation_reason", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = [
            { id: "f64aacbf-7cd3-41ac-be8a-eff0e17724a8", name: "I'm feeling sick", is_refundable: true },
        ];
        server
            .mockEndpoint()
            .get("/v3/order/phlebotomy/appointment/cancellation-reasons")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.labTests.getPhlebotomyAppointmentCancellationReason();
        expect(response).toEqual([
            {
                id: "f64aacbf-7cd3-41ac-be8a-eff0e17724a8",
                name: "I'm feeling sick",
                isRefundable: true,
            },
        ]);
    });

    test("get_phlebotomy_appointment (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            id: "44b10199-41d1-491b-b037-833ed1ac5d89",
            user_id: "338d1565-3e30-40de-aad2-d71cfce693f8",
            order_id: "1c1be546-c9d8-4913-8c2f-2b199257d053",
            address: {
                first_line: "123 Main St.",
                second_line: "Apt. 208",
                city: "San Francisco",
                state: "CA",
                zip_code: "91189",
                unit: "unit",
            },
            location: { lng: -122.4194155, lat: 37.7749295 },
            start_at: "2022-01-01T00:00:00Z",
            end_at: "2022-01-01T00:00:00Z",
            iana_timezone: "America/New_York",
            type: "phlebotomy",
            provider: "getlabs",
            status: "confirmed",
            provider_id: "123",
            external_id: "ext-123",
            can_reschedule: true,
            event_status: "scheduled",
            event_data: {
                description: "Metadata field containing provider specific data, like cancellation reason or origin",
            },
            events: [
                { created_at: "2022-01-01T00:00:00Z", status: "scheduled", data: { key: "value" } },
                { created_at: "2022-01-02T00:00:00Z", status: "completed", data: { key: "value" } },
            ],
        };
        server
            .mockEndpoint()
            .get("/v3/order/order_id/phlebotomy/appointment")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.labTests.getPhlebotomyAppointment("order_id");
        expect(response).toEqual({
            id: "44b10199-41d1-491b-b037-833ed1ac5d89",
            userId: "338d1565-3e30-40de-aad2-d71cfce693f8",
            orderId: "1c1be546-c9d8-4913-8c2f-2b199257d053",
            address: {
                firstLine: "123 Main St.",
                secondLine: "Apt. 208",
                city: "San Francisco",
                state: "CA",
                zipCode: "91189",
                unit: "unit",
            },
            location: {
                lng: -122.4194155,
                lat: 37.7749295,
            },
            startAt: new Date("2022-01-01T00:00:00.000Z"),
            endAt: new Date("2022-01-01T00:00:00.000Z"),
            ianaTimezone: "America/New_York",
            type: "phlebotomy",
            provider: "getlabs",
            status: "confirmed",
            providerId: "123",
            externalId: "ext-123",
            canReschedule: true,
            eventStatus: "scheduled",
            eventData: {
                description: "Metadata field containing provider specific data, like cancellation reason or origin",
            },
            events: [
                {
                    createdAt: new Date("2022-01-01T00:00:00.000Z"),
                    status: "scheduled",
                    data: {
                        key: "value",
                    },
                },
                {
                    createdAt: new Date("2022-01-02T00:00:00.000Z"),
                    status: "completed",
                    data: {
                        key: "value",
                    },
                },
            ],
        });
    });

    test("get_phlebotomy_appointment (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {};
        server
            .mockEndpoint()
            .get("/v3/order/order_id/phlebotomy/appointment")
            .respondWith()
            .statusCode(422)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.labTests.getPhlebotomyAppointment("order_id");
        }).rejects.toThrow(Vital.UnprocessableEntityError);
    });

    test("get_area_info (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            zip_code: "zip_code",
            phlebotomy: { is_served: true, providers: [{ name: "getlabs", service_types: ["appointment-ready"] }] },
            central_labs: {
                key: {
                    patient_service_centers: { appointment_with_vital: true, within_radius: 1, radius: "radius" },
                    supported_bill_types: ["client_bill"],
                    lab_id: 1,
                },
            },
        };
        server
            .mockEndpoint()
            .get("/v3/order/area/info")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.labTests.getAreaInfo({
            zipCode: "zip_code",
            radius: "10",
            lab: "quest",
            labAccountId: "lab_account_id",
        });
        expect(response).toEqual({
            zipCode: "zip_code",
            phlebotomy: {
                isServed: true,
                providers: [
                    {
                        name: "getlabs",
                        serviceTypes: ["appointment-ready"],
                    },
                ],
            },
            centralLabs: {
                key: {
                    patientServiceCenters: {
                        appointmentWithVital: true,
                        withinRadius: 1,
                        radius: "radius",
                    },
                    supportedBillTypes: ["client_bill"],
                    labId: 1,
                },
            },
        });
    });

    test("get_area_info (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {};
        server
            .mockEndpoint()
            .get("/v3/order/area/info")
            .respondWith()
            .statusCode(422)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.labTests.getAreaInfo({
                zipCode: "zip_code",
            });
        }).rejects.toThrow(Vital.UnprocessableEntityError);
    });

    test("get_psc_info (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            lab_id: 1,
            slug: "ayumetrix",
            patient_service_centers: [
                {
                    metadata: {
                        name: "name",
                        state: "state",
                        city: "city",
                        zip_code: "zip_code",
                        first_line: "first_line",
                    },
                    distance: 1,
                    site_code: "site_code",
                    supported_bill_types: ["client_bill"],
                    location: { lng: 1.1, lat: 1.1 },
                    capabilities: ["stat"],
                },
            ],
        };
        server.mockEndpoint().get("/v3/order/psc/info").respondWith().statusCode(200).jsonBody(rawResponseBody).build();

        const response = await client.labTests.getPscInfo({
            zipCode: "zip_code",
            labId: 1,
            radius: "10",
            labAccountId: "lab_account_id",
        });
        expect(response).toEqual({
            labId: 1,
            slug: "ayumetrix",
            patientServiceCenters: [
                {
                    metadata: {
                        name: "name",
                        state: "state",
                        city: "city",
                        zipCode: "zip_code",
                        firstLine: "first_line",
                    },
                    distance: 1,
                    siteCode: "site_code",
                    supportedBillTypes: ["client_bill"],
                    location: {
                        lng: 1.1,
                        lat: 1.1,
                    },
                    capabilities: ["stat"],
                },
            ],
        });
    });

    test("get_psc_info (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {};
        server.mockEndpoint().get("/v3/order/psc/info").respondWith().statusCode(422).jsonBody(rawResponseBody).build();

        await expect(async () => {
            return await client.labTests.getPscInfo({
                zipCode: "zip_code",
                labId: 1,
            });
        }).rejects.toThrow(Vital.UnprocessableEntityError);
    });

    test("get_order_psc_info (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            lab_id: 1,
            slug: "ayumetrix",
            patient_service_centers: [
                {
                    metadata: {
                        name: "name",
                        state: "state",
                        city: "city",
                        zip_code: "zip_code",
                        first_line: "first_line",
                    },
                    distance: 1,
                    site_code: "site_code",
                    supported_bill_types: ["client_bill"],
                    location: { lng: 1.1, lat: 1.1 },
                    capabilities: ["stat"],
                },
            ],
        };
        server
            .mockEndpoint()
            .get("/v3/order/order_id/psc/info")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.labTests.getOrderPscInfo("order_id", {
            radius: "10",
        });
        expect(response).toEqual({
            labId: 1,
            slug: "ayumetrix",
            patientServiceCenters: [
                {
                    metadata: {
                        name: "name",
                        state: "state",
                        city: "city",
                        zipCode: "zip_code",
                        firstLine: "first_line",
                    },
                    distance: 1,
                    siteCode: "site_code",
                    supportedBillTypes: ["client_bill"],
                    location: {
                        lng: 1.1,
                        lat: 1.1,
                    },
                    capabilities: ["stat"],
                },
            ],
        });
    });

    test("get_order_psc_info (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {};
        server
            .mockEndpoint()
            .get("/v3/order/order_id/psc/info")
            .respondWith()
            .statusCode(422)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.labTests.getOrderPscInfo("order_id");
        }).rejects.toThrow(Vital.UnprocessableEntityError);
    });

    test("get_result_metadata (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            age: "age",
            dob: "18/08/1993",
            "clia_#": "clia_#",
            patient: "Bob Smith",
            provider: "Dr. Jack Smith",
            laboratory: "Quest Diagnostics",
            date_reported: "2020-01-01",
            date_collected: "2022-02-02",
            specimen_number: "123131",
            date_received: "2022-01-01",
            status: "final",
            interpretation: "normal",
            patient_id: "patient_id",
            account_id: "account_id",
        };
        server
            .mockEndpoint()
            .get("/v3/order/order_id/result/metadata")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.labTests.getResultMetadata("order_id");
        expect(response).toEqual({
            age: "age",
            dob: "18/08/1993",
            clia: "clia_#",
            patient: "Bob Smith",
            provider: "Dr. Jack Smith",
            laboratory: "Quest Diagnostics",
            dateReported: "2020-01-01",
            dateCollected: "2022-02-02",
            specimenNumber: "123131",
            dateReceived: "2022-01-01",
            status: "final",
            interpretation: "normal",
            patientId: "patient_id",
            accountId: "account_id",
        });
    });

    test("get_result_metadata (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {};
        server
            .mockEndpoint()
            .get("/v3/order/order_id/result/metadata")
            .respondWith()
            .statusCode(422)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.labTests.getResultMetadata("order_id");
        }).rejects.toThrow(Vital.UnprocessableEntityError);
    });

    test("get_result_raw (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            metadata: {
                age: "age",
                dob: "18/08/1993",
                "clia_#": "clia_#",
                patient: "Bob Smith",
                provider: "Dr. Jack Smith",
                laboratory: "Quest Diagnostics",
                date_reported: "2020-01-01",
                date_collected: "2022-02-02",
                specimen_number: "123131",
                date_received: "2022-01-01",
                status: "final",
                interpretation: "normal",
                patient_id: "patient_id",
                account_id: "account_id",
            },
            results: [
                {
                    name: "Monocytes(Absolute)",
                    slug: "monocytes-absolute",
                    result: "0.4",
                    type: "numeric",
                    unit: "x10E3/uL",
                    timestamp: "2023-11-01T08:28:00Z",
                    notes: "Final",
                    reference_range: "reference_range",
                    min_range_value: 0.1,
                    max_range_value: 0.9,
                    is_above_max_range: false,
                    is_below_min_range: false,
                    interpretation: "normal",
                    loinc: "742-7",
                    loinc_slug: "monocytes-auto-bld-vol",
                    provider_id: "provider_id",
                    source_markers: [{ marker_id: 1, name: "name", slug: "slug" }],
                    performing_laboratory: "performing_laboratory",
                    source_sample_id: "source_sample_id",
                },
            ],
            missing_results: [
                {
                    name: "name",
                    slug: "slug",
                    inferred_failure_type: "quantity_not_sufficient_failure",
                    note: "note",
                    loinc: "loinc",
                    loinc_slug: "loinc_slug",
                    provider_id: "provider_id",
                    source_markers: [{ marker_id: 1, name: "name", slug: "slug" }],
                },
            ],
            sample_information: {
                key: {
                    sample_id: "sample_id",
                    control_number: "control_number",
                    date_collected: { timestamp: "2024-01-15T09:30:00Z", timezone_offset: 1 },
                    date_received: { timestamp: "2024-01-15T09:30:00Z", timezone_offset: 1 },
                    date_reported: { timestamp: "2024-01-15T09:30:00Z", timezone_offset: 1 },
                },
            },
        };
        server
            .mockEndpoint()
            .get("/v3/order/order_id/result")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.labTests.getResultRaw("order_id");
        expect(response).toEqual({
            metadata: {
                age: "age",
                dob: "18/08/1993",
                clia: "clia_#",
                patient: "Bob Smith",
                provider: "Dr. Jack Smith",
                laboratory: "Quest Diagnostics",
                dateReported: "2020-01-01",
                dateCollected: "2022-02-02",
                specimenNumber: "123131",
                dateReceived: "2022-01-01",
                status: "final",
                interpretation: "normal",
                patientId: "patient_id",
                accountId: "account_id",
            },
            results: [
                {
                    name: "Monocytes(Absolute)",
                    slug: "monocytes-absolute",
                    result: "0.4",
                    type: "numeric",
                    unit: "x10E3/uL",
                    timestamp: new Date("2023-11-01T08:28:00.000Z"),
                    notes: "Final",
                    referenceRange: "reference_range",
                    minRangeValue: 0.1,
                    maxRangeValue: 0.9,
                    isAboveMaxRange: false,
                    isBelowMinRange: false,
                    interpretation: "normal",
                    loinc: "742-7",
                    loincSlug: "monocytes-auto-bld-vol",
                    providerId: "provider_id",
                    sourceMarkers: [
                        {
                            markerId: 1,
                            name: "name",
                            slug: "slug",
                        },
                    ],
                    performingLaboratory: "performing_laboratory",
                    sourceSampleId: "source_sample_id",
                },
            ],
            missingResults: [
                {
                    name: "name",
                    slug: "slug",
                    inferredFailureType: "quantity_not_sufficient_failure",
                    note: "note",
                    loinc: "loinc",
                    loincSlug: "loinc_slug",
                    providerId: "provider_id",
                    sourceMarkers: [
                        {
                            markerId: 1,
                            name: "name",
                            slug: "slug",
                        },
                    ],
                },
            ],
            sampleInformation: {
                key: {
                    sampleId: "sample_id",
                    controlNumber: "control_number",
                    dateCollected: {
                        timestamp: new Date("2024-01-15T09:30:00.000Z"),
                        timezoneOffset: 1,
                    },
                    dateReceived: {
                        timestamp: new Date("2024-01-15T09:30:00.000Z"),
                        timezoneOffset: 1,
                    },
                    dateReported: {
                        timestamp: new Date("2024-01-15T09:30:00.000Z"),
                        timezoneOffset: 1,
                    },
                },
            },
        });
    });

    test("get_result_raw (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {};
        server
            .mockEndpoint()
            .get("/v3/order/order_id/result")
            .respondWith()
            .statusCode(422)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.labTests.getResultRaw("order_id");
        }).rejects.toThrow(Vital.UnprocessableEntityError);
    });

    test("get_psc_appointment_availability (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            slots: [
                {
                    location: {
                        location: { lng: 1.1, lat: 1.1 },
                        address: { first_line: "first_line", city: "city", state: "state", zip_code: "zip_code" },
                        code: "code",
                        name: "name",
                    },
                    date: "date",
                    slots: [
                        {
                            start: "2024-01-15T09:30:00Z",
                            end: "2024-01-15T09:30:00Z",
                            price: 1.1,
                            is_priority: true,
                            num_appointments_available: 1,
                        },
                    ],
                },
            ],
            timezone: "timezone",
        };
        server
            .mockEndpoint()
            .post("/v3/order/psc/appointment/availability")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.labTests.getPscAppointmentAvailability({
            lab: "quest",
            startDate: "start_date",
            zipCode: "zip_code",
            radius: "10",
        });
        expect(response).toEqual({
            slots: [
                {
                    location: {
                        location: {
                            lng: 1.1,
                            lat: 1.1,
                        },
                        address: {
                            firstLine: "first_line",
                            city: "city",
                            state: "state",
                            zipCode: "zip_code",
                        },
                        code: "code",
                        name: "name",
                    },
                    date: "date",
                    slots: [
                        {
                            start: new Date("2024-01-15T09:30:00.000Z"),
                            end: new Date("2024-01-15T09:30:00.000Z"),
                            price: 1.1,
                            isPriority: true,
                            numAppointmentsAvailable: 1,
                        },
                    ],
                },
            ],
            timezone: "timezone",
        });
    });

    test("get_psc_appointment_availability (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {};
        server
            .mockEndpoint()
            .post("/v3/order/psc/appointment/availability")
            .respondWith()
            .statusCode(404)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.labTests.getPscAppointmentAvailability({
                lab: "quest",
            });
        }).rejects.toThrow(Vital.NotFoundError);
    });

    test("get_psc_appointment_availability (3)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {};
        server
            .mockEndpoint()
            .post("/v3/order/psc/appointment/availability")
            .respondWith()
            .statusCode(422)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.labTests.getPscAppointmentAvailability({
                lab: "quest",
            });
        }).rejects.toThrow(Vital.UnprocessableEntityError);
    });

    test("book_psc_appointment (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { booking_key: "booking_key" };
        const rawResponseBody = {
            id: "44b10199-41d1-491b-b037-833ed1ac5d89",
            user_id: "338d1565-3e30-40de-aad2-d71cfce693f8",
            order_id: "1c1be546-c9d8-4913-8c2f-2b199257d053",
            address: {
                first_line: "123 Main St.",
                second_line: "Apt. 208",
                city: "San Francisco",
                state: "CA",
                zip_code: "91189",
                unit: "unit",
            },
            location: { lng: -122.4194155, lat: 37.7749295 },
            start_at: "2022-01-01T00:00:00Z",
            end_at: "2022-01-01T00:00:00Z",
            iana_timezone: "America/New_York",
            type: "phlebotomy",
            provider: "getlabs",
            status: "confirmed",
            provider_id: "123",
            external_id: "ext-123",
            can_reschedule: true,
            event_status: "scheduled",
            event_data: {
                description: "Metadata field containing provider specific data, like cancellation reason or origin",
            },
            events: [
                { created_at: "2022-01-01T00:00:00Z", status: "scheduled", data: { key: "value" } },
                { created_at: "2022-01-02T00:00:00Z", status: "completed", data: { key: "value" } },
            ],
        };
        server
            .mockEndpoint()
            .post("/v3/order/order_id/psc/appointment/book")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.labTests.bookPscAppointment("order_id", {
            bookingKey: "booking_key",
        });
        expect(response).toEqual({
            id: "44b10199-41d1-491b-b037-833ed1ac5d89",
            userId: "338d1565-3e30-40de-aad2-d71cfce693f8",
            orderId: "1c1be546-c9d8-4913-8c2f-2b199257d053",
            address: {
                firstLine: "123 Main St.",
                secondLine: "Apt. 208",
                city: "San Francisco",
                state: "CA",
                zipCode: "91189",
                unit: "unit",
            },
            location: {
                lng: -122.4194155,
                lat: 37.7749295,
            },
            startAt: new Date("2022-01-01T00:00:00.000Z"),
            endAt: new Date("2022-01-01T00:00:00.000Z"),
            ianaTimezone: "America/New_York",
            type: "phlebotomy",
            provider: "getlabs",
            status: "confirmed",
            providerId: "123",
            externalId: "ext-123",
            canReschedule: true,
            eventStatus: "scheduled",
            eventData: {
                description: "Metadata field containing provider specific data, like cancellation reason or origin",
            },
            events: [
                {
                    createdAt: new Date("2022-01-01T00:00:00.000Z"),
                    status: "scheduled",
                    data: {
                        key: "value",
                    },
                },
                {
                    createdAt: new Date("2022-01-02T00:00:00.000Z"),
                    status: "completed",
                    data: {
                        key: "value",
                    },
                },
            ],
        });
    });

    test("book_psc_appointment (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { booking_key: "booking_key" };
        const rawResponseBody = {};
        server
            .mockEndpoint()
            .post("/v3/order/order_id/psc/appointment/book")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(422)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.labTests.bookPscAppointment("order_id", {
                bookingKey: "booking_key",
            });
        }).rejects.toThrow(Vital.UnprocessableEntityError);
    });

    test("reschedule_psc_appointment (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { booking_key: "booking_key" };
        const rawResponseBody = {
            id: "44b10199-41d1-491b-b037-833ed1ac5d89",
            user_id: "338d1565-3e30-40de-aad2-d71cfce693f8",
            order_id: "1c1be546-c9d8-4913-8c2f-2b199257d053",
            address: {
                first_line: "123 Main St.",
                second_line: "Apt. 208",
                city: "San Francisco",
                state: "CA",
                zip_code: "91189",
                unit: "unit",
            },
            location: { lng: -122.4194155, lat: 37.7749295 },
            start_at: "2022-01-01T00:00:00Z",
            end_at: "2022-01-01T00:00:00Z",
            iana_timezone: "America/New_York",
            type: "phlebotomy",
            provider: "getlabs",
            status: "confirmed",
            provider_id: "123",
            external_id: "ext-123",
            can_reschedule: true,
            event_status: "scheduled",
            event_data: {
                description: "Metadata field containing provider specific data, like cancellation reason or origin",
            },
            events: [
                { created_at: "2022-01-01T00:00:00Z", status: "scheduled", data: { key: "value" } },
                { created_at: "2022-01-02T00:00:00Z", status: "completed", data: { key: "value" } },
            ],
        };
        server
            .mockEndpoint()
            .patch("/v3/order/order_id/psc/appointment/reschedule")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.labTests.reschedulePscAppointment("order_id", {
            bookingKey: "booking_key",
        });
        expect(response).toEqual({
            id: "44b10199-41d1-491b-b037-833ed1ac5d89",
            userId: "338d1565-3e30-40de-aad2-d71cfce693f8",
            orderId: "1c1be546-c9d8-4913-8c2f-2b199257d053",
            address: {
                firstLine: "123 Main St.",
                secondLine: "Apt. 208",
                city: "San Francisco",
                state: "CA",
                zipCode: "91189",
                unit: "unit",
            },
            location: {
                lng: -122.4194155,
                lat: 37.7749295,
            },
            startAt: new Date("2022-01-01T00:00:00.000Z"),
            endAt: new Date("2022-01-01T00:00:00.000Z"),
            ianaTimezone: "America/New_York",
            type: "phlebotomy",
            provider: "getlabs",
            status: "confirmed",
            providerId: "123",
            externalId: "ext-123",
            canReschedule: true,
            eventStatus: "scheduled",
            eventData: {
                description: "Metadata field containing provider specific data, like cancellation reason or origin",
            },
            events: [
                {
                    createdAt: new Date("2022-01-01T00:00:00.000Z"),
                    status: "scheduled",
                    data: {
                        key: "value",
                    },
                },
                {
                    createdAt: new Date("2022-01-02T00:00:00.000Z"),
                    status: "completed",
                    data: {
                        key: "value",
                    },
                },
            ],
        });
    });

    test("reschedule_psc_appointment (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { booking_key: "booking_key" };
        const rawResponseBody = {};
        server
            .mockEndpoint()
            .patch("/v3/order/order_id/psc/appointment/reschedule")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(422)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.labTests.reschedulePscAppointment("order_id", {
                bookingKey: "booking_key",
            });
        }).rejects.toThrow(Vital.UnprocessableEntityError);
    });

    test("cancel_psc_appointment (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { cancellationReasonId: "cancellationReasonId" };
        const rawResponseBody = {
            id: "44b10199-41d1-491b-b037-833ed1ac5d89",
            user_id: "338d1565-3e30-40de-aad2-d71cfce693f8",
            order_id: "1c1be546-c9d8-4913-8c2f-2b199257d053",
            address: {
                first_line: "123 Main St.",
                second_line: "Apt. 208",
                city: "San Francisco",
                state: "CA",
                zip_code: "91189",
                unit: "unit",
            },
            location: { lng: -122.4194155, lat: 37.7749295 },
            start_at: "2022-01-01T00:00:00Z",
            end_at: "2022-01-01T00:00:00Z",
            iana_timezone: "America/New_York",
            type: "phlebotomy",
            provider: "getlabs",
            status: "confirmed",
            provider_id: "123",
            external_id: "ext-123",
            can_reschedule: true,
            event_status: "scheduled",
            event_data: {
                description: "Metadata field containing provider specific data, like cancellation reason or origin",
            },
            events: [
                { created_at: "2022-01-01T00:00:00Z", status: "scheduled", data: { key: "value" } },
                { created_at: "2022-01-02T00:00:00Z", status: "completed", data: { key: "value" } },
            ],
        };
        server
            .mockEndpoint()
            .patch("/v3/order/order_id/psc/appointment/cancel")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.labTests.cancelPscAppointment("order_id", {
            cancellationReasonId: "cancellationReasonId",
        });
        expect(response).toEqual({
            id: "44b10199-41d1-491b-b037-833ed1ac5d89",
            userId: "338d1565-3e30-40de-aad2-d71cfce693f8",
            orderId: "1c1be546-c9d8-4913-8c2f-2b199257d053",
            address: {
                firstLine: "123 Main St.",
                secondLine: "Apt. 208",
                city: "San Francisco",
                state: "CA",
                zipCode: "91189",
                unit: "unit",
            },
            location: {
                lng: -122.4194155,
                lat: 37.7749295,
            },
            startAt: new Date("2022-01-01T00:00:00.000Z"),
            endAt: new Date("2022-01-01T00:00:00.000Z"),
            ianaTimezone: "America/New_York",
            type: "phlebotomy",
            provider: "getlabs",
            status: "confirmed",
            providerId: "123",
            externalId: "ext-123",
            canReschedule: true,
            eventStatus: "scheduled",
            eventData: {
                description: "Metadata field containing provider specific data, like cancellation reason or origin",
            },
            events: [
                {
                    createdAt: new Date("2022-01-01T00:00:00.000Z"),
                    status: "scheduled",
                    data: {
                        key: "value",
                    },
                },
                {
                    createdAt: new Date("2022-01-02T00:00:00.000Z"),
                    status: "completed",
                    data: {
                        key: "value",
                    },
                },
            ],
        });
    });

    test("cancel_psc_appointment (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { cancellationReasonId: "cancellationReasonId" };
        const rawResponseBody = {};
        server
            .mockEndpoint()
            .patch("/v3/order/order_id/psc/appointment/cancel")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(422)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.labTests.cancelPscAppointment("order_id", {
                cancellationReasonId: "cancellationReasonId",
            });
        }).rejects.toThrow(Vital.UnprocessableEntityError);
    });

    test("get_psc_appointment_cancellation_reason", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = [
            { id: "f64aacbf-7cd3-41ac-be8a-eff0e17724a8", name: "I'm feeling sick", is_refundable: true },
        ];
        server
            .mockEndpoint()
            .get("/v3/order/psc/appointment/cancellation-reasons")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.labTests.getPscAppointmentCancellationReason();
        expect(response).toEqual([
            {
                id: "f64aacbf-7cd3-41ac-be8a-eff0e17724a8",
                name: "I'm feeling sick",
                isRefundable: true,
            },
        ]);
    });

    test("get_psc_appointment (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            id: "44b10199-41d1-491b-b037-833ed1ac5d89",
            user_id: "338d1565-3e30-40de-aad2-d71cfce693f8",
            order_id: "1c1be546-c9d8-4913-8c2f-2b199257d053",
            address: {
                first_line: "123 Main St.",
                second_line: "Apt. 208",
                city: "San Francisco",
                state: "CA",
                zip_code: "91189",
                unit: "unit",
            },
            location: { lng: -122.4194155, lat: 37.7749295 },
            start_at: "2022-01-01T00:00:00Z",
            end_at: "2022-01-01T00:00:00Z",
            iana_timezone: "America/New_York",
            type: "phlebotomy",
            provider: "getlabs",
            status: "confirmed",
            provider_id: "123",
            external_id: "ext-123",
            can_reschedule: true,
            event_status: "scheduled",
            event_data: {
                description: "Metadata field containing provider specific data, like cancellation reason or origin",
            },
            events: [
                { created_at: "2022-01-01T00:00:00Z", status: "scheduled", data: { key: "value" } },
                { created_at: "2022-01-02T00:00:00Z", status: "completed", data: { key: "value" } },
            ],
        };
        server
            .mockEndpoint()
            .get("/v3/order/order_id/psc/appointment")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.labTests.getPscAppointment("order_id");
        expect(response).toEqual({
            id: "44b10199-41d1-491b-b037-833ed1ac5d89",
            userId: "338d1565-3e30-40de-aad2-d71cfce693f8",
            orderId: "1c1be546-c9d8-4913-8c2f-2b199257d053",
            address: {
                firstLine: "123 Main St.",
                secondLine: "Apt. 208",
                city: "San Francisco",
                state: "CA",
                zipCode: "91189",
                unit: "unit",
            },
            location: {
                lng: -122.4194155,
                lat: 37.7749295,
            },
            startAt: new Date("2022-01-01T00:00:00.000Z"),
            endAt: new Date("2022-01-01T00:00:00.000Z"),
            ianaTimezone: "America/New_York",
            type: "phlebotomy",
            provider: "getlabs",
            status: "confirmed",
            providerId: "123",
            externalId: "ext-123",
            canReschedule: true,
            eventStatus: "scheduled",
            eventData: {
                description: "Metadata field containing provider specific data, like cancellation reason or origin",
            },
            events: [
                {
                    createdAt: new Date("2022-01-01T00:00:00.000Z"),
                    status: "scheduled",
                    data: {
                        key: "value",
                    },
                },
                {
                    createdAt: new Date("2022-01-02T00:00:00.000Z"),
                    status: "completed",
                    data: {
                        key: "value",
                    },
                },
            ],
        });
    });

    test("get_psc_appointment (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {};
        server
            .mockEndpoint()
            .get("/v3/order/order_id/psc/appointment")
            .respondWith()
            .statusCode(422)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.labTests.getPscAppointment("order_id");
        }).rejects.toThrow(Vital.UnprocessableEntityError);
    });

    test("get_order (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            user_id: "03f79f9d-cd35-4db4-b7d7-2906437ce160",
            id: "416d4a99-806d-4344-bee7-ef870bb89290",
            team_id: "9e294e75-521a-4605-9a25-d14f8ea9ac9a",
            patient_details: {
                first_name: "first_name",
                last_name: "last_name",
                dob: "2020-01-01T00:00:00Z",
                gender: "male",
                phone_number: "phone_number",
                email: "email",
                medical_proxy: {
                    first_name: "first_name",
                    last_name: "last_name",
                    address: { first_line: "first_line", country: "country", zip: "zip", city: "city", state: "state" },
                    phone_number: "phone_number",
                    household_income: 1,
                    household_size: 1,
                    email: "email",
                },
                race: "african_american_or_black",
                ethnicity: "hispanic",
                sexual_orientation: "lesbian_gay_or_homosexual",
                gender_identity: "male",
            },
            patient_address: {
                receiver_name: "John Doe",
                first_line: "123 Main St.",
                second_line: "Apt. 208",
                city: "San Francisco",
                state: "CA",
                zip: "91189",
                country: "United States",
                phone_number: "+11234567890",
            },
            lab_test: {
                id: "id",
                slug: "slug",
                name: "Lipids Panel",
                sample_type: "dried_blood_spot",
                method: "testkit",
                price: 1.1,
                is_active: true,
                status: "active",
                fasting: true,
                lab: {
                    id: 1,
                    slug: "labcorp",
                    name: "LabCorp",
                    first_line_address: "123 Main St",
                    city: "San Francisco",
                    zipcode: "91789",
                    collection_methods: ["testkit"],
                    sample_types: ["saliva"],
                },
                markers: [
                    {
                        id: 1,
                        name: "Hemoglobin A1c",
                        slug: "hemoglobin-a1c",
                        description:
                            "Hemoglobin A1c is a form of hemoglobin that is measured identify your average blood sugar levels over the past 3 months.",
                        lab_id: 1,
                        provider_id: "1234",
                        type: "biomarker",
                        unit: "%",
                        price: "10.00",
                        aoe: {
                            questions: [
                                {
                                    id: 1,
                                    required: true,
                                    code: "question_code",
                                    value: "question_value",
                                    type: "choice",
                                    sequence: 1,
                                    answers: [{ id: 1, code: "answer_code", value: "answer_value" }],
                                },
                            ],
                        },
                        common_tat_days: 3,
                        worst_case_tat_days: 5,
                        is_orderable: true,
                    },
                ],
                auto_generated: true,
                has_collection_instructions: true,
                common_tat_days: 1,
                worst_case_tat_days: 1,
            },
            details: {
                type: "testkit",
                data: {
                    id: "9e9b00fa-3c2b-4d6a-b0d5-a532d5f83f15",
                    shipment: {
                        id: "4008ec17-bab6-4f57-b0cb-40572a484b42",
                        outbound_tracking_number: "<outbound_tracking_number>",
                        outbound_tracking_url: "<outbound_tracking_url>",
                        inbound_tracking_number: "<inbound_tracking_number>",
                        inbound_tracking_url: "<inbound_tracking_url>",
                        outbound_courier: "usps",
                        inbound_courier: "usps",
                        notes: "<notes>",
                    },
                    created_at: "2020-01-01T00:00:00Z",
                    updated_at: "2020-01-01T00:00:00Z",
                },
            },
            sample_id: "123456789",
            notes: "This is a note",
            created_at: "2020-01-01T00:00:00Z",
            updated_at: "2020-01-01T00:00:00Z",
            events: [
                { id: 1, created_at: "2022-01-01T00:00:00Z", status: "received.testkit.ordered" },
                { id: 2, created_at: "2022-01-02T00:00:00Z", status: "received.testkit.requisition_created" },
                { id: 3, created_at: "2022-01-03T00:00:00Z", status: "collecting_sample.testkit.transit_customer" },
            ],
            status: "collecting_sample",
            physician: { first_name: "first_name", last_name: "last_name", npi: "npi" },
            health_insurance_id: "health_insurance_id",
            requisition_form_url: "https://www.example.com",
            priority: true,
            shipping_details: {
                receiver_name: "receiver_name",
                first_line: "first_line",
                second_line: "second_line",
                city: "city",
                state: "state",
                zip: "zip",
                country: "country",
                phone_number: "phone_number",
            },
            activate_by: "2020-01-01",
            passthrough: "passthrough",
            billing_type: "client_bill",
            icd_codes: ["icd_codes"],
            has_abn: false,
            interpretation: "normal",
            has_missing_results: true,
            expected_result_by_date: "expected_result_by_date",
            worst_case_result_by_date: "worst_case_result_by_date",
        };
        server.mockEndpoint().get("/v3/order/order_id").respondWith().statusCode(200).jsonBody(rawResponseBody).build();

        const response = await client.labTests.getOrder("order_id");
        expect(response).toEqual({
            userId: "03f79f9d-cd35-4db4-b7d7-2906437ce160",
            id: "416d4a99-806d-4344-bee7-ef870bb89290",
            teamId: "9e294e75-521a-4605-9a25-d14f8ea9ac9a",
            patientDetails: {
                firstName: "first_name",
                lastName: "last_name",
                dob: new Date("2020-01-01T00:00:00.000Z"),
                gender: "male",
                phoneNumber: "phone_number",
                email: "email",
                medicalProxy: {
                    firstName: "first_name",
                    lastName: "last_name",
                    address: {
                        firstLine: "first_line",
                        country: "country",
                        zip: "zip",
                        city: "city",
                        state: "state",
                    },
                    phoneNumber: "phone_number",
                    householdIncome: 1,
                    householdSize: 1,
                    email: "email",
                },
                race: "african_american_or_black",
                ethnicity: "hispanic",
                sexualOrientation: "lesbian_gay_or_homosexual",
                genderIdentity: "male",
            },
            patientAddress: {
                receiverName: "John Doe",
                firstLine: "123 Main St.",
                secondLine: "Apt. 208",
                city: "San Francisco",
                state: "CA",
                zip: "91189",
                country: "United States",
                phoneNumber: "+11234567890",
            },
            labTest: {
                id: "id",
                slug: "slug",
                name: "Lipids Panel",
                sampleType: "dried_blood_spot",
                method: "testkit",
                price: 1.1,
                isActive: true,
                status: "active",
                fasting: true,
                lab: {
                    id: 1,
                    slug: "labcorp",
                    name: "LabCorp",
                    firstLineAddress: "123 Main St",
                    city: "San Francisco",
                    zipcode: "91789",
                    collectionMethods: ["testkit"],
                    sampleTypes: ["saliva"],
                },
                markers: [
                    {
                        id: 1,
                        name: "Hemoglobin A1c",
                        slug: "hemoglobin-a1c",
                        description:
                            "Hemoglobin A1c is a form of hemoglobin that is measured identify your average blood sugar levels over the past 3 months.",
                        labId: 1,
                        providerId: "1234",
                        type: "biomarker",
                        unit: "%",
                        price: "10.00",
                        aoe: {
                            questions: [
                                {
                                    id: 1,
                                    required: true,
                                    code: "question_code",
                                    value: "question_value",
                                    type: "choice",
                                    sequence: 1,
                                    answers: [
                                        {
                                            id: 1,
                                            code: "answer_code",
                                            value: "answer_value",
                                        },
                                    ],
                                },
                            ],
                        },
                        commonTatDays: 3,
                        worstCaseTatDays: 5,
                        isOrderable: true,
                    },
                ],
                autoGenerated: true,
                hasCollectionInstructions: true,
                commonTatDays: 1,
                worstCaseTatDays: 1,
            },
            details: {
                type: "testkit",
                data: {
                    id: "9e9b00fa-3c2b-4d6a-b0d5-a532d5f83f15",
                    shipment: {
                        id: "4008ec17-bab6-4f57-b0cb-40572a484b42",
                        outboundTrackingNumber: "<outbound_tracking_number>",
                        outboundTrackingUrl: "<outbound_tracking_url>",
                        inboundTrackingNumber: "<inbound_tracking_number>",
                        inboundTrackingUrl: "<inbound_tracking_url>",
                        outboundCourier: "usps",
                        inboundCourier: "usps",
                        notes: "<notes>",
                    },
                    createdAt: new Date("2020-01-01T00:00:00.000Z"),
                    updatedAt: new Date("2020-01-01T00:00:00.000Z"),
                },
            },
            sampleId: "123456789",
            notes: "This is a note",
            createdAt: new Date("2020-01-01T00:00:00.000Z"),
            updatedAt: new Date("2020-01-01T00:00:00.000Z"),
            events: [
                {
                    id: 1,
                    createdAt: new Date("2022-01-01T00:00:00.000Z"),
                    status: "received.testkit.ordered",
                },
                {
                    id: 2,
                    createdAt: new Date("2022-01-02T00:00:00.000Z"),
                    status: "received.testkit.requisition_created",
                },
                {
                    id: 3,
                    createdAt: new Date("2022-01-03T00:00:00.000Z"),
                    status: "collecting_sample.testkit.transit_customer",
                },
            ],
            status: "collecting_sample",
            physician: {
                firstName: "first_name",
                lastName: "last_name",
                npi: "npi",
            },
            healthInsuranceId: "health_insurance_id",
            requisitionFormUrl: "https://www.example.com",
            priority: true,
            shippingDetails: {
                receiverName: "receiver_name",
                firstLine: "first_line",
                secondLine: "second_line",
                city: "city",
                state: "state",
                zip: "zip",
                country: "country",
                phoneNumber: "phone_number",
            },
            activateBy: "2020-01-01",
            passthrough: "passthrough",
            billingType: "client_bill",
            icdCodes: ["icd_codes"],
            hasAbn: false,
            interpretation: "normal",
            hasMissingResults: true,
            expectedResultByDate: "expected_result_by_date",
            worstCaseResultByDate: "worst_case_result_by_date",
        });
    });

    test("get_order (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {};
        server.mockEndpoint().get("/v3/order/order_id").respondWith().statusCode(422).jsonBody(rawResponseBody).build();

        await expect(async () => {
            return await client.labTests.getOrder("order_id");
        }).rejects.toThrow(Vital.UnprocessableEntityError);
    });

    test("create_order (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {
            user_id: "user_id",
            patient_details: {
                first_name: "first_name",
                last_name: "last_name",
                dob: "dob",
                gender: "female",
                phone_number: "phone_number",
                email: "email",
            },
            patient_address: { first_line: "first_line", city: "city", state: "state", zip: "zip", country: "country" },
        };
        const rawResponseBody = {
            order: {
                user_id: "03f79f9d-cd35-4db4-b7d7-2906437ce160",
                id: "416d4a99-806d-4344-bee7-ef870bb89290",
                team_id: "9e294e75-521a-4605-9a25-d14f8ea9ac9a",
                patient_details: {
                    first_name: "first_name",
                    last_name: "last_name",
                    dob: "2020-01-01T00:00:00Z",
                    gender: "male",
                    phone_number: "phone_number",
                    email: "email",
                    medical_proxy: {
                        first_name: "first_name",
                        last_name: "last_name",
                        address: {
                            first_line: "first_line",
                            country: "country",
                            zip: "zip",
                            city: "city",
                            state: "state",
                        },
                        phone_number: "phone_number",
                    },
                    race: "african_american_or_black",
                    ethnicity: "hispanic",
                    sexual_orientation: "lesbian_gay_or_homosexual",
                    gender_identity: "male",
                },
                patient_address: {
                    receiver_name: "John Doe",
                    first_line: "123 Main St.",
                    second_line: "Apt. 208",
                    city: "San Francisco",
                    state: "CA",
                    zip: "91189",
                    country: "United States",
                    phone_number: "+11234567890",
                },
                lab_test: {
                    id: "id",
                    slug: "slug",
                    name: "Lipids Panel",
                    sample_type: "dried_blood_spot",
                    method: "testkit",
                    price: 1.1,
                    is_active: true,
                    status: "active",
                    fasting: true,
                    lab: {
                        id: 1,
                        slug: "labcorp",
                        name: "LabCorp",
                        first_line_address: "123 Main St",
                        city: "San Francisco",
                        zipcode: "91789",
                        collection_methods: ["testkit"],
                        sample_types: ["saliva"],
                    },
                    markers: [
                        {
                            id: 1,
                            name: "Hemoglobin A1c",
                            slug: "hemoglobin-a1c",
                            description:
                                "Hemoglobin A1c is a form of hemoglobin that is measured identify your average blood sugar levels over the past 3 months.",
                            lab_id: 1,
                            provider_id: "1234",
                            type: "biomarker",
                            unit: "%",
                            price: "10.00",
                            aoe: {
                                questions: [
                                    {
                                        id: 1,
                                        required: true,
                                        code: "question_code",
                                        value: "question_value",
                                        type: "choice",
                                        sequence: 1,
                                        answers: [{ id: 1, code: "answer_code", value: "answer_value" }],
                                    },
                                ],
                            },
                            common_tat_days: 3,
                            worst_case_tat_days: 5,
                            is_orderable: true,
                        },
                    ],
                    auto_generated: true,
                    has_collection_instructions: true,
                    common_tat_days: 1,
                    worst_case_tat_days: 1,
                },
                details: {
                    type: "testkit",
                    data: {
                        id: "9e9b00fa-3c2b-4d6a-b0d5-a532d5f83f15",
                        shipment: {
                            id: "4008ec17-bab6-4f57-b0cb-40572a484b42",
                            outbound_tracking_number: "<outbound_tracking_number>",
                            outbound_tracking_url: "<outbound_tracking_url>",
                            inbound_tracking_number: "<inbound_tracking_number>",
                            inbound_tracking_url: "<inbound_tracking_url>",
                            outbound_courier: "usps",
                            inbound_courier: "usps",
                            notes: "<notes>",
                        },
                        created_at: "2020-01-01T00:00:00Z",
                        updated_at: "2020-01-01T00:00:00Z",
                    },
                },
                sample_id: "123456789",
                notes: "This is a note",
                created_at: "2020-01-01T00:00:00Z",
                updated_at: "2020-01-01T00:00:00Z",
                events: [
                    { id: 1, created_at: "2022-01-01T00:00:00Z", status: "received.testkit.ordered" },
                    { id: 2, created_at: "2022-01-02T00:00:00Z", status: "received.testkit.requisition_created" },
                    { id: 3, created_at: "2022-01-03T00:00:00Z", status: "collecting_sample.testkit.transit_customer" },
                ],
                status: "collecting_sample",
                physician: { first_name: "first_name", last_name: "last_name", npi: "npi" },
                health_insurance_id: "health_insurance_id",
                requisition_form_url: "https://www.example.com",
                priority: true,
                shipping_details: {
                    receiver_name: "receiver_name",
                    first_line: "first_line",
                    second_line: "second_line",
                    city: "city",
                    state: "state",
                    zip: "zip",
                    country: "country",
                    phone_number: "phone_number",
                },
                activate_by: "2020-01-01",
                passthrough: "passthrough",
                billing_type: "client_bill",
                icd_codes: ["icd_codes"],
                has_abn: false,
                interpretation: "normal",
                has_missing_results: true,
                expected_result_by_date: "expected_result_by_date",
                worst_case_result_by_date: "worst_case_result_by_date",
            },
            status: "status",
            message: "message",
        };
        server
            .mockEndpoint()
            .post("/v3/order")
            .header("X-Idempotency-Key", "X-Idempotency-Key")
            .header("X-Idempotency-Error", "no-cache")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.labTests.createOrder({
            idempotencyKey: "X-Idempotency-Key",
            idempotencyError: "no-cache",
            userId: "user_id",
            patientDetails: {
                firstName: "first_name",
                lastName: "last_name",
                dob: "dob",
                gender: "female",
                phoneNumber: "phone_number",
                email: "email",
            },
            patientAddress: {
                firstLine: "first_line",
                city: "city",
                state: "state",
                zip: "zip",
                country: "country",
            },
        });
        expect(response).toEqual({
            order: {
                userId: "03f79f9d-cd35-4db4-b7d7-2906437ce160",
                id: "416d4a99-806d-4344-bee7-ef870bb89290",
                teamId: "9e294e75-521a-4605-9a25-d14f8ea9ac9a",
                patientDetails: {
                    firstName: "first_name",
                    lastName: "last_name",
                    dob: new Date("2020-01-01T00:00:00.000Z"),
                    gender: "male",
                    phoneNumber: "phone_number",
                    email: "email",
                    medicalProxy: {
                        firstName: "first_name",
                        lastName: "last_name",
                        address: {
                            firstLine: "first_line",
                            country: "country",
                            zip: "zip",
                            city: "city",
                            state: "state",
                        },
                        phoneNumber: "phone_number",
                    },
                    race: "african_american_or_black",
                    ethnicity: "hispanic",
                    sexualOrientation: "lesbian_gay_or_homosexual",
                    genderIdentity: "male",
                },
                patientAddress: {
                    receiverName: "John Doe",
                    firstLine: "123 Main St.",
                    secondLine: "Apt. 208",
                    city: "San Francisco",
                    state: "CA",
                    zip: "91189",
                    country: "United States",
                    phoneNumber: "+11234567890",
                },
                labTest: {
                    id: "id",
                    slug: "slug",
                    name: "Lipids Panel",
                    sampleType: "dried_blood_spot",
                    method: "testkit",
                    price: 1.1,
                    isActive: true,
                    status: "active",
                    fasting: true,
                    lab: {
                        id: 1,
                        slug: "labcorp",
                        name: "LabCorp",
                        firstLineAddress: "123 Main St",
                        city: "San Francisco",
                        zipcode: "91789",
                        collectionMethods: ["testkit"],
                        sampleTypes: ["saliva"],
                    },
                    markers: [
                        {
                            id: 1,
                            name: "Hemoglobin A1c",
                            slug: "hemoglobin-a1c",
                            description:
                                "Hemoglobin A1c is a form of hemoglobin that is measured identify your average blood sugar levels over the past 3 months.",
                            labId: 1,
                            providerId: "1234",
                            type: "biomarker",
                            unit: "%",
                            price: "10.00",
                            aoe: {
                                questions: [
                                    {
                                        id: 1,
                                        required: true,
                                        code: "question_code",
                                        value: "question_value",
                                        type: "choice",
                                        sequence: 1,
                                        answers: [
                                            {
                                                id: 1,
                                                code: "answer_code",
                                                value: "answer_value",
                                            },
                                        ],
                                    },
                                ],
                            },
                            commonTatDays: 3,
                            worstCaseTatDays: 5,
                            isOrderable: true,
                        },
                    ],
                    autoGenerated: true,
                    hasCollectionInstructions: true,
                    commonTatDays: 1,
                    worstCaseTatDays: 1,
                },
                details: {
                    type: "testkit",
                    data: {
                        id: "9e9b00fa-3c2b-4d6a-b0d5-a532d5f83f15",
                        shipment: {
                            id: "4008ec17-bab6-4f57-b0cb-40572a484b42",
                            outboundTrackingNumber: "<outbound_tracking_number>",
                            outboundTrackingUrl: "<outbound_tracking_url>",
                            inboundTrackingNumber: "<inbound_tracking_number>",
                            inboundTrackingUrl: "<inbound_tracking_url>",
                            outboundCourier: "usps",
                            inboundCourier: "usps",
                            notes: "<notes>",
                        },
                        createdAt: new Date("2020-01-01T00:00:00.000Z"),
                        updatedAt: new Date("2020-01-01T00:00:00.000Z"),
                    },
                },
                sampleId: "123456789",
                notes: "This is a note",
                createdAt: new Date("2020-01-01T00:00:00.000Z"),
                updatedAt: new Date("2020-01-01T00:00:00.000Z"),
                events: [
                    {
                        id: 1,
                        createdAt: new Date("2022-01-01T00:00:00.000Z"),
                        status: "received.testkit.ordered",
                    },
                    {
                        id: 2,
                        createdAt: new Date("2022-01-02T00:00:00.000Z"),
                        status: "received.testkit.requisition_created",
                    },
                    {
                        id: 3,
                        createdAt: new Date("2022-01-03T00:00:00.000Z"),
                        status: "collecting_sample.testkit.transit_customer",
                    },
                ],
                status: "collecting_sample",
                physician: {
                    firstName: "first_name",
                    lastName: "last_name",
                    npi: "npi",
                },
                healthInsuranceId: "health_insurance_id",
                requisitionFormUrl: "https://www.example.com",
                priority: true,
                shippingDetails: {
                    receiverName: "receiver_name",
                    firstLine: "first_line",
                    secondLine: "second_line",
                    city: "city",
                    state: "state",
                    zip: "zip",
                    country: "country",
                    phoneNumber: "phone_number",
                },
                activateBy: "2020-01-01",
                passthrough: "passthrough",
                billingType: "client_bill",
                icdCodes: ["icd_codes"],
                hasAbn: false,
                interpretation: "normal",
                hasMissingResults: true,
                expectedResultByDate: "expected_result_by_date",
                worstCaseResultByDate: "worst_case_result_by_date",
            },
            status: "status",
            message: "message",
        });
    });

    test("create_order (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {
            user_id: "user_id",
            patient_details: {
                first_name: "x",
                last_name: "x",
                dob: "dob",
                gender: "female",
                phone_number: "phone_number",
                email: "email",
            },
            patient_address: { first_line: "first_line", city: "city", state: "state", zip: "zip", country: "country" },
        };
        const rawResponseBody = {};
        server
            .mockEndpoint()
            .post("/v3/order")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(422)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.labTests.createOrder({
                userId: "user_id",
                patientDetails: {
                    firstName: "x",
                    lastName: "x",
                    dob: "dob",
                    gender: "female",
                    phoneNumber: "phone_number",
                    email: "email",
                },
                patientAddress: {
                    firstLine: "first_line",
                    city: "city",
                    state: "state",
                    zip: "zip",
                    country: "country",
                },
            });
        }).rejects.toThrow(Vital.UnprocessableEntityError);
    });

    test("import_order (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {
            user_id: "user_id",
            billing_type: "client_bill",
            order_set: {},
            collection_method: "testkit",
            patient_details: {
                first_name: "first_name",
                last_name: "last_name",
                dob: "dob",
                gender: "female",
                phone_number: "phone_number",
                email: "email",
            },
            patient_address: {
                receiver_name: "receiver_name",
                first_line: "first_line",
                city: "city",
                state: "state",
                zip: "zip",
                country: "country",
            },
            sample_id: "sample_id",
        };
        const rawResponseBody = {
            order: {
                user_id: "03f79f9d-cd35-4db4-b7d7-2906437ce160",
                id: "416d4a99-806d-4344-bee7-ef870bb89290",
                team_id: "9e294e75-521a-4605-9a25-d14f8ea9ac9a",
                patient_details: {
                    first_name: "first_name",
                    last_name: "last_name",
                    dob: "2020-01-01T00:00:00Z",
                    gender: "male",
                    phone_number: "phone_number",
                    email: "email",
                    medical_proxy: {
                        first_name: "first_name",
                        last_name: "last_name",
                        address: {
                            first_line: "first_line",
                            country: "country",
                            zip: "zip",
                            city: "city",
                            state: "state",
                        },
                        phone_number: "phone_number",
                    },
                    race: "african_american_or_black",
                    ethnicity: "hispanic",
                    sexual_orientation: "lesbian_gay_or_homosexual",
                    gender_identity: "male",
                },
                patient_address: {
                    receiver_name: "John Doe",
                    first_line: "123 Main St.",
                    second_line: "Apt. 208",
                    city: "San Francisco",
                    state: "CA",
                    zip: "91189",
                    country: "United States",
                    phone_number: "+11234567890",
                },
                lab_test: {
                    id: "id",
                    slug: "slug",
                    name: "Lipids Panel",
                    sample_type: "dried_blood_spot",
                    method: "testkit",
                    price: 1.1,
                    is_active: true,
                    status: "active",
                    fasting: true,
                    lab: {
                        id: 1,
                        slug: "labcorp",
                        name: "LabCorp",
                        first_line_address: "123 Main St",
                        city: "San Francisco",
                        zipcode: "91789",
                        collection_methods: ["testkit"],
                        sample_types: ["saliva"],
                    },
                    markers: [
                        {
                            id: 1,
                            name: "Hemoglobin A1c",
                            slug: "hemoglobin-a1c",
                            description:
                                "Hemoglobin A1c is a form of hemoglobin that is measured identify your average blood sugar levels over the past 3 months.",
                            lab_id: 1,
                            provider_id: "1234",
                            type: "biomarker",
                            unit: "%",
                            price: "10.00",
                            aoe: {
                                questions: [
                                    {
                                        id: 1,
                                        required: true,
                                        code: "question_code",
                                        value: "question_value",
                                        type: "choice",
                                        sequence: 1,
                                        answers: [{ id: 1, code: "answer_code", value: "answer_value" }],
                                    },
                                ],
                            },
                            common_tat_days: 3,
                            worst_case_tat_days: 5,
                            is_orderable: true,
                        },
                    ],
                    auto_generated: true,
                    has_collection_instructions: true,
                    common_tat_days: 1,
                    worst_case_tat_days: 1,
                },
                details: {
                    type: "testkit",
                    data: {
                        id: "9e9b00fa-3c2b-4d6a-b0d5-a532d5f83f15",
                        shipment: {
                            id: "4008ec17-bab6-4f57-b0cb-40572a484b42",
                            outbound_tracking_number: "<outbound_tracking_number>",
                            outbound_tracking_url: "<outbound_tracking_url>",
                            inbound_tracking_number: "<inbound_tracking_number>",
                            inbound_tracking_url: "<inbound_tracking_url>",
                            outbound_courier: "usps",
                            inbound_courier: "usps",
                            notes: "<notes>",
                        },
                        created_at: "2020-01-01T00:00:00Z",
                        updated_at: "2020-01-01T00:00:00Z",
                    },
                },
                sample_id: "123456789",
                notes: "This is a note",
                created_at: "2020-01-01T00:00:00Z",
                updated_at: "2020-01-01T00:00:00Z",
                events: [
                    { id: 1, created_at: "2022-01-01T00:00:00Z", status: "received.testkit.ordered" },
                    { id: 2, created_at: "2022-01-02T00:00:00Z", status: "received.testkit.requisition_created" },
                    { id: 3, created_at: "2022-01-03T00:00:00Z", status: "collecting_sample.testkit.transit_customer" },
                ],
                status: "collecting_sample",
                physician: { first_name: "first_name", last_name: "last_name", npi: "npi" },
                health_insurance_id: "health_insurance_id",
                requisition_form_url: "https://www.example.com",
                priority: true,
                shipping_details: {
                    receiver_name: "receiver_name",
                    first_line: "first_line",
                    second_line: "second_line",
                    city: "city",
                    state: "state",
                    zip: "zip",
                    country: "country",
                    phone_number: "phone_number",
                },
                activate_by: "2020-01-01",
                passthrough: "passthrough",
                billing_type: "client_bill",
                icd_codes: ["icd_codes"],
                has_abn: false,
                interpretation: "normal",
                has_missing_results: true,
                expected_result_by_date: "expected_result_by_date",
                worst_case_result_by_date: "worst_case_result_by_date",
            },
            status: "status",
            message: "message",
        };
        server
            .mockEndpoint()
            .post("/v3/order/import")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.labTests.importOrder({
            userId: "user_id",
            billingType: "client_bill",
            orderSet: {},
            collectionMethod: "testkit",
            patientDetails: {
                firstName: "first_name",
                lastName: "last_name",
                dob: "dob",
                gender: "female",
                phoneNumber: "phone_number",
                email: "email",
            },
            patientAddress: {
                receiverName: "receiver_name",
                firstLine: "first_line",
                city: "city",
                state: "state",
                zip: "zip",
                country: "country",
            },
            sampleId: "sample_id",
        });
        expect(response).toEqual({
            order: {
                userId: "03f79f9d-cd35-4db4-b7d7-2906437ce160",
                id: "416d4a99-806d-4344-bee7-ef870bb89290",
                teamId: "9e294e75-521a-4605-9a25-d14f8ea9ac9a",
                patientDetails: {
                    firstName: "first_name",
                    lastName: "last_name",
                    dob: new Date("2020-01-01T00:00:00.000Z"),
                    gender: "male",
                    phoneNumber: "phone_number",
                    email: "email",
                    medicalProxy: {
                        firstName: "first_name",
                        lastName: "last_name",
                        address: {
                            firstLine: "first_line",
                            country: "country",
                            zip: "zip",
                            city: "city",
                            state: "state",
                        },
                        phoneNumber: "phone_number",
                    },
                    race: "african_american_or_black",
                    ethnicity: "hispanic",
                    sexualOrientation: "lesbian_gay_or_homosexual",
                    genderIdentity: "male",
                },
                patientAddress: {
                    receiverName: "John Doe",
                    firstLine: "123 Main St.",
                    secondLine: "Apt. 208",
                    city: "San Francisco",
                    state: "CA",
                    zip: "91189",
                    country: "United States",
                    phoneNumber: "+11234567890",
                },
                labTest: {
                    id: "id",
                    slug: "slug",
                    name: "Lipids Panel",
                    sampleType: "dried_blood_spot",
                    method: "testkit",
                    price: 1.1,
                    isActive: true,
                    status: "active",
                    fasting: true,
                    lab: {
                        id: 1,
                        slug: "labcorp",
                        name: "LabCorp",
                        firstLineAddress: "123 Main St",
                        city: "San Francisco",
                        zipcode: "91789",
                        collectionMethods: ["testkit"],
                        sampleTypes: ["saliva"],
                    },
                    markers: [
                        {
                            id: 1,
                            name: "Hemoglobin A1c",
                            slug: "hemoglobin-a1c",
                            description:
                                "Hemoglobin A1c is a form of hemoglobin that is measured identify your average blood sugar levels over the past 3 months.",
                            labId: 1,
                            providerId: "1234",
                            type: "biomarker",
                            unit: "%",
                            price: "10.00",
                            aoe: {
                                questions: [
                                    {
                                        id: 1,
                                        required: true,
                                        code: "question_code",
                                        value: "question_value",
                                        type: "choice",
                                        sequence: 1,
                                        answers: [
                                            {
                                                id: 1,
                                                code: "answer_code",
                                                value: "answer_value",
                                            },
                                        ],
                                    },
                                ],
                            },
                            commonTatDays: 3,
                            worstCaseTatDays: 5,
                            isOrderable: true,
                        },
                    ],
                    autoGenerated: true,
                    hasCollectionInstructions: true,
                    commonTatDays: 1,
                    worstCaseTatDays: 1,
                },
                details: {
                    type: "testkit",
                    data: {
                        id: "9e9b00fa-3c2b-4d6a-b0d5-a532d5f83f15",
                        shipment: {
                            id: "4008ec17-bab6-4f57-b0cb-40572a484b42",
                            outboundTrackingNumber: "<outbound_tracking_number>",
                            outboundTrackingUrl: "<outbound_tracking_url>",
                            inboundTrackingNumber: "<inbound_tracking_number>",
                            inboundTrackingUrl: "<inbound_tracking_url>",
                            outboundCourier: "usps",
                            inboundCourier: "usps",
                            notes: "<notes>",
                        },
                        createdAt: new Date("2020-01-01T00:00:00.000Z"),
                        updatedAt: new Date("2020-01-01T00:00:00.000Z"),
                    },
                },
                sampleId: "123456789",
                notes: "This is a note",
                createdAt: new Date("2020-01-01T00:00:00.000Z"),
                updatedAt: new Date("2020-01-01T00:00:00.000Z"),
                events: [
                    {
                        id: 1,
                        createdAt: new Date("2022-01-01T00:00:00.000Z"),
                        status: "received.testkit.ordered",
                    },
                    {
                        id: 2,
                        createdAt: new Date("2022-01-02T00:00:00.000Z"),
                        status: "received.testkit.requisition_created",
                    },
                    {
                        id: 3,
                        createdAt: new Date("2022-01-03T00:00:00.000Z"),
                        status: "collecting_sample.testkit.transit_customer",
                    },
                ],
                status: "collecting_sample",
                physician: {
                    firstName: "first_name",
                    lastName: "last_name",
                    npi: "npi",
                },
                healthInsuranceId: "health_insurance_id",
                requisitionFormUrl: "https://www.example.com",
                priority: true,
                shippingDetails: {
                    receiverName: "receiver_name",
                    firstLine: "first_line",
                    secondLine: "second_line",
                    city: "city",
                    state: "state",
                    zip: "zip",
                    country: "country",
                    phoneNumber: "phone_number",
                },
                activateBy: "2020-01-01",
                passthrough: "passthrough",
                billingType: "client_bill",
                icdCodes: ["icd_codes"],
                hasAbn: false,
                interpretation: "normal",
                hasMissingResults: true,
                expectedResultByDate: "expected_result_by_date",
                worstCaseResultByDate: "worst_case_result_by_date",
            },
            status: "status",
            message: "message",
        });
    });

    test("import_order (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {
            user_id: "user_id",
            billing_type: "client_bill",
            order_set: {},
            collection_method: "testkit",
            patient_details: {
                first_name: "x",
                last_name: "x",
                dob: "dob",
                gender: "female",
                phone_number: "phone_number",
                email: "email",
            },
            patient_address: {
                receiver_name: "receiver_name",
                first_line: "first_line",
                city: "city",
                state: "state",
                zip: "zip",
                country: "country",
            },
            sample_id: "sample_id",
        };
        const rawResponseBody = {};
        server
            .mockEndpoint()
            .post("/v3/order/import")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(422)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.labTests.importOrder({
                userId: "user_id",
                billingType: "client_bill",
                orderSet: {},
                collectionMethod: "testkit",
                patientDetails: {
                    firstName: "x",
                    lastName: "x",
                    dob: "dob",
                    gender: "female",
                    phoneNumber: "phone_number",
                    email: "email",
                },
                patientAddress: {
                    receiverName: "receiver_name",
                    firstLine: "first_line",
                    city: "city",
                    state: "state",
                    zip: "zip",
                    country: "country",
                },
                sampleId: "sample_id",
            });
        }).rejects.toThrow(Vital.UnprocessableEntityError);
    });

    test("cancel_order (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            order: {
                user_id: "03f79f9d-cd35-4db4-b7d7-2906437ce160",
                id: "416d4a99-806d-4344-bee7-ef870bb89290",
                team_id: "9e294e75-521a-4605-9a25-d14f8ea9ac9a",
                patient_details: {
                    first_name: "first_name",
                    last_name: "last_name",
                    dob: "2020-01-01T00:00:00Z",
                    gender: "male",
                    phone_number: "phone_number",
                    email: "email",
                    medical_proxy: {
                        first_name: "first_name",
                        last_name: "last_name",
                        address: {
                            first_line: "first_line",
                            country: "country",
                            zip: "zip",
                            city: "city",
                            state: "state",
                        },
                        phone_number: "phone_number",
                    },
                    race: "african_american_or_black",
                    ethnicity: "hispanic",
                    sexual_orientation: "lesbian_gay_or_homosexual",
                    gender_identity: "male",
                },
                patient_address: {
                    receiver_name: "John Doe",
                    first_line: "123 Main St.",
                    second_line: "Apt. 208",
                    city: "San Francisco",
                    state: "CA",
                    zip: "91189",
                    country: "United States",
                    phone_number: "+11234567890",
                },
                lab_test: {
                    id: "id",
                    slug: "slug",
                    name: "Lipids Panel",
                    sample_type: "dried_blood_spot",
                    method: "testkit",
                    price: 1.1,
                    is_active: true,
                    status: "active",
                    fasting: true,
                    lab: {
                        id: 1,
                        slug: "labcorp",
                        name: "LabCorp",
                        first_line_address: "123 Main St",
                        city: "San Francisco",
                        zipcode: "91789",
                        collection_methods: ["testkit"],
                        sample_types: ["saliva"],
                    },
                    markers: [
                        {
                            id: 1,
                            name: "Hemoglobin A1c",
                            slug: "hemoglobin-a1c",
                            description:
                                "Hemoglobin A1c is a form of hemoglobin that is measured identify your average blood sugar levels over the past 3 months.",
                            lab_id: 1,
                            provider_id: "1234",
                            type: "biomarker",
                            unit: "%",
                            price: "10.00",
                            aoe: {
                                questions: [
                                    {
                                        id: 1,
                                        required: true,
                                        code: "question_code",
                                        value: "question_value",
                                        type: "choice",
                                        sequence: 1,
                                        answers: [{ id: 1, code: "answer_code", value: "answer_value" }],
                                    },
                                ],
                            },
                            common_tat_days: 3,
                            worst_case_tat_days: 5,
                            is_orderable: true,
                        },
                    ],
                    auto_generated: true,
                    has_collection_instructions: true,
                    common_tat_days: 1,
                    worst_case_tat_days: 1,
                },
                details: {
                    type: "testkit",
                    data: {
                        id: "9e9b00fa-3c2b-4d6a-b0d5-a532d5f83f15",
                        shipment: {
                            id: "4008ec17-bab6-4f57-b0cb-40572a484b42",
                            outbound_tracking_number: "<outbound_tracking_number>",
                            outbound_tracking_url: "<outbound_tracking_url>",
                            inbound_tracking_number: "<inbound_tracking_number>",
                            inbound_tracking_url: "<inbound_tracking_url>",
                            outbound_courier: "usps",
                            inbound_courier: "usps",
                            notes: "<notes>",
                        },
                        created_at: "2020-01-01T00:00:00Z",
                        updated_at: "2020-01-01T00:00:00Z",
                    },
                },
                sample_id: "123456789",
                notes: "This is a note",
                created_at: "2020-01-01T00:00:00Z",
                updated_at: "2020-01-01T00:00:00Z",
                events: [
                    { id: 1, created_at: "2022-01-01T00:00:00Z", status: "received.testkit.ordered" },
                    { id: 2, created_at: "2022-01-02T00:00:00Z", status: "received.testkit.requisition_created" },
                    { id: 3, created_at: "2022-01-03T00:00:00Z", status: "collecting_sample.testkit.transit_customer" },
                ],
                status: "collecting_sample",
                physician: { first_name: "first_name", last_name: "last_name", npi: "npi" },
                health_insurance_id: "health_insurance_id",
                requisition_form_url: "https://www.example.com",
                priority: true,
                shipping_details: {
                    receiver_name: "receiver_name",
                    first_line: "first_line",
                    second_line: "second_line",
                    city: "city",
                    state: "state",
                    zip: "zip",
                    country: "country",
                    phone_number: "phone_number",
                },
                activate_by: "2020-01-01",
                passthrough: "passthrough",
                billing_type: "client_bill",
                icd_codes: ["icd_codes"],
                has_abn: false,
                interpretation: "normal",
                has_missing_results: true,
                expected_result_by_date: "expected_result_by_date",
                worst_case_result_by_date: "worst_case_result_by_date",
            },
            status: "status",
            message: "message",
        };
        server
            .mockEndpoint()
            .post("/v3/order/order_id/cancel")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.labTests.cancelOrder("order_id");
        expect(response).toEqual({
            order: {
                userId: "03f79f9d-cd35-4db4-b7d7-2906437ce160",
                id: "416d4a99-806d-4344-bee7-ef870bb89290",
                teamId: "9e294e75-521a-4605-9a25-d14f8ea9ac9a",
                patientDetails: {
                    firstName: "first_name",
                    lastName: "last_name",
                    dob: new Date("2020-01-01T00:00:00.000Z"),
                    gender: "male",
                    phoneNumber: "phone_number",
                    email: "email",
                    medicalProxy: {
                        firstName: "first_name",
                        lastName: "last_name",
                        address: {
                            firstLine: "first_line",
                            country: "country",
                            zip: "zip",
                            city: "city",
                            state: "state",
                        },
                        phoneNumber: "phone_number",
                    },
                    race: "african_american_or_black",
                    ethnicity: "hispanic",
                    sexualOrientation: "lesbian_gay_or_homosexual",
                    genderIdentity: "male",
                },
                patientAddress: {
                    receiverName: "John Doe",
                    firstLine: "123 Main St.",
                    secondLine: "Apt. 208",
                    city: "San Francisco",
                    state: "CA",
                    zip: "91189",
                    country: "United States",
                    phoneNumber: "+11234567890",
                },
                labTest: {
                    id: "id",
                    slug: "slug",
                    name: "Lipids Panel",
                    sampleType: "dried_blood_spot",
                    method: "testkit",
                    price: 1.1,
                    isActive: true,
                    status: "active",
                    fasting: true,
                    lab: {
                        id: 1,
                        slug: "labcorp",
                        name: "LabCorp",
                        firstLineAddress: "123 Main St",
                        city: "San Francisco",
                        zipcode: "91789",
                        collectionMethods: ["testkit"],
                        sampleTypes: ["saliva"],
                    },
                    markers: [
                        {
                            id: 1,
                            name: "Hemoglobin A1c",
                            slug: "hemoglobin-a1c",
                            description:
                                "Hemoglobin A1c is a form of hemoglobin that is measured identify your average blood sugar levels over the past 3 months.",
                            labId: 1,
                            providerId: "1234",
                            type: "biomarker",
                            unit: "%",
                            price: "10.00",
                            aoe: {
                                questions: [
                                    {
                                        id: 1,
                                        required: true,
                                        code: "question_code",
                                        value: "question_value",
                                        type: "choice",
                                        sequence: 1,
                                        answers: [
                                            {
                                                id: 1,
                                                code: "answer_code",
                                                value: "answer_value",
                                            },
                                        ],
                                    },
                                ],
                            },
                            commonTatDays: 3,
                            worstCaseTatDays: 5,
                            isOrderable: true,
                        },
                    ],
                    autoGenerated: true,
                    hasCollectionInstructions: true,
                    commonTatDays: 1,
                    worstCaseTatDays: 1,
                },
                details: {
                    type: "testkit",
                    data: {
                        id: "9e9b00fa-3c2b-4d6a-b0d5-a532d5f83f15",
                        shipment: {
                            id: "4008ec17-bab6-4f57-b0cb-40572a484b42",
                            outboundTrackingNumber: "<outbound_tracking_number>",
                            outboundTrackingUrl: "<outbound_tracking_url>",
                            inboundTrackingNumber: "<inbound_tracking_number>",
                            inboundTrackingUrl: "<inbound_tracking_url>",
                            outboundCourier: "usps",
                            inboundCourier: "usps",
                            notes: "<notes>",
                        },
                        createdAt: new Date("2020-01-01T00:00:00.000Z"),
                        updatedAt: new Date("2020-01-01T00:00:00.000Z"),
                    },
                },
                sampleId: "123456789",
                notes: "This is a note",
                createdAt: new Date("2020-01-01T00:00:00.000Z"),
                updatedAt: new Date("2020-01-01T00:00:00.000Z"),
                events: [
                    {
                        id: 1,
                        createdAt: new Date("2022-01-01T00:00:00.000Z"),
                        status: "received.testkit.ordered",
                    },
                    {
                        id: 2,
                        createdAt: new Date("2022-01-02T00:00:00.000Z"),
                        status: "received.testkit.requisition_created",
                    },
                    {
                        id: 3,
                        createdAt: new Date("2022-01-03T00:00:00.000Z"),
                        status: "collecting_sample.testkit.transit_customer",
                    },
                ],
                status: "collecting_sample",
                physician: {
                    firstName: "first_name",
                    lastName: "last_name",
                    npi: "npi",
                },
                healthInsuranceId: "health_insurance_id",
                requisitionFormUrl: "https://www.example.com",
                priority: true,
                shippingDetails: {
                    receiverName: "receiver_name",
                    firstLine: "first_line",
                    secondLine: "second_line",
                    city: "city",
                    state: "state",
                    zip: "zip",
                    country: "country",
                    phoneNumber: "phone_number",
                },
                activateBy: "2020-01-01",
                passthrough: "passthrough",
                billingType: "client_bill",
                icdCodes: ["icd_codes"],
                hasAbn: false,
                interpretation: "normal",
                hasMissingResults: true,
                expectedResultByDate: "expected_result_by_date",
                worstCaseResultByDate: "worst_case_result_by_date",
            },
            status: "status",
            message: "message",
        });
    });

    test("cancel_order (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {};
        server
            .mockEndpoint()
            .post("/v3/order/order_id/cancel")
            .respondWith()
            .statusCode(422)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.labTests.cancelOrder("order_id");
        }).rejects.toThrow(Vital.UnprocessableEntityError);
    });

    test("simulate_order_process (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .post("/v3/order/order_id/test")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.labTests.simulateOrderProcess("order_id", {
            finalStatus: "received.walk_in_test.ordered",
            delay: 1,
            body: {},
        });
        expect(response).toEqual({
            key: "value",
        });
    });

    test("simulate_order_process (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {};
        server
            .mockEndpoint()
            .post("/v3/order/order_id/test")
            .respondWith()
            .statusCode(422)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.labTests.simulateOrderProcess("order_id", {
                body: undefined,
            });
        }).rejects.toThrow(Vital.UnprocessableEntityError);
    });

    test("update_on_site_collection_order_draw_completed (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            order: {
                user_id: "03f79f9d-cd35-4db4-b7d7-2906437ce160",
                id: "416d4a99-806d-4344-bee7-ef870bb89290",
                team_id: "9e294e75-521a-4605-9a25-d14f8ea9ac9a",
                patient_details: {
                    first_name: "first_name",
                    last_name: "last_name",
                    dob: "2020-01-01T00:00:00Z",
                    gender: "male",
                    phone_number: "phone_number",
                    email: "email",
                    medical_proxy: {
                        first_name: "first_name",
                        last_name: "last_name",
                        address: {
                            first_line: "first_line",
                            country: "country",
                            zip: "zip",
                            city: "city",
                            state: "state",
                        },
                        phone_number: "phone_number",
                    },
                    race: "african_american_or_black",
                    ethnicity: "hispanic",
                    sexual_orientation: "lesbian_gay_or_homosexual",
                    gender_identity: "male",
                },
                patient_address: {
                    receiver_name: "John Doe",
                    first_line: "123 Main St.",
                    second_line: "Apt. 208",
                    city: "San Francisco",
                    state: "CA",
                    zip: "91189",
                    country: "United States",
                    phone_number: "+11234567890",
                },
                lab_test: {
                    id: "id",
                    slug: "slug",
                    name: "Lipids Panel",
                    sample_type: "dried_blood_spot",
                    method: "testkit",
                    price: 1.1,
                    is_active: true,
                    status: "active",
                    fasting: true,
                    lab: {
                        id: 1,
                        slug: "labcorp",
                        name: "LabCorp",
                        first_line_address: "123 Main St",
                        city: "San Francisco",
                        zipcode: "91789",
                        collection_methods: ["testkit"],
                        sample_types: ["saliva"],
                    },
                    markers: [
                        {
                            id: 1,
                            name: "Hemoglobin A1c",
                            slug: "hemoglobin-a1c",
                            description:
                                "Hemoglobin A1c is a form of hemoglobin that is measured identify your average blood sugar levels over the past 3 months.",
                            lab_id: 1,
                            provider_id: "1234",
                            type: "biomarker",
                            unit: "%",
                            price: "10.00",
                            aoe: {
                                questions: [
                                    {
                                        id: 1,
                                        required: true,
                                        code: "question_code",
                                        value: "question_value",
                                        type: "choice",
                                        sequence: 1,
                                        answers: [{ id: 1, code: "answer_code", value: "answer_value" }],
                                    },
                                ],
                            },
                            common_tat_days: 3,
                            worst_case_tat_days: 5,
                            is_orderable: true,
                        },
                    ],
                    auto_generated: true,
                    has_collection_instructions: true,
                    common_tat_days: 1,
                    worst_case_tat_days: 1,
                },
                details: {
                    type: "testkit",
                    data: {
                        id: "9e9b00fa-3c2b-4d6a-b0d5-a532d5f83f15",
                        shipment: {
                            id: "4008ec17-bab6-4f57-b0cb-40572a484b42",
                            outbound_tracking_number: "<outbound_tracking_number>",
                            outbound_tracking_url: "<outbound_tracking_url>",
                            inbound_tracking_number: "<inbound_tracking_number>",
                            inbound_tracking_url: "<inbound_tracking_url>",
                            outbound_courier: "usps",
                            inbound_courier: "usps",
                            notes: "<notes>",
                        },
                        created_at: "2020-01-01T00:00:00Z",
                        updated_at: "2020-01-01T00:00:00Z",
                    },
                },
                sample_id: "123456789",
                notes: "This is a note",
                created_at: "2020-01-01T00:00:00Z",
                updated_at: "2020-01-01T00:00:00Z",
                events: [
                    { id: 1, created_at: "2022-01-01T00:00:00Z", status: "received.testkit.ordered" },
                    { id: 2, created_at: "2022-01-02T00:00:00Z", status: "received.testkit.requisition_created" },
                    { id: 3, created_at: "2022-01-03T00:00:00Z", status: "collecting_sample.testkit.transit_customer" },
                ],
                status: "collecting_sample",
                physician: { first_name: "first_name", last_name: "last_name", npi: "npi" },
                health_insurance_id: "health_insurance_id",
                requisition_form_url: "https://www.example.com",
                priority: true,
                shipping_details: {
                    receiver_name: "receiver_name",
                    first_line: "first_line",
                    second_line: "second_line",
                    city: "city",
                    state: "state",
                    zip: "zip",
                    country: "country",
                    phone_number: "phone_number",
                },
                activate_by: "2020-01-01",
                passthrough: "passthrough",
                billing_type: "client_bill",
                icd_codes: ["icd_codes"],
                has_abn: false,
                interpretation: "normal",
                has_missing_results: true,
                expected_result_by_date: "expected_result_by_date",
                worst_case_result_by_date: "worst_case_result_by_date",
            },
            status: "status",
            message: "message",
        };
        server
            .mockEndpoint()
            .patch("/v3/order/order_id/draw_completed")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.labTests.updateOnSiteCollectionOrderDrawCompleted("order_id");
        expect(response).toEqual({
            order: {
                userId: "03f79f9d-cd35-4db4-b7d7-2906437ce160",
                id: "416d4a99-806d-4344-bee7-ef870bb89290",
                teamId: "9e294e75-521a-4605-9a25-d14f8ea9ac9a",
                patientDetails: {
                    firstName: "first_name",
                    lastName: "last_name",
                    dob: new Date("2020-01-01T00:00:00.000Z"),
                    gender: "male",
                    phoneNumber: "phone_number",
                    email: "email",
                    medicalProxy: {
                        firstName: "first_name",
                        lastName: "last_name",
                        address: {
                            firstLine: "first_line",
                            country: "country",
                            zip: "zip",
                            city: "city",
                            state: "state",
                        },
                        phoneNumber: "phone_number",
                    },
                    race: "african_american_or_black",
                    ethnicity: "hispanic",
                    sexualOrientation: "lesbian_gay_or_homosexual",
                    genderIdentity: "male",
                },
                patientAddress: {
                    receiverName: "John Doe",
                    firstLine: "123 Main St.",
                    secondLine: "Apt. 208",
                    city: "San Francisco",
                    state: "CA",
                    zip: "91189",
                    country: "United States",
                    phoneNumber: "+11234567890",
                },
                labTest: {
                    id: "id",
                    slug: "slug",
                    name: "Lipids Panel",
                    sampleType: "dried_blood_spot",
                    method: "testkit",
                    price: 1.1,
                    isActive: true,
                    status: "active",
                    fasting: true,
                    lab: {
                        id: 1,
                        slug: "labcorp",
                        name: "LabCorp",
                        firstLineAddress: "123 Main St",
                        city: "San Francisco",
                        zipcode: "91789",
                        collectionMethods: ["testkit"],
                        sampleTypes: ["saliva"],
                    },
                    markers: [
                        {
                            id: 1,
                            name: "Hemoglobin A1c",
                            slug: "hemoglobin-a1c",
                            description:
                                "Hemoglobin A1c is a form of hemoglobin that is measured identify your average blood sugar levels over the past 3 months.",
                            labId: 1,
                            providerId: "1234",
                            type: "biomarker",
                            unit: "%",
                            price: "10.00",
                            aoe: {
                                questions: [
                                    {
                                        id: 1,
                                        required: true,
                                        code: "question_code",
                                        value: "question_value",
                                        type: "choice",
                                        sequence: 1,
                                        answers: [
                                            {
                                                id: 1,
                                                code: "answer_code",
                                                value: "answer_value",
                                            },
                                        ],
                                    },
                                ],
                            },
                            commonTatDays: 3,
                            worstCaseTatDays: 5,
                            isOrderable: true,
                        },
                    ],
                    autoGenerated: true,
                    hasCollectionInstructions: true,
                    commonTatDays: 1,
                    worstCaseTatDays: 1,
                },
                details: {
                    type: "testkit",
                    data: {
                        id: "9e9b00fa-3c2b-4d6a-b0d5-a532d5f83f15",
                        shipment: {
                            id: "4008ec17-bab6-4f57-b0cb-40572a484b42",
                            outboundTrackingNumber: "<outbound_tracking_number>",
                            outboundTrackingUrl: "<outbound_tracking_url>",
                            inboundTrackingNumber: "<inbound_tracking_number>",
                            inboundTrackingUrl: "<inbound_tracking_url>",
                            outboundCourier: "usps",
                            inboundCourier: "usps",
                            notes: "<notes>",
                        },
                        createdAt: new Date("2020-01-01T00:00:00.000Z"),
                        updatedAt: new Date("2020-01-01T00:00:00.000Z"),
                    },
                },
                sampleId: "123456789",
                notes: "This is a note",
                createdAt: new Date("2020-01-01T00:00:00.000Z"),
                updatedAt: new Date("2020-01-01T00:00:00.000Z"),
                events: [
                    {
                        id: 1,
                        createdAt: new Date("2022-01-01T00:00:00.000Z"),
                        status: "received.testkit.ordered",
                    },
                    {
                        id: 2,
                        createdAt: new Date("2022-01-02T00:00:00.000Z"),
                        status: "received.testkit.requisition_created",
                    },
                    {
                        id: 3,
                        createdAt: new Date("2022-01-03T00:00:00.000Z"),
                        status: "collecting_sample.testkit.transit_customer",
                    },
                ],
                status: "collecting_sample",
                physician: {
                    firstName: "first_name",
                    lastName: "last_name",
                    npi: "npi",
                },
                healthInsuranceId: "health_insurance_id",
                requisitionFormUrl: "https://www.example.com",
                priority: true,
                shippingDetails: {
                    receiverName: "receiver_name",
                    firstLine: "first_line",
                    secondLine: "second_line",
                    city: "city",
                    state: "state",
                    zip: "zip",
                    country: "country",
                    phoneNumber: "phone_number",
                },
                activateBy: "2020-01-01",
                passthrough: "passthrough",
                billingType: "client_bill",
                icdCodes: ["icd_codes"],
                hasAbn: false,
                interpretation: "normal",
                hasMissingResults: true,
                expectedResultByDate: "expected_result_by_date",
                worstCaseResultByDate: "worst_case_result_by_date",
            },
            status: "status",
            message: "message",
        });
    });

    test("update_on_site_collection_order_draw_completed (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {};
        server
            .mockEndpoint()
            .patch("/v3/order/order_id/draw_completed")
            .respondWith()
            .statusCode(422)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.labTests.updateOnSiteCollectionOrderDrawCompleted("order_id");
        }).rejects.toThrow(Vital.UnprocessableEntityError);
    });

    test("validate_icd_codes (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { codes: ["codes"] };
        const rawResponseBody = {
            valid: true,
            errors: ["errors"],
            violations: [{ code: "code", conflicts_with: "conflicts_with", type: "type" }],
            warnings: [{ code: "code", overlaps_with: "overlaps_with", type: "type" }],
        };
        server
            .mockEndpoint()
            .post("/v3/insurance/validate_icd_codes")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.labTests.validateIcdCodes({
            codes: ["codes"],
        });
        expect(response).toEqual({
            valid: true,
            errors: ["errors"],
            violations: [
                {
                    code: "code",
                    conflictsWith: "conflicts_with",
                    type: "type",
                },
            ],
            warnings: [
                {
                    code: "code",
                    overlapsWith: "overlaps_with",
                    type: "type",
                },
            ],
        });
    });

    test("validate_icd_codes (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { codes: ["codes", "codes"] };
        const rawResponseBody = {};
        server
            .mockEndpoint()
            .post("/v3/insurance/validate_icd_codes")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(422)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.labTests.validateIcdCodes({
                codes: ["codes", "codes"],
            });
        }).rejects.toThrow(Vital.UnprocessableEntityError);
    });
});

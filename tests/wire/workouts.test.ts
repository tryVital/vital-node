// This file was auto-generated by Fern from our API Definition.

import * as Vital from "../../src/api/index";
import { VitalClient } from "../../src/Client";
import { mockServerPool } from "../mock-server/MockServerPool";

describe("WorkoutsClient", () => {
    test("get (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            workouts: [
                {
                    id: "185d0f34-dfc0-429f-84f9-b24030914bdd",
                    user_id: "1449752e-0d8a-40e0-9206-91ab099b2537",
                    title: "title",
                    timezone_offset: 1,
                    average_hr: 100,
                    max_hr: 190,
                    distance: 1700,
                    calendar_date: "2023-02-27",
                    time_start: "2023-02-27T11:31:24Z",
                    time_end: "2023-02-27T12:31:24Z",
                    calories: 300,
                    sport: { id: 1, name: "football", slug: "slug" },
                    hr_zones: [100, 90, 10, 10, 200],
                    moving_time: 100,
                    total_elevation_gain: 10,
                    elev_high: 20.2,
                    elev_low: -10.2,
                    average_speed: 4.2,
                    max_speed: 7.8,
                    average_watts: 100,
                    device_watts: 80,
                    max_watts: 200,
                    weighted_average_watts: 250,
                    steps: 1,
                    map: { summary_polyline: "agn~Ftb{uOvr@daBunBjdBkHwiD????~Ngn@ha@_N~Ql`@" },
                    provider_id: "provider_id",
                    source: { provider: "strava", type: "unknown", device_id: "550e8400-e29b-41d4-a716-446655440000" },
                    created_at: "2023-02-27T20:31:24Z",
                    updated_at: "2023-02-28T01:22:38Z",
                },
            ],
        };
        server
            .mockEndpoint()
            .get("/v2/summary/workouts/user_id")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.workouts.get("user_id", {
            provider: "provider",
            startDate: "start_date",
            endDate: "end_date",
        });
        expect(response).toEqual({
            workouts: [
                {
                    id: "185d0f34-dfc0-429f-84f9-b24030914bdd",
                    userId: "1449752e-0d8a-40e0-9206-91ab099b2537",
                    title: "title",
                    timezoneOffset: 1,
                    averageHr: 100,
                    maxHr: 190,
                    distance: 1700,
                    calendarDate: "2023-02-27",
                    timeStart: new Date("2023-02-27T11:31:24.000Z"),
                    timeEnd: new Date("2023-02-27T12:31:24.000Z"),
                    calories: 300,
                    sport: {
                        id: 1,
                        name: "football",
                        slug: "slug",
                    },
                    hrZones: [100, 90, 10, 10, 200],
                    movingTime: 100,
                    totalElevationGain: 10,
                    elevHigh: 20.2,
                    elevLow: -10.2,
                    averageSpeed: 4.2,
                    maxSpeed: 7.8,
                    averageWatts: 100,
                    deviceWatts: 80,
                    maxWatts: 200,
                    weightedAverageWatts: 250,
                    steps: 1,
                    map: {
                        summaryPolyline: "agn~Ftb{uOvr@daBunBjdBkHwiD????~Ngn@ha@_N~Ql`@",
                    },
                    providerId: "provider_id",
                    source: {
                        provider: "strava",
                        type: "unknown",
                        deviceId: "550e8400-e29b-41d4-a716-446655440000",
                    },
                    createdAt: new Date("2023-02-27T20:31:24.000Z"),
                    updatedAt: new Date("2023-02-28T01:22:38.000Z"),
                },
            ],
        });
    });

    test("get (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {};
        server
            .mockEndpoint()
            .get("/v2/summary/workouts/user_id")
            .respondWith()
            .statusCode(422)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.workouts.get("user_id", {
                startDate: "start_date",
            });
        }).rejects.toThrow(Vital.UnprocessableEntityError);
    });

    test("get_raw (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            workouts: [
                {
                    timestamp: "2023-02-27T12:31:24Z",
                    data: { provider_specific: "..._data" },
                    provider_id: "5e8271a3-e71b-4882-a94a-7e364694cd16",
                    user_id: "1449752e-0d8a-40e0-9206-91ab099b2537",
                    source_id: 1,
                    priority_id: 1,
                    id: "id",
                    sport_id: 3,
                    source: { name: "Oura", slug: "oura", logo: "https://logo_url.com" },
                    sport: { id: 1, name: "name", slug: "slug" },
                    source_device_id: "550e8400-e29b-41d4-a716-446655440000",
                    created_at: "2024-01-15T09:30:00Z",
                    updated_at: "2024-01-15T09:30:00Z",
                },
            ],
        };
        server
            .mockEndpoint()
            .get("/v2/summary/workouts/user_id/raw")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.workouts.getRaw("user_id", {
            provider: "provider",
            startDate: "start_date",
            endDate: "end_date",
        });
        expect(response).toEqual({
            workouts: [
                {
                    timestamp: new Date("2023-02-27T12:31:24.000Z"),
                    data: {
                        provider_specific: "..._data",
                    },
                    providerId: "5e8271a3-e71b-4882-a94a-7e364694cd16",
                    userId: "1449752e-0d8a-40e0-9206-91ab099b2537",
                    sourceId: 1,
                    priorityId: 1,
                    id: "id",
                    sportId: 3,
                    source: {
                        name: "Oura",
                        slug: "oura",
                        logo: "https://logo_url.com",
                    },
                    sport: {
                        id: 1,
                        name: "name",
                        slug: "slug",
                    },
                    sourceDeviceId: "550e8400-e29b-41d4-a716-446655440000",
                    createdAt: new Date("2024-01-15T09:30:00.000Z"),
                    updatedAt: new Date("2024-01-15T09:30:00.000Z"),
                },
            ],
        });
    });

    test("get_raw (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {};
        server
            .mockEndpoint()
            .get("/v2/summary/workouts/user_id/raw")
            .respondWith()
            .statusCode(422)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.workouts.getRaw("user_id", {
                startDate: "start_date",
            });
        }).rejects.toThrow(Vital.UnprocessableEntityError);
    });

    test("get_by_workout_id (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            cadence: [10, 12, 12, 11, 10],
            time: [1626625123, 1626625140, 1626625145, 1626625150, 162662560],
            altitude: [10, 20, 30, 40, 50],
            velocity_smooth: [10, 20, 30, 40, 50],
            heartrate: [120, 125, 125, 130, 135],
            lat: [10, 20, 30, 40, 50],
            lng: [10, 20, 30, 40, 50],
            distance: [12, 15, 18, 20, 25],
            power: [100, 100, 100, 100, 100],
            resistance: [10, 20, 30, 40, 50],
            temperature: [1.1],
        };
        server
            .mockEndpoint()
            .get("/v2/timeseries/workouts/workout_id/stream")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.workouts.getByWorkoutId("workout_id");
        expect(response).toEqual({
            cadence: [10, 12, 12, 11, 10],
            time: [1626625123, 1626625140, 1626625145, 1626625150, 162662560],
            altitude: [10, 20, 30, 40, 50],
            velocitySmooth: [10, 20, 30, 40, 50],
            heartrate: [120, 125, 125, 130, 135],
            lat: [10, 20, 30, 40, 50],
            lng: [10, 20, 30, 40, 50],
            distance: [12, 15, 18, 20, 25],
            power: [100, 100, 100, 100, 100],
            resistance: [10, 20, 30, 40, 50],
            temperature: [1.1],
        });
    });

    test("get_by_workout_id (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {};
        server
            .mockEndpoint()
            .get("/v2/timeseries/workouts/workout_id/stream")
            .respondWith()
            .statusCode(422)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.workouts.getByWorkoutId("workout_id");
        }).rejects.toThrow(Vital.UnprocessableEntityError);
    });
});

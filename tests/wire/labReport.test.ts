// This file was auto-generated by Fern from our API Definition.

import * as Vital from "../../src/api/index";
import { VitalClient } from "../../src/Client";
import { mockServerPool } from "../mock-server/MockServerPool";

describe("LabReportClient", () => {
    test("parser_get_job (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            id: "id",
            job_id: "job_id",
            status: "upload_pending",
            failure_reason: "invalid_input",
            data: {
                metadata: {
                    patient_first_name: "patient_first_name",
                    patient_last_name: "patient_last_name",
                    dob: "dob",
                    lab_name: "lab_name",
                    date_reported: "date_reported",
                    date_collected: "date_collected",
                    specimen_number: "specimen_number",
                },
                results: [{ test_name: "test_name", value: "value" }],
            },
            needs_human_review: true,
            is_reviewed: true,
        };
        server
            .mockEndpoint()
            .get("/lab_report/v1/parser/job/job_id")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.labReport.parserGetJob("job_id");
        expect(response).toEqual({
            id: "id",
            jobId: "job_id",
            status: "upload_pending",
            failureReason: "invalid_input",
            data: {
                metadata: {
                    patientFirstName: "patient_first_name",
                    patientLastName: "patient_last_name",
                    dob: "dob",
                    labName: "lab_name",
                    dateReported: "date_reported",
                    dateCollected: "date_collected",
                    specimenNumber: "specimen_number",
                },
                results: [
                    {
                        testName: "test_name",
                        value: "value",
                    },
                ],
            },
            needsHumanReview: true,
            isReviewed: true,
        });
    });

    test("parser_get_job (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {};
        server
            .mockEndpoint()
            .get("/lab_report/v1/parser/job/job_id")
            .respondWith()
            .statusCode(422)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.labReport.parserGetJob("job_id");
        }).rejects.toThrow(Vital.UnprocessableEntityError);
    });
});

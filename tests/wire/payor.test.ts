// This file was auto-generated by Fern from our API Definition.

import * as Vital from "../../src/api/index";
import { VitalClient } from "../../src/Client";
import { mockServerPool } from "../mock-server/MockServerPool";

describe("PayorClient", () => {
    test("create_payor (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {
            name: "name",
            address: { first_line: "first_line", country: "country", zip: "zip", city: "city", state: "state" },
        };
        const rawResponseBody = {
            payor_code: "payor_code",
            name: "name",
            aliases: ["aliases"],
            org_address: {
                first_line: "first_line",
                second_line: "second_line",
                country: "country",
                zip: "zip",
                city: "city",
                state: "state",
            },
            source: "platform",
        };
        server
            .mockEndpoint()
            .post("/v3/payor")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.payor.createPayor({
            name: "name",
            address: {
                firstLine: "first_line",
                country: "country",
                zip: "zip",
                city: "city",
                state: "state",
            },
        });
        expect(response).toEqual({
            payorCode: "payor_code",
            name: "name",
            aliases: ["aliases"],
            orgAddress: {
                firstLine: "first_line",
                secondLine: "second_line",
                country: "country",
                zip: "zip",
                city: "city",
                state: "state",
            },
            source: "platform",
        });
    });

    test("create_payor (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {
            name: "name",
            address: { first_line: "first_line", country: "country", zip: "zip", city: "city", state: "state" },
        };
        const rawResponseBody = {};
        server
            .mockEndpoint()
            .post("/v3/payor")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(422)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.payor.createPayor({
                name: "name",
                address: {
                    firstLine: "first_line",
                    country: "country",
                    zip: "zip",
                    city: "city",
                    state: "state",
                },
            });
        }).rejects.toThrow(Vital.UnprocessableEntityError);
    });
});

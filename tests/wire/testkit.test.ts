// This file was auto-generated by Fern from our API Definition.

import * as Vital from "../../src/api/index";
import { VitalClient } from "../../src/Client";
import { mockServerPool } from "../mock-server/MockServerPool";

describe("TestkitClient", () => {
    test("register (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {
            sample_id: "sample_id",
            patient_details: {
                first_name: "first_name",
                last_name: "last_name",
                dob: "dob",
                gender: "female",
                phone_number: "phone_number",
                email: "email",
            },
            patient_address: { first_line: "first_line", city: "city", state: "state", zip: "zip", country: "country" },
        };
        const rawResponseBody = {
            order: {
                user_id: "322dcd6d-c3f5-488e-8ac1-b06cb1e2c7cb",
                id: "d8744152-63c4-468e-8e5a-ddb7035dbdb3",
                team_id: "052e26cb-7c51-4550-81dc-ef1bd6460626",
                patient_details: {
                    first_name: "first_name",
                    last_name: "last_name",
                    dob: "2020-01-01T00:00:00Z",
                    gender: "male",
                    phone_number: "phone_number",
                    email: "email",
                    medical_proxy: {
                        first_name: "first_name",
                        last_name: "last_name",
                        address: {
                            first_line: "first_line",
                            country: "country",
                            zip: "zip",
                            city: "city",
                            state: "state",
                        },
                        phone_number: "phone_number",
                    },
                    race: "african_american_or_black",
                    ethnicity: "hispanic",
                    sexual_orientation: "lesbian_gay_or_homosexual",
                    gender_identity: "male",
                },
                patient_address: {
                    receiver_name: "John Doe",
                    first_line: "123 Main St.",
                    second_line: "Apt. 208",
                    city: "San Francisco",
                    state: "CA",
                    zip: "91189",
                    country: "United States",
                    phone_number: "+11234567890",
                },
                lab_test: {
                    id: "id",
                    slug: "slug",
                    name: "Lipids Panel",
                    sample_type: "dried_blood_spot",
                    method: "testkit",
                    price: 1.1,
                    is_active: true,
                    status: "active",
                    fasting: true,
                    lab: {
                        id: 1,
                        slug: "labcorp",
                        name: "LabCorp",
                        first_line_address: "123 Main St",
                        city: "San Francisco",
                        zipcode: "91789",
                        collection_methods: ["testkit"],
                        sample_types: ["saliva"],
                    },
                    markers: [
                        {
                            id: 1,
                            name: "Hemoglobin A1c",
                            slug: "hemoglobin-a1c",
                            description:
                                "Hemoglobin A1c is a form of hemoglobin that is measured identify your average blood sugar levels over the past 3 months.",
                            lab_id: 1,
                            provider_id: "1234",
                            type: "biomarker",
                            unit: "%",
                            price: "10.00",
                            aoe: {
                                questions: [
                                    {
                                        id: 1,
                                        required: true,
                                        code: "question_code",
                                        value: "question_value",
                                        type: "choice",
                                        sequence: 1,
                                        answers: [{ id: 1, code: "answer_code", value: "answer_value" }],
                                    },
                                ],
                            },
                            common_tat_days: 3,
                            worst_case_tat_days: 5,
                            is_orderable: true,
                        },
                    ],
                    auto_generated: true,
                    has_collection_instructions: true,
                    common_tat_days: 1,
                    worst_case_tat_days: 1,
                },
                details: {
                    type: "testkit",
                    data: {
                        id: "5ea59e26-4d6d-41c1-9e54-fea511a8297d",
                        shipment: {
                            id: "533375da-a15f-44e0-8517-9060e8ad7f44",
                            outbound_tracking_number: "<outbound_tracking_number>",
                            outbound_tracking_url: "<outbound_tracking_url>",
                            inbound_tracking_number: "<inbound_tracking_number>",
                            inbound_tracking_url: "<inbound_tracking_url>",
                            outbound_courier: "usps",
                            inbound_courier: "usps",
                            notes: "<notes>",
                        },
                        created_at: "2020-01-01T00:00:00Z",
                        updated_at: "2020-01-01T00:00:00Z",
                    },
                },
                sample_id: "123456789",
                notes: "This is a note",
                created_at: "2020-01-01T00:00:00Z",
                updated_at: "2020-01-01T00:00:00Z",
                events: [
                    { id: 1, created_at: "2022-01-01T00:00:00Z", status: "received.testkit.ordered" },
                    { id: 2, created_at: "2022-01-02T00:00:00Z", status: "received.testkit.requisition_created" },
                    { id: 3, created_at: "2022-01-03T00:00:00Z", status: "collecting_sample.testkit.transit_customer" },
                ],
                status: "collecting_sample",
                physician: { first_name: "first_name", last_name: "last_name", npi: "npi" },
                health_insurance_id: "health_insurance_id",
                requisition_form_url: "https://www.example.com",
                priority: true,
                shipping_details: {
                    receiver_name: "receiver_name",
                    first_line: "first_line",
                    second_line: "second_line",
                    city: "city",
                    state: "state",
                    zip: "zip",
                    country: "country",
                    phone_number: "phone_number",
                },
                activate_by: "2020-01-01",
                passthrough: "passthrough",
                billing_type: "client_bill",
                icd_codes: ["icd_codes"],
                has_abn: false,
                interpretation: "normal",
                has_missing_results: true,
                expected_result_by_date: "expected_result_by_date",
                worst_case_result_by_date: "worst_case_result_by_date",
            },
            status: "status",
            message: "message",
        };
        server
            .mockEndpoint()
            .post("/v3/order/testkit/register")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.testkit.register({
            sampleId: "sample_id",
            patientDetails: {
                firstName: "first_name",
                lastName: "last_name",
                dob: "dob",
                gender: "female",
                phoneNumber: "phone_number",
                email: "email",
            },
            patientAddress: {
                firstLine: "first_line",
                city: "city",
                state: "state",
                zip: "zip",
                country: "country",
            },
        });
        expect(response).toEqual({
            order: {
                userId: "322dcd6d-c3f5-488e-8ac1-b06cb1e2c7cb",
                id: "d8744152-63c4-468e-8e5a-ddb7035dbdb3",
                teamId: "052e26cb-7c51-4550-81dc-ef1bd6460626",
                patientDetails: {
                    firstName: "first_name",
                    lastName: "last_name",
                    dob: new Date("2020-01-01T00:00:00.000Z"),
                    gender: "male",
                    phoneNumber: "phone_number",
                    email: "email",
                    medicalProxy: {
                        firstName: "first_name",
                        lastName: "last_name",
                        address: {
                            firstLine: "first_line",
                            country: "country",
                            zip: "zip",
                            city: "city",
                            state: "state",
                        },
                        phoneNumber: "phone_number",
                    },
                    race: "african_american_or_black",
                    ethnicity: "hispanic",
                    sexualOrientation: "lesbian_gay_or_homosexual",
                    genderIdentity: "male",
                },
                patientAddress: {
                    receiverName: "John Doe",
                    firstLine: "123 Main St.",
                    secondLine: "Apt. 208",
                    city: "San Francisco",
                    state: "CA",
                    zip: "91189",
                    country: "United States",
                    phoneNumber: "+11234567890",
                },
                labTest: {
                    id: "id",
                    slug: "slug",
                    name: "Lipids Panel",
                    sampleType: "dried_blood_spot",
                    method: "testkit",
                    price: 1.1,
                    isActive: true,
                    status: "active",
                    fasting: true,
                    lab: {
                        id: 1,
                        slug: "labcorp",
                        name: "LabCorp",
                        firstLineAddress: "123 Main St",
                        city: "San Francisco",
                        zipcode: "91789",
                        collectionMethods: ["testkit"],
                        sampleTypes: ["saliva"],
                    },
                    markers: [
                        {
                            id: 1,
                            name: "Hemoglobin A1c",
                            slug: "hemoglobin-a1c",
                            description:
                                "Hemoglobin A1c is a form of hemoglobin that is measured identify your average blood sugar levels over the past 3 months.",
                            labId: 1,
                            providerId: "1234",
                            type: "biomarker",
                            unit: "%",
                            price: "10.00",
                            aoe: {
                                questions: [
                                    {
                                        id: 1,
                                        required: true,
                                        code: "question_code",
                                        value: "question_value",
                                        type: "choice",
                                        sequence: 1,
                                        answers: [
                                            {
                                                id: 1,
                                                code: "answer_code",
                                                value: "answer_value",
                                            },
                                        ],
                                    },
                                ],
                            },
                            commonTatDays: 3,
                            worstCaseTatDays: 5,
                            isOrderable: true,
                        },
                    ],
                    autoGenerated: true,
                    hasCollectionInstructions: true,
                    commonTatDays: 1,
                    worstCaseTatDays: 1,
                },
                details: {
                    type: "testkit",
                    data: {
                        id: "5ea59e26-4d6d-41c1-9e54-fea511a8297d",
                        shipment: {
                            id: "533375da-a15f-44e0-8517-9060e8ad7f44",
                            outboundTrackingNumber: "<outbound_tracking_number>",
                            outboundTrackingUrl: "<outbound_tracking_url>",
                            inboundTrackingNumber: "<inbound_tracking_number>",
                            inboundTrackingUrl: "<inbound_tracking_url>",
                            outboundCourier: "usps",
                            inboundCourier: "usps",
                            notes: "<notes>",
                        },
                        createdAt: new Date("2020-01-01T00:00:00.000Z"),
                        updatedAt: new Date("2020-01-01T00:00:00.000Z"),
                    },
                },
                sampleId: "123456789",
                notes: "This is a note",
                createdAt: new Date("2020-01-01T00:00:00.000Z"),
                updatedAt: new Date("2020-01-01T00:00:00.000Z"),
                events: [
                    {
                        id: 1,
                        createdAt: new Date("2022-01-01T00:00:00.000Z"),
                        status: "received.testkit.ordered",
                    },
                    {
                        id: 2,
                        createdAt: new Date("2022-01-02T00:00:00.000Z"),
                        status: "received.testkit.requisition_created",
                    },
                    {
                        id: 3,
                        createdAt: new Date("2022-01-03T00:00:00.000Z"),
                        status: "collecting_sample.testkit.transit_customer",
                    },
                ],
                status: "collecting_sample",
                physician: {
                    firstName: "first_name",
                    lastName: "last_name",
                    npi: "npi",
                },
                healthInsuranceId: "health_insurance_id",
                requisitionFormUrl: "https://www.example.com",
                priority: true,
                shippingDetails: {
                    receiverName: "receiver_name",
                    firstLine: "first_line",
                    secondLine: "second_line",
                    city: "city",
                    state: "state",
                    zip: "zip",
                    country: "country",
                    phoneNumber: "phone_number",
                },
                activateBy: "2020-01-01",
                passthrough: "passthrough",
                billingType: "client_bill",
                icdCodes: ["icd_codes"],
                hasAbn: false,
                interpretation: "normal",
                hasMissingResults: true,
                expectedResultByDate: "expected_result_by_date",
                worstCaseResultByDate: "worst_case_result_by_date",
            },
            status: "status",
            message: "message",
        });
    });

    test("register (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {
            sample_id: "sample_id",
            patient_details: {
                first_name: "x",
                last_name: "x",
                dob: "dob",
                gender: "female",
                phone_number: "phone_number",
                email: "email",
            },
            patient_address: { first_line: "first_line", city: "city", state: "state", zip: "zip", country: "country" },
        };
        const rawResponseBody = {};
        server
            .mockEndpoint()
            .post("/v3/order/testkit/register")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(422)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.testkit.register({
                sampleId: "sample_id",
                patientDetails: {
                    firstName: "x",
                    lastName: "x",
                    dob: "dob",
                    gender: "female",
                    phoneNumber: "phone_number",
                    email: "email",
                },
                patientAddress: {
                    firstLine: "first_line",
                    city: "city",
                    state: "state",
                    zip: "zip",
                    country: "country",
                },
            });
        }).rejects.toThrow(Vital.UnprocessableEntityError);
    });

    test("create_order (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {
            user_id: "user_id",
            lab_test_id: "lab_test_id",
            shipping_details: {
                receiver_name: "receiver_name",
                first_line: "first_line",
                city: "city",
                state: "state",
                zip: "zip",
                country: "country",
                phone_number: "phone_number",
            },
        };
        const rawResponseBody = {
            order: {
                user_id: "322dcd6d-c3f5-488e-8ac1-b06cb1e2c7cb",
                id: "d8744152-63c4-468e-8e5a-ddb7035dbdb3",
                team_id: "052e26cb-7c51-4550-81dc-ef1bd6460626",
                patient_details: {
                    first_name: "first_name",
                    last_name: "last_name",
                    dob: "2020-01-01T00:00:00Z",
                    gender: "male",
                    phone_number: "phone_number",
                    email: "email",
                    medical_proxy: {
                        first_name: "first_name",
                        last_name: "last_name",
                        address: {
                            first_line: "first_line",
                            country: "country",
                            zip: "zip",
                            city: "city",
                            state: "state",
                        },
                        phone_number: "phone_number",
                    },
                    race: "african_american_or_black",
                    ethnicity: "hispanic",
                    sexual_orientation: "lesbian_gay_or_homosexual",
                    gender_identity: "male",
                },
                patient_address: {
                    receiver_name: "John Doe",
                    first_line: "123 Main St.",
                    second_line: "Apt. 208",
                    city: "San Francisco",
                    state: "CA",
                    zip: "91189",
                    country: "United States",
                    phone_number: "+11234567890",
                },
                lab_test: {
                    id: "id",
                    slug: "slug",
                    name: "Lipids Panel",
                    sample_type: "dried_blood_spot",
                    method: "testkit",
                    price: 1.1,
                    is_active: true,
                    status: "active",
                    fasting: true,
                    lab: {
                        id: 1,
                        slug: "labcorp",
                        name: "LabCorp",
                        first_line_address: "123 Main St",
                        city: "San Francisco",
                        zipcode: "91789",
                        collection_methods: ["testkit"],
                        sample_types: ["saliva"],
                    },
                    markers: [
                        {
                            id: 1,
                            name: "Hemoglobin A1c",
                            slug: "hemoglobin-a1c",
                            description:
                                "Hemoglobin A1c is a form of hemoglobin that is measured identify your average blood sugar levels over the past 3 months.",
                            lab_id: 1,
                            provider_id: "1234",
                            type: "biomarker",
                            unit: "%",
                            price: "10.00",
                            aoe: {
                                questions: [
                                    {
                                        id: 1,
                                        required: true,
                                        code: "question_code",
                                        value: "question_value",
                                        type: "choice",
                                        sequence: 1,
                                        answers: [{ id: 1, code: "answer_code", value: "answer_value" }],
                                    },
                                ],
                            },
                            common_tat_days: 3,
                            worst_case_tat_days: 5,
                            is_orderable: true,
                        },
                    ],
                    auto_generated: true,
                    has_collection_instructions: true,
                    common_tat_days: 1,
                    worst_case_tat_days: 1,
                },
                details: {
                    type: "testkit",
                    data: {
                        id: "5ea59e26-4d6d-41c1-9e54-fea511a8297d",
                        shipment: {
                            id: "533375da-a15f-44e0-8517-9060e8ad7f44",
                            outbound_tracking_number: "<outbound_tracking_number>",
                            outbound_tracking_url: "<outbound_tracking_url>",
                            inbound_tracking_number: "<inbound_tracking_number>",
                            inbound_tracking_url: "<inbound_tracking_url>",
                            outbound_courier: "usps",
                            inbound_courier: "usps",
                            notes: "<notes>",
                        },
                        created_at: "2020-01-01T00:00:00Z",
                        updated_at: "2020-01-01T00:00:00Z",
                    },
                },
                sample_id: "123456789",
                notes: "This is a note",
                created_at: "2020-01-01T00:00:00Z",
                updated_at: "2020-01-01T00:00:00Z",
                events: [
                    { id: 1, created_at: "2022-01-01T00:00:00Z", status: "received.testkit.ordered" },
                    { id: 2, created_at: "2022-01-02T00:00:00Z", status: "received.testkit.requisition_created" },
                    { id: 3, created_at: "2022-01-03T00:00:00Z", status: "collecting_sample.testkit.transit_customer" },
                ],
                status: "collecting_sample",
                physician: { first_name: "first_name", last_name: "last_name", npi: "npi" },
                health_insurance_id: "health_insurance_id",
                requisition_form_url: "https://www.example.com",
                priority: true,
                shipping_details: {
                    receiver_name: "receiver_name",
                    first_line: "first_line",
                    second_line: "second_line",
                    city: "city",
                    state: "state",
                    zip: "zip",
                    country: "country",
                    phone_number: "phone_number",
                },
                activate_by: "2020-01-01",
                passthrough: "passthrough",
                billing_type: "client_bill",
                icd_codes: ["icd_codes"],
                has_abn: false,
                interpretation: "normal",
                has_missing_results: true,
                expected_result_by_date: "expected_result_by_date",
                worst_case_result_by_date: "worst_case_result_by_date",
            },
            status: "status",
            message: "message",
        };
        server
            .mockEndpoint()
            .post("/v3/order/testkit")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.testkit.createOrder({
            userId: "user_id",
            labTestId: "lab_test_id",
            shippingDetails: {
                receiverName: "receiver_name",
                firstLine: "first_line",
                city: "city",
                state: "state",
                zip: "zip",
                country: "country",
                phoneNumber: "phone_number",
            },
        });
        expect(response).toEqual({
            order: {
                userId: "322dcd6d-c3f5-488e-8ac1-b06cb1e2c7cb",
                id: "d8744152-63c4-468e-8e5a-ddb7035dbdb3",
                teamId: "052e26cb-7c51-4550-81dc-ef1bd6460626",
                patientDetails: {
                    firstName: "first_name",
                    lastName: "last_name",
                    dob: new Date("2020-01-01T00:00:00.000Z"),
                    gender: "male",
                    phoneNumber: "phone_number",
                    email: "email",
                    medicalProxy: {
                        firstName: "first_name",
                        lastName: "last_name",
                        address: {
                            firstLine: "first_line",
                            country: "country",
                            zip: "zip",
                            city: "city",
                            state: "state",
                        },
                        phoneNumber: "phone_number",
                    },
                    race: "african_american_or_black",
                    ethnicity: "hispanic",
                    sexualOrientation: "lesbian_gay_or_homosexual",
                    genderIdentity: "male",
                },
                patientAddress: {
                    receiverName: "John Doe",
                    firstLine: "123 Main St.",
                    secondLine: "Apt. 208",
                    city: "San Francisco",
                    state: "CA",
                    zip: "91189",
                    country: "United States",
                    phoneNumber: "+11234567890",
                },
                labTest: {
                    id: "id",
                    slug: "slug",
                    name: "Lipids Panel",
                    sampleType: "dried_blood_spot",
                    method: "testkit",
                    price: 1.1,
                    isActive: true,
                    status: "active",
                    fasting: true,
                    lab: {
                        id: 1,
                        slug: "labcorp",
                        name: "LabCorp",
                        firstLineAddress: "123 Main St",
                        city: "San Francisco",
                        zipcode: "91789",
                        collectionMethods: ["testkit"],
                        sampleTypes: ["saliva"],
                    },
                    markers: [
                        {
                            id: 1,
                            name: "Hemoglobin A1c",
                            slug: "hemoglobin-a1c",
                            description:
                                "Hemoglobin A1c is a form of hemoglobin that is measured identify your average blood sugar levels over the past 3 months.",
                            labId: 1,
                            providerId: "1234",
                            type: "biomarker",
                            unit: "%",
                            price: "10.00",
                            aoe: {
                                questions: [
                                    {
                                        id: 1,
                                        required: true,
                                        code: "question_code",
                                        value: "question_value",
                                        type: "choice",
                                        sequence: 1,
                                        answers: [
                                            {
                                                id: 1,
                                                code: "answer_code",
                                                value: "answer_value",
                                            },
                                        ],
                                    },
                                ],
                            },
                            commonTatDays: 3,
                            worstCaseTatDays: 5,
                            isOrderable: true,
                        },
                    ],
                    autoGenerated: true,
                    hasCollectionInstructions: true,
                    commonTatDays: 1,
                    worstCaseTatDays: 1,
                },
                details: {
                    type: "testkit",
                    data: {
                        id: "5ea59e26-4d6d-41c1-9e54-fea511a8297d",
                        shipment: {
                            id: "533375da-a15f-44e0-8517-9060e8ad7f44",
                            outboundTrackingNumber: "<outbound_tracking_number>",
                            outboundTrackingUrl: "<outbound_tracking_url>",
                            inboundTrackingNumber: "<inbound_tracking_number>",
                            inboundTrackingUrl: "<inbound_tracking_url>",
                            outboundCourier: "usps",
                            inboundCourier: "usps",
                            notes: "<notes>",
                        },
                        createdAt: new Date("2020-01-01T00:00:00.000Z"),
                        updatedAt: new Date("2020-01-01T00:00:00.000Z"),
                    },
                },
                sampleId: "123456789",
                notes: "This is a note",
                createdAt: new Date("2020-01-01T00:00:00.000Z"),
                updatedAt: new Date("2020-01-01T00:00:00.000Z"),
                events: [
                    {
                        id: 1,
                        createdAt: new Date("2022-01-01T00:00:00.000Z"),
                        status: "received.testkit.ordered",
                    },
                    {
                        id: 2,
                        createdAt: new Date("2022-01-02T00:00:00.000Z"),
                        status: "received.testkit.requisition_created",
                    },
                    {
                        id: 3,
                        createdAt: new Date("2022-01-03T00:00:00.000Z"),
                        status: "collecting_sample.testkit.transit_customer",
                    },
                ],
                status: "collecting_sample",
                physician: {
                    firstName: "first_name",
                    lastName: "last_name",
                    npi: "npi",
                },
                healthInsuranceId: "health_insurance_id",
                requisitionFormUrl: "https://www.example.com",
                priority: true,
                shippingDetails: {
                    receiverName: "receiver_name",
                    firstLine: "first_line",
                    secondLine: "second_line",
                    city: "city",
                    state: "state",
                    zip: "zip",
                    country: "country",
                    phoneNumber: "phone_number",
                },
                activateBy: "2020-01-01",
                passthrough: "passthrough",
                billingType: "client_bill",
                icdCodes: ["icd_codes"],
                hasAbn: false,
                interpretation: "normal",
                hasMissingResults: true,
                expectedResultByDate: "expected_result_by_date",
                worstCaseResultByDate: "worst_case_result_by_date",
            },
            status: "status",
            message: "message",
        });
    });

    test("create_order (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {
            user_id: "user_id",
            lab_test_id: "lab_test_id",
            shipping_details: {
                receiver_name: "receiver_name",
                first_line: "first_line",
                city: "city",
                state: "state",
                zip: "zip",
                country: "country",
                phone_number: "phone_number",
            },
        };
        const rawResponseBody = {};
        server
            .mockEndpoint()
            .post("/v3/order/testkit")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(422)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.testkit.createOrder({
                userId: "user_id",
                labTestId: "lab_test_id",
                shippingDetails: {
                    receiverName: "receiver_name",
                    firstLine: "first_line",
                    city: "city",
                    state: "state",
                    zip: "zip",
                    country: "country",
                    phoneNumber: "phone_number",
                },
            });
        }).rejects.toThrow(Vital.UnprocessableEntityError);
    });
});

// This file was auto-generated by Fern from our API Definition.

import * as Vital from "../../src/api/index";
import { VitalClient } from "../../src/Client";
import { mockServerPool } from "../mock-server/MockServerPool";

describe("LinkClient", () => {
    test("list_bulk_ops (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            data: [
                {
                    type: "link_bulk_import",
                    status: "in_progress",
                    provider: "oura",
                    pending: 1,
                    processed: 1,
                    started_at: "2024-01-15T09:30:00Z",
                    ended_at: "2024-01-15T09:30:00Z",
                },
            ],
            next_cursor: "next_cursor",
        };
        server.mockEndpoint().get("/v2/link/bulk_op").respondWith().statusCode(200).jsonBody(rawResponseBody).build();

        const response = await client.link.listBulkOps({
            nextCursor: "next_cursor",
            pageSize: 1,
            teamId: "infer_from_context",
        });
        expect(response).toEqual({
            data: [
                {
                    type: "link_bulk_import",
                    status: "in_progress",
                    provider: "oura",
                    pending: 1,
                    processed: 1,
                    startedAt: new Date("2024-01-15T09:30:00.000Z"),
                    endedAt: new Date("2024-01-15T09:30:00.000Z"),
                },
            ],
            nextCursor: "next_cursor",
        });
    });

    test("list_bulk_ops (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {};
        server.mockEndpoint().get("/v2/link/bulk_op").respondWith().statusCode(422).jsonBody(rawResponseBody).build();

        await expect(async () => {
            return await client.link.listBulkOps();
        }).rejects.toThrow(Vital.UnprocessableEntityError);
    });

    test("bulk_import (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {
            provider: "oura",
            connections: [
                {
                    user_id: "user_id",
                    access_token: "access_token",
                    refresh_token: "refresh_token",
                    provider_id: "provider_id",
                    expires_at: 1,
                },
            ],
        };
        const rawResponseBody = { user_ids_imported: ["user_ids_imported"], user_ids_failed: ["user_ids_failed"] };
        server
            .mockEndpoint()
            .post("/v2/link/bulk_import")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.link.bulkImport({
            teamId: "infer_from_context",
            provider: "oura",
            connections: [
                {
                    userId: "user_id",
                    accessToken: "access_token",
                    refreshToken: "refresh_token",
                    providerId: "provider_id",
                    expiresAt: 1,
                },
            ],
        });
        expect(response).toEqual({
            userIdsImported: ["user_ids_imported"],
            userIdsFailed: ["user_ids_failed"],
        });
    });

    test("bulk_import (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {
            provider: "oura",
            connections: [
                {
                    user_id: "user_id",
                    access_token: "access_token",
                    refresh_token: "refresh_token",
                    provider_id: "provider_id",
                    expires_at: 1,
                },
                {
                    user_id: "user_id",
                    access_token: "access_token",
                    refresh_token: "refresh_token",
                    provider_id: "provider_id",
                    expires_at: 1,
                },
            ],
        };
        const rawResponseBody = {};
        server
            .mockEndpoint()
            .post("/v2/link/bulk_import")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(422)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.link.bulkImport({
                provider: "oura",
                connections: [
                    {
                        userId: "user_id",
                        accessToken: "access_token",
                        refreshToken: "refresh_token",
                        providerId: "provider_id",
                        expiresAt: 1,
                    },
                    {
                        userId: "user_id",
                        accessToken: "access_token",
                        refreshToken: "refresh_token",
                        providerId: "provider_id",
                        expiresAt: 1,
                    },
                ],
            });
        }).rejects.toThrow(Vital.UnprocessableEntityError);
    });

    test("bulk_trigger_historical_pull (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { user_ids: ["user_ids"], provider: "oura" };
        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .post("/v2/link/bulk_trigger_historical_pull")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.link.bulkTriggerHistoricalPull({
            teamId: "infer_from_context",
            userIds: ["user_ids"],
            provider: "oura",
        });
        expect(response).toEqual({
            key: "value",
        });
    });

    test("bulk_trigger_historical_pull (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { user_ids: ["user_ids", "user_ids"], provider: "oura" };
        const rawResponseBody = {};
        server
            .mockEndpoint()
            .post("/v2/link/bulk_trigger_historical_pull")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(422)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.link.bulkTriggerHistoricalPull({
                userIds: ["user_ids", "user_ids"],
                provider: "oura",
            });
        }).rejects.toThrow(Vital.UnprocessableEntityError);
    });

    test("bulk_export (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { provider: "oura" };
        const rawResponseBody = {
            data: [
                {
                    user_id: "user_id",
                    access_token: "access_token",
                    refresh_token: "refresh_token",
                    provider_id: "provider_id",
                    expires_at: 1,
                    oauth_scopes: ["oauth_scopes"],
                },
            ],
            next_token: "next_token",
        };
        server
            .mockEndpoint()
            .post("/v2/link/bulk_export")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.link.bulkExport({
            teamId: "infer_from_context",
            provider: "oura",
        });
        expect(response).toEqual({
            data: [
                {
                    userId: "user_id",
                    accessToken: "access_token",
                    refreshToken: "refresh_token",
                    providerId: "provider_id",
                    expiresAt: 1,
                    oauthScopes: ["oauth_scopes"],
                },
            ],
            nextToken: "next_token",
        });
    });

    test("bulk_export (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { provider: "oura" };
        const rawResponseBody = {};
        server
            .mockEndpoint()
            .post("/v2/link/bulk_export")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(422)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.link.bulkExport({
                provider: "oura",
            });
        }).rejects.toThrow(Vital.UnprocessableEntityError);
    });

    test("bulk_pause (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { user_ids: ["user_ids"], provider: "oura" };
        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .post("/v2/link/bulk_pause")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.link.bulkPause({
            teamId: "infer_from_context",
            userIds: ["user_ids"],
            provider: "oura",
        });
        expect(response).toEqual({
            key: "value",
        });
    });

    test("bulk_pause (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { user_ids: ["user_ids", "user_ids"], provider: "oura" };
        const rawResponseBody = {};
        server
            .mockEndpoint()
            .post("/v2/link/bulk_pause")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(422)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.link.bulkPause({
                userIds: ["user_ids", "user_ids"],
                provider: "oura",
            });
        }).rejects.toThrow(Vital.UnprocessableEntityError);
    });

    test("token (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { user_id: "user_id" };
        const rawResponseBody = {
            link_token: "dGVzdCB0ZXN0IHRlc3Q=",
            link_web_url: "https://link.tryvital.io/?token=dGVzdCB0ZXN0IHRlc3Q%3D&env=production&region=us",
        };
        server
            .mockEndpoint()
            .post("/v2/link/token")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.link.token({
            userId: "user_id",
        });
        expect(response).toEqual({
            linkToken: "dGVzdCB0ZXN0IHRlc3Q=",
            linkWebUrl: "https://link.tryvital.io/?token=dGVzdCB0ZXN0IHRlc3Q%3D&env=production&region=us",
        });
    });

    test("token (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { user_id: "user_id" };
        const rawResponseBody = {};
        server
            .mockEndpoint()
            .post("/v2/link/token")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(422)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.link.token({
                userId: "user_id",
            });
        }).rejects.toThrow(Vital.UnprocessableEntityError);
    });

    test("is_token_valid (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { token: "token" };
        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .post("/v2/link/token/isValid")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.link.isTokenValid({
            token: "token",
        });
        expect(response).toEqual({
            key: "value",
        });
    });

    test("is_token_valid (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { token: "token" };
        const rawResponseBody = {};
        server
            .mockEndpoint()
            .post("/v2/link/token/isValid")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(422)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.link.isTokenValid({
                token: "token",
            });
        }).rejects.toThrow(Vital.UnprocessableEntityError);
    });

    test("code_create (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { code: "code", exchange_url: "exchange_url", expires_at: "2024-01-15T09:30:00Z" };
        server
            .mockEndpoint()
            .post("/v2/link/code/create")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.link.codeCreate({
            userId: "user_id",
            expiresAt: new Date("2024-01-15T09:30:00.000Z"),
        });
        expect(response).toEqual({
            code: "code",
            exchangeUrl: "exchange_url",
            expiresAt: new Date("2024-01-15T09:30:00.000Z"),
        });
    });

    test("code_create (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {};
        server
            .mockEndpoint()
            .post("/v2/link/code/create")
            .respondWith()
            .statusCode(422)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.link.codeCreate({
                userId: "user_id",
            });
        }).rejects.toThrow(Vital.UnprocessableEntityError);
    });

    test("start_connect (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { link_token: "link_token", provider: "oura" };
        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .post("/v2/link/start")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.link.startConnect({
            linkToken: "link_token",
            provider: "oura",
        });
        expect(response).toEqual({
            key: "value",
        });
    });

    test("start_connect (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { link_token: "link_token", provider: "oura" };
        const rawResponseBody = {};
        server
            .mockEndpoint()
            .post("/v2/link/start")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(422)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.link.startConnect({
                linkToken: "link_token",
                provider: "oura",
            });
        }).rejects.toThrow(Vital.UnprocessableEntityError);
    });

    test("token_state (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .get("/v2/link/state")
            .header("x-vital-link-token", "x-vital-link-token")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.link.tokenState({
            vitalLinkToken: "x-vital-link-token",
        });
        expect(response).toEqual({
            key: "value",
        });
    });

    test("token_state (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {};
        server.mockEndpoint().get("/v2/link/state").respondWith().statusCode(422).jsonBody(rawResponseBody).build();

        await expect(async () => {
            return await client.link.tokenState();
        }).rejects.toThrow(Vital.UnprocessableEntityError);
    });

    test("email_auth (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { email: "email", provider: "oura", auth_type: "password" };
        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .post("/v2/link/auth/email")
            .header("x-vital-link-token", "x-vital-link-token")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.link.emailAuth({
            vitalLinkToken: "x-vital-link-token",
            email: "email",
            provider: "oura",
            authType: "password",
        });
        expect(response).toEqual({
            key: "value",
        });
    });

    test("email_auth (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { email: "email", provider: "oura", auth_type: "password" };
        const rawResponseBody = {};
        server
            .mockEndpoint()
            .post("/v2/link/auth/email")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(422)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.link.emailAuth({
                email: "email",
                provider: "oura",
                authType: "password",
            });
        }).rejects.toThrow(Vital.UnprocessableEntityError);
    });

    test("password_auth (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { username: "username", password: "password", provider: "oura", auth_type: "password" };
        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .post("/v2/link/auth")
            .header("x-vital-link-token", "x-vital-link-token")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.link.passwordAuth({
            vitalLinkToken: "x-vital-link-token",
            username: "username",
            password: "password",
            provider: "oura",
            authType: "password",
        });
        expect(response).toEqual({
            key: "value",
        });
    });

    test("password_auth (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { username: "username", password: "password", provider: "oura", auth_type: "password" };
        const rawResponseBody = {};
        server
            .mockEndpoint()
            .post("/v2/link/auth")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(422)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.link.passwordAuth({
                username: "username",
                password: "password",
                provider: "oura",
                authType: "password",
            });
        }).rejects.toThrow(Vital.UnprocessableEntityError);
    });

    test("generate_oauth_link (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            name: "Garmin",
            slug: "garmin",
            description: "Garmin Watches",
            logo: "https://garmin.com",
            group: "group",
            oauth_url: "https://garmin_aouth_url.com",
            auth_type: "oauth",
            source_type: "app",
            is_active: true,
            backfill_num_days: 1,
            id: 1,
        };
        server
            .mockEndpoint()
            .get("/v2/link/provider/oauth/oura")
            .header("x-vital-link-token", "x-vital-link-token")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.link.generateOauthLink("oura", {
            vitalLinkToken: "x-vital-link-token",
        });
        expect(response).toEqual({
            name: "Garmin",
            slug: "garmin",
            description: "Garmin Watches",
            logo: "https://garmin.com",
            group: "group",
            oauthUrl: "https://garmin_aouth_url.com",
            authType: "oauth",
            sourceType: "app",
            isActive: true,
            backfillNumDays: 1,
            id: 1,
        });
    });

    test("generate_oauth_link (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {};
        server
            .mockEndpoint()
            .get("/v2/link/provider/oauth/oura")
            .respondWith()
            .statusCode(422)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.link.generateOauthLink("oura");
        }).rejects.toThrow(Vital.UnprocessableEntityError);
    });

    test("connect_password_provider (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { username: "username", password: "password" };
        const rawResponseBody = {
            state: "success",
            redirect_url: "redirect_url",
            error_type: "invalid_token",
            error: "error",
            provider_mfa: { method: "sms", hint: "hint" },
            provider: "whoop",
            connected: true,
            provider_id: "provider_id",
        };
        server
            .mockEndpoint()
            .post("/v2/link/provider/password/whoop")
            .header("x-vital-link-token", "x-vital-link-token")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.link.connectPasswordProvider("whoop", {
            vitalLinkToken: "x-vital-link-token",
            username: "username",
            password: "password",
        });
        expect(response).toEqual({
            state: "success",
            redirectUrl: "redirect_url",
            errorType: "invalid_token",
            error: "error",
            providerMfa: {
                method: "sms",
                hint: "hint",
            },
            provider: "whoop",
            connected: true,
            providerId: "provider_id",
        });
    });

    test("connect_password_provider (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { username: "username", password: "password" };
        const rawResponseBody = {};
        server
            .mockEndpoint()
            .post("/v2/link/provider/password/whoop")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(422)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.link.connectPasswordProvider("whoop", {
                username: "username",
                password: "password",
            });
        }).rejects.toThrow(Vital.UnprocessableEntityError);
    });

    test("complete_password_provider_mfa (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { mfa_code: "mfa_code" };
        const rawResponseBody = {
            state: "success",
            redirect_url: "redirect_url",
            error_type: "invalid_token",
            error: "error",
            provider_mfa: { method: "sms", hint: "hint" },
            provider: "whoop",
            connected: true,
            provider_id: "provider_id",
        };
        server
            .mockEndpoint()
            .post("/v2/link/provider/password/whoop/complete_mfa")
            .header("x-vital-link-token", "x-vital-link-token")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.link.completePasswordProviderMfa("whoop", {
            vitalLinkToken: "x-vital-link-token",
            mfaCode: "mfa_code",
        });
        expect(response).toEqual({
            state: "success",
            redirectUrl: "redirect_url",
            errorType: "invalid_token",
            error: "error",
            providerMfa: {
                method: "sms",
                hint: "hint",
            },
            provider: "whoop",
            connected: true,
            providerId: "provider_id",
        });
    });

    test("complete_password_provider_mfa (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { mfa_code: "mfa_code" };
        const rawResponseBody = {};
        server
            .mockEndpoint()
            .post("/v2/link/provider/password/whoop/complete_mfa")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(422)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.link.completePasswordProviderMfa("whoop", {
                mfaCode: "mfa_code",
            });
        }).rejects.toThrow(Vital.UnprocessableEntityError);
    });

    test("connect_email_auth_provider (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { email: "email" };
        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .post("/v2/link/provider/email/freestyle_libre")
            .header("x-vital-link-token", "x-vital-link-token")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.link.connectEmailAuthProvider("freestyle_libre", {
            vitalLinkToken: "x-vital-link-token",
            email: "email",
        });
        expect(response).toEqual({
            key: "value",
        });
    });

    test("connect_email_auth_provider (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { email: "email" };
        const rawResponseBody = {};
        server
            .mockEndpoint()
            .post("/v2/link/provider/email/freestyle_libre")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(422)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.link.connectEmailAuthProvider("freestyle_libre", {
                email: "email",
            });
        }).rejects.toThrow(Vital.UnprocessableEntityError);
    });

    test("get_all_providers (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = [
            {
                id: 1,
                name: "name",
                slug: "slug",
                description: "description",
                logo: "logo",
                oauth_url: "oauth_url",
                auth_type: "oauth",
                form_components: { key: "value" },
            },
        ];
        server
            .mockEndpoint()
            .get("/v2/link/providers")
            .header("x-vital-link-token", "x-vital-link-token")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.link.getAllProviders({
            vitalLinkToken: "x-vital-link-token",
        });
        expect(response).toEqual([
            {
                id: 1,
                name: "name",
                slug: "slug",
                description: "description",
                logo: "logo",
                oauthUrl: "oauth_url",
                authType: "oauth",
                formComponents: {
                    key: "value",
                },
            },
        ]);
    });

    test("get_all_providers (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {};
        server.mockEndpoint().get("/v2/link/providers").respondWith().statusCode(422).jsonBody(rawResponseBody).build();

        await expect(async () => {
            return await client.link.getAllProviders();
        }).rejects.toThrow(Vital.UnprocessableEntityError);
    });

    test("connect_manual_provider (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { user_id: "user_id" };
        const rawResponseBody = { key: true };
        server
            .mockEndpoint()
            .post("/v2/link/provider/manual/beurer_ble")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.link.connectManualProvider("beurer_ble", {
            userId: "user_id",
        });
        expect(response).toEqual({
            key: true,
        });
    });

    test("connect_manual_provider (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { user_id: "user_id" };
        const rawResponseBody = {};
        server
            .mockEndpoint()
            .post("/v2/link/provider/manual/beurer_ble")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(422)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.link.connectManualProvider("beurer_ble", {
                userId: "user_id",
            });
        }).rejects.toThrow(Vital.UnprocessableEntityError);
    });

    test("connect_demo_provider (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { user_id: "user_id", provider: "apple_health_kit" };
        const rawResponseBody = {
            success: true,
            detail: "Connected user 37c9c3fa-49e8-4d60-8cc8-328cba420f30 to provider fitbit",
        };
        server
            .mockEndpoint()
            .post("/v2/link/connect/demo")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.link.connectDemoProvider({
            userId: "user_id",
            provider: "apple_health_kit",
        });
        expect(response).toEqual({
            success: true,
            detail: "Connected user 37c9c3fa-49e8-4d60-8cc8-328cba420f30 to provider fitbit",
        });
    });

    test("connect_demo_provider (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { user_id: "user_id", provider: "apple_health_kit" };
        const rawResponseBody = {};
        server
            .mockEndpoint()
            .post("/v2/link/connect/demo")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(422)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.link.connectDemoProvider({
                userId: "user_id",
                provider: "apple_health_kit",
            });
        }).rejects.toThrow(Vital.UnprocessableEntityError);
    });
});

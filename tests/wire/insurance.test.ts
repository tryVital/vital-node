// This file was auto-generated by Fern from our API Definition.

import * as Vital from "../../src/api/index";
import { VitalClient } from "../../src/Client";
import { mockServerPool } from "../mock-server/MockServerPool";

describe("InsuranceClient", () => {
    test("search_get_payor_info (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = [
            {
                payor_code: "payor_code",
                name: "name",
                aliases: ["aliases"],
                org_address: {
                    first_line: "first_line",
                    second_line: "second_line",
                    country: "country",
                    zip: "zip",
                    city: "city",
                    state: "state",
                },
                source: "platform",
            },
        ];
        server
            .mockEndpoint()
            .get("/v3/insurance/search/payor")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.insurance.searchGetPayorInfo({
            insuranceName: "insurance_name",
            provider: "change_healthcare",
            providerPayorId: "provider_payor_id",
        });
        expect(response).toEqual([
            {
                payorCode: "payor_code",
                name: "name",
                aliases: ["aliases"],
                orgAddress: {
                    firstLine: "first_line",
                    secondLine: "second_line",
                    country: "country",
                    zip: "zip",
                    city: "city",
                    state: "state",
                },
                source: "platform",
            },
        ]);
    });

    test("search_get_payor_info (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {};
        server
            .mockEndpoint()
            .get("/v3/insurance/search/payor")
            .respondWith()
            .statusCode(422)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.insurance.searchGetPayorInfo();
        }).rejects.toThrow(Vital.UnprocessableEntityError);
    });

    test("search_payor_info (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {};
        const rawResponseBody = [
            {
                code: "code",
                name: "name",
                aliases: ["aliases"],
                org_address: {
                    first_line: "first_line",
                    second_line: "second_line",
                    country: "country",
                    zip: "zip",
                    city: "city",
                    state: "state",
                },
                source: "platform",
            },
        ];
        server
            .mockEndpoint()
            .post("/v3/insurance/search/payor")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.insurance.searchPayorInfo();
        expect(response).toEqual([
            {
                code: "code",
                name: "name",
                aliases: ["aliases"],
                orgAddress: {
                    firstLine: "first_line",
                    secondLine: "second_line",
                    country: "country",
                    zip: "zip",
                    city: "city",
                    state: "state",
                },
                source: "platform",
            },
        ]);
    });

    test("search_payor_info (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {};
        const rawResponseBody = {};
        server
            .mockEndpoint()
            .post("/v3/insurance/search/payor")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(422)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.insurance.searchPayorInfo();
        }).rejects.toThrow(Vital.UnprocessableEntityError);
    });

    test("search_diagnosis (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = [{ diagnosis_code: "diagnosis_code", description: "description", is_secondary: true }];
        server
            .mockEndpoint()
            .get("/v3/insurance/search/diagnosis")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.insurance.searchDiagnosis({
            diagnosisQuery: "diagnosis_query",
        });
        expect(response).toEqual([
            {
                diagnosisCode: "diagnosis_code",
                description: "description",
                isSecondary: true,
            },
        ]);
    });

    test("search_diagnosis (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {};
        server
            .mockEndpoint()
            .get("/v3/insurance/search/diagnosis")
            .respondWith()
            .statusCode(422)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.insurance.searchDiagnosis({
                diagnosisQuery: "diagnosis_query",
            });
        }).rejects.toThrow(Vital.UnprocessableEntityError);
    });
});

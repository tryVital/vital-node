// This file was auto-generated by Fern from our API Definition.

import * as Vital from "../../src/api/index";
import { VitalClient } from "../../src/Client";
import { mockServerPool } from "../mock-server/MockServerPool";

describe("MenstrualCycleClient", () => {
    test("get (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            menstrual_cycle: [
                {
                    id: "e1274c3e-c035-4bd7-86aa-2eb15d6d0137",
                    period_start: "2024-04-07",
                    period_end: "2024-04-11",
                    cycle_end: "2024-05-01",
                    is_predicted: false,
                    menstrual_flow: [
                        { date: "2024-04-07", flow: "light" },
                        { date: "2024-04-10", flow: "medium" },
                        { date: "2024-04-11", flow: "heavy" },
                    ],
                    cervical_mucus: [{ date: "date", quality: "dry" }],
                    intermenstrual_bleeding: [{ date: "2024-04-17" }],
                    contraceptive: [{ date: "date", type: "unspecified" }],
                    detected_deviations: [{ date: "date", deviation: "persistent_intermenstrual_bleeding" }],
                    ovulation_test: [{ date: "date", test_result: "negative" }],
                    home_pregnancy_test: [{ date: "date", test_result: "negative" }],
                    home_progesterone_test: [{ date: "date", test_result: "negative" }],
                    sexual_activity: [{ date: "2024-04-13", protection_used: true }],
                    basal_body_temperature: [{ date: "date", value: 1.1 }],
                    source_provider: "apple_health_kit",
                    source_type: "app",
                    source_app_id: "com.apple.Health",
                    source_device_id: "source_device_id",
                    created_at: "2023-02-27T20:31:24Z",
                    updated_at: "2023-02-28T01:22:38Z",
                    user_id: "cbd8b986-4225-4d36-8e2c-046ff2702769",
                    source: {
                        provider: "apple_health_kit",
                        type: "app",
                        app_id: "com.apple.Health",
                        device_id: "550e8400-e29b-41d4-a716-446655440000",
                    },
                },
            ],
        };
        server
            .mockEndpoint()
            .get("/v2/summary/menstrual_cycle/user_id")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.menstrualCycle.get("user_id", {
            provider: "provider",
            startDate: "start_date",
            endDate: "end_date",
        });
        expect(response).toEqual({
            menstrualCycle: [
                {
                    id: "e1274c3e-c035-4bd7-86aa-2eb15d6d0137",
                    periodStart: "2024-04-07",
                    periodEnd: "2024-04-11",
                    cycleEnd: "2024-05-01",
                    isPredicted: false,
                    menstrualFlow: [
                        {
                            date: "2024-04-07",
                            flow: "light",
                        },
                        {
                            date: "2024-04-10",
                            flow: "medium",
                        },
                        {
                            date: "2024-04-11",
                            flow: "heavy",
                        },
                    ],
                    cervicalMucus: [
                        {
                            date: "date",
                            quality: "dry",
                        },
                    ],
                    intermenstrualBleeding: [
                        {
                            date: "2024-04-17",
                        },
                    ],
                    contraceptive: [
                        {
                            date: "date",
                            type: "unspecified",
                        },
                    ],
                    detectedDeviations: [
                        {
                            date: "date",
                            deviation: "persistent_intermenstrual_bleeding",
                        },
                    ],
                    ovulationTest: [
                        {
                            date: "date",
                            testResult: "negative",
                        },
                    ],
                    homePregnancyTest: [
                        {
                            date: "date",
                            testResult: "negative",
                        },
                    ],
                    homeProgesteroneTest: [
                        {
                            date: "date",
                            testResult: "negative",
                        },
                    ],
                    sexualActivity: [
                        {
                            date: "2024-04-13",
                            protectionUsed: true,
                        },
                    ],
                    basalBodyTemperature: [
                        {
                            date: "date",
                            value: 1.1,
                        },
                    ],
                    sourceProvider: "apple_health_kit",
                    sourceType: "app",
                    sourceAppId: "com.apple.Health",
                    sourceDeviceId: "source_device_id",
                    createdAt: new Date("2023-02-27T20:31:24.000Z"),
                    updatedAt: new Date("2023-02-28T01:22:38.000Z"),
                    userId: "cbd8b986-4225-4d36-8e2c-046ff2702769",
                    source: {
                        provider: "apple_health_kit",
                        type: "app",
                        appId: "com.apple.Health",
                        deviceId: "550e8400-e29b-41d4-a716-446655440000",
                    },
                },
            ],
        });
    });

    test("get (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {};
        server
            .mockEndpoint()
            .get("/v2/summary/menstrual_cycle/user_id")
            .respondWith()
            .statusCode(422)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.menstrualCycle.get("user_id", {
                startDate: "start_date",
            });
        }).rejects.toThrow(Vital.UnprocessableEntityError);
    });
});

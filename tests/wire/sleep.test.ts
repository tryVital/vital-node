// This file was auto-generated by Fern from our API Definition.

import * as Vital from "../../src/api/index";
import { VitalClient } from "../../src/Client";
import { mockServerPool } from "../mock-server/MockServerPool";

describe("SleepClient", () => {
    test("get (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            sleep: [
                {
                    id: "e2e0eb04-6641-4858-9de5-649efb41b346",
                    user_id: "1449752e-0d8a-40e0-9206-91ab099b2537",
                    date: "2023-02-27T12:31:24Z",
                    calendar_date: "2023-02-27",
                    bedtime_start: "2023-02-27T12:31:24Z",
                    bedtime_stop: "2023-02-27T12:31:24Z",
                    type: "long_sleep",
                    timezone_offset: 2400,
                    duration: 28800,
                    total: 28800,
                    awake: 2400,
                    light: 2400,
                    rem: 2400,
                    deep: 2400,
                    score: 1,
                    hr_lowest: 43,
                    hr_average: 50,
                    hr_resting: 1,
                    efficiency: 0.97,
                    latency: 1000,
                    temperature_delta: -0.2,
                    skin_temperature: 36.5,
                    hr_dip: 1.1,
                    state: "tentative",
                    average_hrv: 78,
                    respiratory_rate: 14,
                    source: { provider: "oura", type: "unknown", device_id: "550e8400-e29b-41d4-a716-446655440000" },
                    sleep_stream: {
                        hrv: [
                            { id: 0, unit: "rmssd", timestamp: "2026-01-23T14:08:04Z", value: 97 },
                            { id: 1, unit: "rmssd", timestamp: "2026-01-23T14:08:34Z", value: 69 },
                            { id: 2, unit: "rmssd", timestamp: "2026-01-23T14:09:04Z", value: 98 },
                            { id: 3, unit: "rmssd", timestamp: "2026-01-23T14:09:34Z", value: 14 },
                            { id: 4, unit: "rmssd", timestamp: "2026-01-23T14:10:04Z", value: 48 },
                        ],
                        heartrate: [
                            { id: 0, unit: "bpm", timestamp: "2026-01-23T14:08:04Z", value: 118 },
                            { id: 1, unit: "bpm", timestamp: "2026-01-23T14:08:34Z", value: 25 },
                            { id: 2, unit: "bpm", timestamp: "2026-01-23T14:09:04Z", value: 39 },
                            { id: 3, unit: "bpm", timestamp: "2026-01-23T14:09:34Z", value: 107 },
                            { id: 4, unit: "bpm", timestamp: "2026-01-23T14:10:04Z", value: 88 },
                        ],
                        hypnogram: [
                            {
                                id: 0,
                                unit: "stage",
                                timestamp: "2026-01-23T14:08:04Z",
                                start: "2024-01-15T09:30:00Z",
                                end: "2024-01-15T09:30:00Z",
                                value: 2,
                            },
                            {
                                id: 1,
                                unit: "stage",
                                timestamp: "2026-01-23T14:08:34Z",
                                start: "2024-01-15T09:30:00Z",
                                end: "2024-01-15T09:30:00Z",
                                value: 3,
                            },
                            {
                                id: 2,
                                unit: "stage",
                                timestamp: "2026-01-23T14:09:04Z",
                                start: "2024-01-15T09:30:00Z",
                                end: "2024-01-15T09:30:00Z",
                                value: 3,
                            },
                            {
                                id: 3,
                                unit: "stage",
                                timestamp: "2026-01-23T14:09:34Z",
                                start: "2024-01-15T09:30:00Z",
                                end: "2024-01-15T09:30:00Z",
                                value: 2,
                            },
                            {
                                id: 4,
                                unit: "stage",
                                timestamp: "2026-01-23T14:10:04Z",
                                start: "2024-01-15T09:30:00Z",
                                end: "2024-01-15T09:30:00Z",
                                value: -1,
                            },
                        ],
                        respiratory_rate: [
                            { id: 0, unit: "bpm", timestamp: "2026-01-23T14:08:04Z", value: 25 },
                            { id: 1, unit: "bpm", timestamp: "2026-01-23T14:08:34Z", value: 28 },
                            { id: 2, unit: "bpm", timestamp: "2026-01-23T14:09:04Z", value: 11 },
                            { id: 3, unit: "bpm", timestamp: "2026-01-23T14:09:34Z", value: 13 },
                            { id: 4, unit: "bpm", timestamp: "2026-01-23T14:10:04Z", value: 19 },
                        ],
                    },
                    created_at: "2023-02-27T20:31:24Z",
                    updated_at: "2023-02-28T01:22:38Z",
                },
            ],
        };
        server
            .mockEndpoint()
            .get("/v2/summary/sleep/user_id")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.sleep.get("user_id", {
            provider: "provider",
            startDate: "start_date",
            endDate: "end_date",
        });
        expect(response).toEqual({
            sleep: [
                {
                    id: "e2e0eb04-6641-4858-9de5-649efb41b346",
                    userId: "1449752e-0d8a-40e0-9206-91ab099b2537",
                    date: new Date("2023-02-27T12:31:24.000Z"),
                    calendarDate: "2023-02-27",
                    bedtimeStart: new Date("2023-02-27T12:31:24.000Z"),
                    bedtimeStop: new Date("2023-02-27T12:31:24.000Z"),
                    type: "long_sleep",
                    timezoneOffset: 2400,
                    duration: 28800,
                    total: 28800,
                    awake: 2400,
                    light: 2400,
                    rem: 2400,
                    deep: 2400,
                    score: 1,
                    hrLowest: 43,
                    hrAverage: 50,
                    hrResting: 1,
                    efficiency: 0.97,
                    latency: 1000,
                    temperatureDelta: -0.2,
                    skinTemperature: 36.5,
                    hrDip: 1.1,
                    state: "tentative",
                    averageHrv: 78,
                    respiratoryRate: 14,
                    source: {
                        provider: "oura",
                        type: "unknown",
                        deviceId: "550e8400-e29b-41d4-a716-446655440000",
                    },
                    sleepStream: {
                        hrv: [
                            {
                                id: 0,
                                unit: "rmssd",
                                timestamp: new Date("2026-01-23T14:08:04.000Z"),
                                value: 97,
                            },
                            {
                                id: 1,
                                unit: "rmssd",
                                timestamp: new Date("2026-01-23T14:08:34.000Z"),
                                value: 69,
                            },
                            {
                                id: 2,
                                unit: "rmssd",
                                timestamp: new Date("2026-01-23T14:09:04.000Z"),
                                value: 98,
                            },
                            {
                                id: 3,
                                unit: "rmssd",
                                timestamp: new Date("2026-01-23T14:09:34.000Z"),
                                value: 14,
                            },
                            {
                                id: 4,
                                unit: "rmssd",
                                timestamp: new Date("2026-01-23T14:10:04.000Z"),
                                value: 48,
                            },
                        ],
                        heartrate: [
                            {
                                id: 0,
                                unit: "bpm",
                                timestamp: new Date("2026-01-23T14:08:04.000Z"),
                                value: 118,
                            },
                            {
                                id: 1,
                                unit: "bpm",
                                timestamp: new Date("2026-01-23T14:08:34.000Z"),
                                value: 25,
                            },
                            {
                                id: 2,
                                unit: "bpm",
                                timestamp: new Date("2026-01-23T14:09:04.000Z"),
                                value: 39,
                            },
                            {
                                id: 3,
                                unit: "bpm",
                                timestamp: new Date("2026-01-23T14:09:34.000Z"),
                                value: 107,
                            },
                            {
                                id: 4,
                                unit: "bpm",
                                timestamp: new Date("2026-01-23T14:10:04.000Z"),
                                value: 88,
                            },
                        ],
                        hypnogram: [
                            {
                                id: 0,
                                unit: "stage",
                                timestamp: new Date("2026-01-23T14:08:04.000Z"),
                                start: new Date("2024-01-15T09:30:00.000Z"),
                                end: new Date("2024-01-15T09:30:00.000Z"),
                                value: 2,
                            },
                            {
                                id: 1,
                                unit: "stage",
                                timestamp: new Date("2026-01-23T14:08:34.000Z"),
                                start: new Date("2024-01-15T09:30:00.000Z"),
                                end: new Date("2024-01-15T09:30:00.000Z"),
                                value: 3,
                            },
                            {
                                id: 2,
                                unit: "stage",
                                timestamp: new Date("2026-01-23T14:09:04.000Z"),
                                start: new Date("2024-01-15T09:30:00.000Z"),
                                end: new Date("2024-01-15T09:30:00.000Z"),
                                value: 3,
                            },
                            {
                                id: 3,
                                unit: "stage",
                                timestamp: new Date("2026-01-23T14:09:34.000Z"),
                                start: new Date("2024-01-15T09:30:00.000Z"),
                                end: new Date("2024-01-15T09:30:00.000Z"),
                                value: 2,
                            },
                            {
                                id: 4,
                                unit: "stage",
                                timestamp: new Date("2026-01-23T14:10:04.000Z"),
                                start: new Date("2024-01-15T09:30:00.000Z"),
                                end: new Date("2024-01-15T09:30:00.000Z"),
                                value: -1,
                            },
                        ],
                        respiratoryRate: [
                            {
                                id: 0,
                                unit: "bpm",
                                timestamp: new Date("2026-01-23T14:08:04.000Z"),
                                value: 25,
                            },
                            {
                                id: 1,
                                unit: "bpm",
                                timestamp: new Date("2026-01-23T14:08:34.000Z"),
                                value: 28,
                            },
                            {
                                id: 2,
                                unit: "bpm",
                                timestamp: new Date("2026-01-23T14:09:04.000Z"),
                                value: 11,
                            },
                            {
                                id: 3,
                                unit: "bpm",
                                timestamp: new Date("2026-01-23T14:09:34.000Z"),
                                value: 13,
                            },
                            {
                                id: 4,
                                unit: "bpm",
                                timestamp: new Date("2026-01-23T14:10:04.000Z"),
                                value: 19,
                            },
                        ],
                    },
                    createdAt: new Date("2023-02-27T20:31:24.000Z"),
                    updatedAt: new Date("2023-02-28T01:22:38.000Z"),
                },
            ],
        });
    });

    test("get (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {};
        server
            .mockEndpoint()
            .get("/v2/summary/sleep/user_id")
            .respondWith()
            .statusCode(422)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.sleep.get("user_id", {
                startDate: "start_date",
            });
        }).rejects.toThrow(Vital.UnprocessableEntityError);
    });

    test("get_raw (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            sleep: [
                {
                    timestamp: "2023-02-27T12:31:24Z",
                    data: { data: "...provider_specific_data" },
                    provider_id: "5e8271a3-e71b-4882-a94a-7e364694cd16",
                    user_id: "1449752e-0d8a-40e0-9206-91ab099b2537",
                    source_id: 1,
                    priority_id: 1,
                    id: "id",
                    source: { name: "Oura", slug: "oura", logo: "https://logo_url.com" },
                    priority: 1,
                    source_device_id: "550e8400-e29b-41d4-a716-446655440000",
                    created_at: "2024-01-15T09:30:00Z",
                    updated_at: "2024-01-15T09:30:00Z",
                },
            ],
        };
        server
            .mockEndpoint()
            .get("/v2/summary/sleep/user_id/raw")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.sleep.getRaw("user_id", {
            provider: "provider",
            startDate: "start_date",
            endDate: "end_date",
        });
        expect(response).toEqual({
            sleep: [
                {
                    timestamp: new Date("2023-02-27T12:31:24.000Z"),
                    data: {
                        data: "...provider_specific_data",
                    },
                    providerId: "5e8271a3-e71b-4882-a94a-7e364694cd16",
                    userId: "1449752e-0d8a-40e0-9206-91ab099b2537",
                    sourceId: 1,
                    priorityId: 1,
                    id: "id",
                    source: {
                        name: "Oura",
                        slug: "oura",
                        logo: "https://logo_url.com",
                    },
                    priority: 1,
                    sourceDeviceId: "550e8400-e29b-41d4-a716-446655440000",
                    createdAt: new Date("2024-01-15T09:30:00.000Z"),
                    updatedAt: new Date("2024-01-15T09:30:00.000Z"),
                },
            ],
        });
    });

    test("get_raw (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {};
        server
            .mockEndpoint()
            .get("/v2/summary/sleep/user_id/raw")
            .respondWith()
            .statusCode(422)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.sleep.getRaw("user_id", {
                startDate: "start_date",
            });
        }).rejects.toThrow(Vital.UnprocessableEntityError);
    });

    test("get_stream_by_sleep_id (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            hrv: [
                {
                    id: 0,
                    timezone_offset: 1,
                    type: "type",
                    unit: "rmssd",
                    timestamp: "2026-01-23T14:08:04Z",
                    value: 97,
                },
                {
                    id: 1,
                    timezone_offset: 1,
                    type: "type",
                    unit: "rmssd",
                    timestamp: "2026-01-23T14:08:34Z",
                    value: 69,
                },
                {
                    id: 2,
                    timezone_offset: 1,
                    type: "type",
                    unit: "rmssd",
                    timestamp: "2026-01-23T14:09:04Z",
                    value: 98,
                },
                {
                    id: 3,
                    timezone_offset: 1,
                    type: "type",
                    unit: "rmssd",
                    timestamp: "2026-01-23T14:09:34Z",
                    value: 14,
                },
                {
                    id: 4,
                    timezone_offset: 1,
                    type: "type",
                    unit: "rmssd",
                    timestamp: "2026-01-23T14:10:04Z",
                    value: 48,
                },
            ],
            heartrate: [
                { id: 0, timezone_offset: 1, type: "type", unit: "bpm", timestamp: "2026-01-23T14:08:04Z", value: 118 },
                { id: 1, timezone_offset: 1, type: "type", unit: "bpm", timestamp: "2026-01-23T14:08:34Z", value: 25 },
                { id: 2, timezone_offset: 1, type: "type", unit: "bpm", timestamp: "2026-01-23T14:09:04Z", value: 39 },
                { id: 3, timezone_offset: 1, type: "type", unit: "bpm", timestamp: "2026-01-23T14:09:34Z", value: 107 },
                { id: 4, timezone_offset: 1, type: "type", unit: "bpm", timestamp: "2026-01-23T14:10:04Z", value: 88 },
            ],
            hypnogram: [
                {
                    id: 0,
                    timezone_offset: 1,
                    type: "type",
                    unit: "stage",
                    timestamp: "2026-01-23T14:08:04Z",
                    start: "2024-01-15T09:30:00Z",
                    end: "2024-01-15T09:30:00Z",
                    value: 2,
                },
                {
                    id: 1,
                    timezone_offset: 1,
                    type: "type",
                    unit: "stage",
                    timestamp: "2026-01-23T14:08:34Z",
                    start: "2024-01-15T09:30:00Z",
                    end: "2024-01-15T09:30:00Z",
                    value: 3,
                },
                {
                    id: 2,
                    timezone_offset: 1,
                    type: "type",
                    unit: "stage",
                    timestamp: "2026-01-23T14:09:04Z",
                    start: "2024-01-15T09:30:00Z",
                    end: "2024-01-15T09:30:00Z",
                    value: 3,
                },
                {
                    id: 3,
                    timezone_offset: 1,
                    type: "type",
                    unit: "stage",
                    timestamp: "2026-01-23T14:09:34Z",
                    start: "2024-01-15T09:30:00Z",
                    end: "2024-01-15T09:30:00Z",
                    value: 2,
                },
                {
                    id: 4,
                    timezone_offset: 1,
                    type: "type",
                    unit: "stage",
                    timestamp: "2026-01-23T14:10:04Z",
                    start: "2024-01-15T09:30:00Z",
                    end: "2024-01-15T09:30:00Z",
                    value: -1,
                },
            ],
            respiratory_rate: [
                { id: 0, timezone_offset: 1, type: "type", unit: "bpm", timestamp: "2026-01-23T14:08:04Z", value: 25 },
                { id: 1, timezone_offset: 1, type: "type", unit: "bpm", timestamp: "2026-01-23T14:08:34Z", value: 28 },
                { id: 2, timezone_offset: 1, type: "type", unit: "bpm", timestamp: "2026-01-23T14:09:04Z", value: 11 },
                { id: 3, timezone_offset: 1, type: "type", unit: "bpm", timestamp: "2026-01-23T14:09:34Z", value: 13 },
                { id: 4, timezone_offset: 1, type: "type", unit: "bpm", timestamp: "2026-01-23T14:10:04Z", value: 19 },
            ],
        };
        server
            .mockEndpoint()
            .get("/v2/timeseries/sleep/sleep_id/stream")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.sleep.getStreamBySleepId("sleep_id");
        expect(response).toEqual({
            hrv: [
                {
                    id: 0,
                    timezoneOffset: 1,
                    type: "type",
                    unit: "rmssd",
                    timestamp: new Date("2026-01-23T14:08:04.000Z"),
                    value: 97,
                },
                {
                    id: 1,
                    timezoneOffset: 1,
                    type: "type",
                    unit: "rmssd",
                    timestamp: new Date("2026-01-23T14:08:34.000Z"),
                    value: 69,
                },
                {
                    id: 2,
                    timezoneOffset: 1,
                    type: "type",
                    unit: "rmssd",
                    timestamp: new Date("2026-01-23T14:09:04.000Z"),
                    value: 98,
                },
                {
                    id: 3,
                    timezoneOffset: 1,
                    type: "type",
                    unit: "rmssd",
                    timestamp: new Date("2026-01-23T14:09:34.000Z"),
                    value: 14,
                },
                {
                    id: 4,
                    timezoneOffset: 1,
                    type: "type",
                    unit: "rmssd",
                    timestamp: new Date("2026-01-23T14:10:04.000Z"),
                    value: 48,
                },
            ],
            heartrate: [
                {
                    id: 0,
                    timezoneOffset: 1,
                    type: "type",
                    unit: "bpm",
                    timestamp: new Date("2026-01-23T14:08:04.000Z"),
                    value: 118,
                },
                {
                    id: 1,
                    timezoneOffset: 1,
                    type: "type",
                    unit: "bpm",
                    timestamp: new Date("2026-01-23T14:08:34.000Z"),
                    value: 25,
                },
                {
                    id: 2,
                    timezoneOffset: 1,
                    type: "type",
                    unit: "bpm",
                    timestamp: new Date("2026-01-23T14:09:04.000Z"),
                    value: 39,
                },
                {
                    id: 3,
                    timezoneOffset: 1,
                    type: "type",
                    unit: "bpm",
                    timestamp: new Date("2026-01-23T14:09:34.000Z"),
                    value: 107,
                },
                {
                    id: 4,
                    timezoneOffset: 1,
                    type: "type",
                    unit: "bpm",
                    timestamp: new Date("2026-01-23T14:10:04.000Z"),
                    value: 88,
                },
            ],
            hypnogram: [
                {
                    id: 0,
                    timezoneOffset: 1,
                    type: "type",
                    unit: "stage",
                    timestamp: new Date("2026-01-23T14:08:04.000Z"),
                    start: new Date("2024-01-15T09:30:00.000Z"),
                    end: new Date("2024-01-15T09:30:00.000Z"),
                    value: 2,
                },
                {
                    id: 1,
                    timezoneOffset: 1,
                    type: "type",
                    unit: "stage",
                    timestamp: new Date("2026-01-23T14:08:34.000Z"),
                    start: new Date("2024-01-15T09:30:00.000Z"),
                    end: new Date("2024-01-15T09:30:00.000Z"),
                    value: 3,
                },
                {
                    id: 2,
                    timezoneOffset: 1,
                    type: "type",
                    unit: "stage",
                    timestamp: new Date("2026-01-23T14:09:04.000Z"),
                    start: new Date("2024-01-15T09:30:00.000Z"),
                    end: new Date("2024-01-15T09:30:00.000Z"),
                    value: 3,
                },
                {
                    id: 3,
                    timezoneOffset: 1,
                    type: "type",
                    unit: "stage",
                    timestamp: new Date("2026-01-23T14:09:34.000Z"),
                    start: new Date("2024-01-15T09:30:00.000Z"),
                    end: new Date("2024-01-15T09:30:00.000Z"),
                    value: 2,
                },
                {
                    id: 4,
                    timezoneOffset: 1,
                    type: "type",
                    unit: "stage",
                    timestamp: new Date("2026-01-23T14:10:04.000Z"),
                    start: new Date("2024-01-15T09:30:00.000Z"),
                    end: new Date("2024-01-15T09:30:00.000Z"),
                    value: -1,
                },
            ],
            respiratoryRate: [
                {
                    id: 0,
                    timezoneOffset: 1,
                    type: "type",
                    unit: "bpm",
                    timestamp: new Date("2026-01-23T14:08:04.000Z"),
                    value: 25,
                },
                {
                    id: 1,
                    timezoneOffset: 1,
                    type: "type",
                    unit: "bpm",
                    timestamp: new Date("2026-01-23T14:08:34.000Z"),
                    value: 28,
                },
                {
                    id: 2,
                    timezoneOffset: 1,
                    type: "type",
                    unit: "bpm",
                    timestamp: new Date("2026-01-23T14:09:04.000Z"),
                    value: 11,
                },
                {
                    id: 3,
                    timezoneOffset: 1,
                    type: "type",
                    unit: "bpm",
                    timestamp: new Date("2026-01-23T14:09:34.000Z"),
                    value: 13,
                },
                {
                    id: 4,
                    timezoneOffset: 1,
                    type: "type",
                    unit: "bpm",
                    timestamp: new Date("2026-01-23T14:10:04.000Z"),
                    value: 19,
                },
            ],
        });
    });

    test("get_stream_by_sleep_id (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new VitalClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {};
        server
            .mockEndpoint()
            .get("/v2/timeseries/sleep/sleep_id/stream")
            .respondWith()
            .statusCode(422)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.sleep.getStreamBySleepId("sleep_id");
        }).rejects.toThrow(Vital.UnprocessableEntityError);
    });
});
